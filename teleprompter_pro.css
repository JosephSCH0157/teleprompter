/* Overlay sheet */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:flex-start;justify-content:center;padding:40px;z-index:9999}
.overlay.hidden{display:none}
.overlay .sheet{background:#0e141b;border:1px solid #1f2937;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.5);max-width:720px;width:100%;padding:20px}
.sheet-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.shortcuts-grid{display:grid;grid-template-columns:180px 1fr;gap:10px 16px;margin:8px 0 12px}
.shortcuts-grid .dim,.dim{opacity:.7}
kbd{display:inline-block;min-width:1.6em;padding:.15em .45em;border:1px solid #374151;border-bottom-width:2px;border-radius:6px;background:#111827;color:#e5e7eb;font:12px/1.2 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;text-align:center}
.btn-chip{background:#0e141b;border:1px solid var(--edge);padding:8px 10px;border-radius:10px;cursor:pointer;color:var(--fg)}
.btn-chip:hover{background:#10161d}
.sheet-section{margin-top:12px;padding-top:8px;border-top:1px solid var(--edge)}
#validatePanel pre{white-space:pre-wrap;-webkit-user-select:text;user-select:text;margin-top:8px;background:#0e141b;color:var(--fg);border:1px solid var(--edge);border-radius:12px;padding:12px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;font-size:13px;line-height:1.4;max-height:40vh;overflow:auto}

/* Savanna theme (subtle, non-intrusive) */
body.savanna { --edge:#a9763a; }
body.savanna::before{
    content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
    background:
        radial-gradient(1200px 800px at 85% -10%, rgba(214,125,45,.08), transparent 70%),
        radial-gradient(900px 600px at -10% 110%, rgba(194,59,34,.06), transparent 70%);
}
body.savanna::after{
    content:""; position:fixed; right:6%; bottom:6%; width:160px; height:160px;
    background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220' viewBox='0 0 220 220'%3E%3Cg fill='%23d67d2d' fill-opacity='.10'%3E%3Ccircle cx='60' cy='60' r='28'/%3E%3Ccircle cx='115' cy='50' r='24'/%3E%3Ccircle cx='160' cy='75' r='22'/%3E%3Ccircle cx='85' cy='110' r='26'/%3E%3Cellipse cx='120' cy='155' rx='55' ry='36'/%3E%3C/g%3E%3C/svg%3E") center/contain no-repeat;
    filter: drop-shadow(0 2px 8px rgba(0,0,0,.2));
    pointer-events:none;
}

/* dB meter party mode */
#dbMeter.party .bar { animation: meterPulse 900ms linear infinite alternate; }
@keyframes meterPulse { from { opacity:.6 } to { opacity:1 } }
.section-title {
    display: flex;
    align-items: center;
    gap: 10px;
}
select { font-size: 14px; }
.select-lg { font-size: 16px; }
.select-sm { font-size: 12px; }
    .select-md { font-size: 14px; }  /* tweak to taste */
    .hidden { display: none !important; }

/* Utility: visually hidden (accessible label) */
.visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}

/* Stronger focus indicators for accessibility */
/* Use :focus-visible where supported to show only for keyboard focus */
button:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible, .chip:focus-visible {
    outline: 3px solid #2b90ff; /* high-contrast blue */
    outline-offset: 2px;
    box-shadow: 0 0 0 3px rgba(43,144,255,0.12);
}

/* Ensure chips can be focused for screen-reader users (if they are interactive spans) */
.chip[tabindex]{ cursor: pointer; }

/* Inline utility classes (deduped & merged) */
.inl-x3{font-variant-numeric:tabular-nums;font-size:64px;line-height:1;margin-top:6px;min-width:200px}
.inl-x2{font-size:14px;color:#96a0aa;margin-top:16px}
/* For .inl-x1 two different min-widths appeared (200px, 240px); using the larger for layout safety */
.inl-x1{min-width:240px}
/* Inline style extractions (pass) */
.inl-x7{font-size:14px;color:#96a0aa}
/* Inline style extractions (pass) */
.inl-x6{background:#0e141b;border:1px solid var(--edge);padding:24px 32px;border-radius:16px;text-align:center}
/* Inline style extractions (pass) */
.inl-x5{min-width:200px}
/* Inline style extractions (pass) */
.inl-x4{display:none}
/* (Removed duplicate .inl-x1/.inl-x2/.inl-x3 definitions) */
/* Inline style extractions */
.inl-1{border:1px solid var(--edge); padding:4px 10px; border-radius:10px; background:#0e141b; color:var(--fg); margin-left:auto}
.inl-2{min-width:240px}
.inl-3{margin-top:16px}
.inl-4{min-width:200px}
.inl-5{display:none}
.inl-6{min-width:200px}
.inl-7{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:9999}
.inl-8{background:#0e141b;border:1px solid var(--edge);padding:24px 32px;border-radius:16px;text-align:center}
.inl-9{font-size:14px;color:#96a0aa}
.inl-10{font-variant-numeric:tabular-nums;font-size:64px;line-height:1;margin-top:6px}


    :root{ --bg:#0b0d10; --fg:#e7ebf0; --muted:#96a0aa; --accent:#7cc4ff; --card:#151a20; --edge:#22303d; --s1-color:#2ea8ff; --s2-color:#ff6b6b; }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";min-height:100svh;min-height:100dvh;display:flex;flex-direction:column}

    /* Reserve fixed layout slots to prevent layout shifts (CLS) */
    :root{ --topbar-h:56px; --statusbar-h:28px; --sidebar-w:320px; }
    /* topbar: align chips to timer/marker baseline; use 8px spacing multiples */
    .topbar{display:flex;align-items:center;gap:8px;position:sticky;top:0;background:linear-gradient(var(--bg),transparent);padding:8px 16px;border-bottom:1px solid var(--edge);z-index:10;height:var(--topbar-h);box-sizing:border-box}
    .topbar strong{letter-spacing:.2px}

    /* Robust topbar hairline / overlay
       - Add a thin overlay separator so the topbar appears crisp over varying backgrounds.
       - Use a pseudo-element to avoid layout shift and to keep the rule high-specificity but low-impact.
       - Provide a fallback hairline for high-DPI by using transform translateZ(0.001px) to force a hairline in some browsers.
    */
    .topbar::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        top: 100%; /* sit just below the bar */
        height: 3px;
        pointer-events: none;
        background: linear-gradient(rgba(255,255,255,0.06), rgba(255,255,255,0.02));
        z-index: 160;
        transform: translateZ(0.001px);
    }

    /* A subtle overlay when the player is in front/display mode to ensure separation from content */
    .topbar.overlay {
        background: rgba(0,0,0,0.35);
    }

    /* Optional hairline variant for very dark backgrounds */
    .topbar.hairline-strong::after {
        background: linear-gradient(rgba(255,255,255,0.08), rgba(255,255,255,0.02));
    }
    /* top-bar label rhythm & consistency */
    .chip{font-size:0.9rem;font-weight:600;color:var(--muted);border-radius:.5rem;padding:6px 8px}
    #debugPosChip{font-family:monospace; width:160px; flex-shrink:0; text-align:center}
.legend{display:flex;gap:8px;flex-wrap:wrap;margin-left:auto}
.tag{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border:1px solid var(--edge);border-radius:999px;font-size:12px;background:#0e141b}
.tag .dot{width:10px;height:10px;border-radius:50%}

    /* Segmented LED dB meter */
    /* Top-bar dB meter (primary) */
    #dbMeterTop{display:flex;gap:2px;height:14px;align-items:flex-end;margin-left:12px;position:relative;padding:0 2px;border:1px solid var(--edge);border-radius:4px;overflow:hidden;background:linear-gradient(90deg,#124,#124 5%,#135 5%,#135 20%,#145 20%,#145 40%,#254 40%,#352 60%,#542 80%,#731 90%,#921 95%,#b11);background-size:100% 100%;}
    .bar{width:6px;height:100%;background:linear-gradient(to top,var(--bar-color,#175030),var(--bar-color,#175030));flex:0 0 auto;opacity:.25;border-radius:2px;position:relative;transition:opacity .12s linear, filter .2s ease}
    .bar.on{opacity:1;filter:brightness(1.15)}
    /* Peak hold indicator */
    #dbMeterTop .peak-marker{position:absolute;top:-3px;height:3px;width:6px;background:#fff;border-radius:1px;box-shadow:0 0 4px rgba(255,255,255,.6);opacity:.85;transition:transform .08s linear, opacity .3s ease, background-color .15s linear, box-shadow .15s linear;}

    /* app contains sidebar + main viewer; topbar is outside .app in the DOM, so keep rows out of this grid */
    .app{display:grid;grid-template-columns:var(--sidebar-w) 1fr;flex:1 1 auto;min-height:0}
    .sidebar{width:var(--sidebar-w)}
    .statusbar{height:var(--statusbar-h);box-sizing:border-box}
    .panel{padding:16px;border-right:1px solid var(--edge);overflow:auto;background:var(--card);min-height:0}
    .panel h2{margin:0 0 12px;font-size:18px}
    .panel .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    /* buttons/inputs: consistent radius and rhythm (multiples of 4/8) */
    :root{ --btn-radius: .5rem; }
    button,select,input[type="number"],input[type="text"]{background:#0e141b;color:var(--fg);border:1px solid var(--edge);padding:8px 12px;border-radius:var(--btn-radius);cursor:pointer}

    /* subtle focus ring for keyboard accessibility */
    button:focus, input:focus, select:focus, textarea:focus{ outline:2px solid rgba(255,255,255,.08); outline-offset:2px; }
    button:focus-visible{ outline:2px solid rgba(255,255,255,.3); }

    /* hover/active transitions for smoothness */
    button, .chip, input, select, textarea{ transition: all 0.1s ease-out; }

    /* Make the Auto-scroll speed input easier to adjust with mouse/touch
       - slightly wider for click targets
       - larger font for readability
       - horizontal-resize cursor to hint at drag/adjust behavior */
    #autoSpeed{
        width:110px;
        padding-left:12px;
        padding-right:12px;
        font-size:15px;
        cursor:ew-resize;
    }
    button:disabled{opacity:.5;cursor:not-allowed}
    /* Emphasized primary action button */
    .btn-primary{font-size:16px;padding:10px 14px;border-radius:12px;font-weight:600}
    .btn-start{background:#0e2534;border-color:#2b90ff;color:#cfe8ff;box-shadow:0 0 0 1px #2b90ff55 inset}
    .btn-start:hover{background:#0f2b3d}
    .btn-stop{background:#2b0e11;border-color:#ff5353;color:#ffd6d6;box-shadow:0 0 0 1px #ff535355 inset}
    .btn-stop:hover{background:#351015}
    .btn-subtle{opacity:.9}
    textarea{width:100%;min-height:160px;background:#0e141b;color:var(--fg);border:1px solid var(--edge);border-radius:12px;padding:12px}
    .status{font-size:12px;color:var(--muted)}
    .timer{font-variant-numeric:tabular-nums;font-size:28px;margin:0 0 0 8px}

    .viewer{position:relative;overflow:auto;min-height:0}
    .script{max-width:900px;margin:0 auto;padding:40px}
    .script p{font-size:48px;line-height:1.35;margin:0 0 28px}
    .u{ text-decoration: underline; }
.note{ color: var(--muted); font-style: italic; margin:0 0 28px }

    .marker{position:sticky;top:40%;height:2px;background:var(--accent);box-shadow:0 0 6px var(--accent)}

    body.listening .script p{ color:#cfe8ff; }
    body.listening .marker{ background:#9bd2ff; box-shadow:0 0 10px #9bd2ff; }
    body.listening .topbar{ box-shadow:0 2px 0 rgba(124,196,255,.35) inset; }
    /* Make record button clearly red while listening */
    body.listening #recBtn{ background:#c81919; color:#fff; border-color:#ff6969; box-shadow:0 0 0 1px #ff696955 inset; }
    body.listening #recBtn:hover{ background:#b31818; }

    @supports(height: 100dvh){ body{ min-height:100dvh; } }

    /* Camera overlay - fixed to viewport so it doesn't scroll with the script */
    .camWrap{ position:fixed; right:16px; bottom:16px; width:280px; aspect-ratio:16/9; border:1px solid var(--edge); border-radius:12px; overflow:hidden; box-shadow:0 6px 22px rgba(0,0,0,.45); background:#000; opacity:1; z-index:20; display:none; }
    .camWrap.mirrored video{ transform: scaleX(-1); }
    .camWrap video{ width:100%; height:100%; object-fit:cover; display:block; aspect-ratio:16/9 }
    .toolbar{display:flex;gap:6px;flex-wrap:wrap}
.toolbar button{font-size:6px;padding:6px 8px}

/* OBS toggle */
.obs-toggle-label{display:flex;align-items:center;gap:6px}
.obs-status{opacity:.75}
.obs-url{min-width:210px}
.obs-pass{min-width:140px}
.settings-sheet{max-width:860px}
/* Target the sheet element itself (markup uses <div class="sheet settings-sheet">)
    and keep overscroll contained so switching tabs doesn't cause viewport scroll.
*/
.overlay .sheet.settings-sheet{max-height:80vh; overflow-y:auto; overscroll-behavior:contain}
.settings-body{display:flex;flex-direction:column;gap:18px; min-height:340px}
@media (max-height:740px){ .settings-body{min-height:300px} }
.settings-title{margin:0}
.settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
.settings-card{border:1px solid var(--edge);padding:14px 16px;border-radius:14px;background:#0e141b;display:flex;flex-direction:column;gap:10px}
.settings-card h4{margin:0 0 4px;font-size:15px}
.settings-small{font-size:12px;color:var(--muted)}
.settings-inline-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.settings-tabs{display:flex;gap:6px;margin:4px 0 4px;flex-wrap:wrap}
.settings-tab{background:#0e141b;border:1px solid var(--edge);padding:6px 10px;border-radius:20px;font-size:12px;cursor:pointer}
.settings-tab.active{background:#12202a;color:var(--accent);border-color:var(--accent)}
.settings-footer{margin-top:8px;opacity:.7;text-align:right}
/* Settings card animations */
@keyframes cardFadeIn { from { opacity:0; transform:translateY(4px); } to { opacity:1; transform:translateY(0); } }
@keyframes cardFadeOut { from { opacity:1; transform:translateY(0); } to { opacity:0; transform:translateY(4px); } }
.anim-in{animation:cardFadeIn .22s ease-out;}
.anim-out{animation:cardFadeOut .18s ease-in;}

/* Sidebar hint for relocated media/OBS controls */
.sidebar-hint{flex:1 1 100%;text-align:left;opacity:.75}

/* Disable browser smooth scrolling for live-follow (always snap immediately) */
#viewer, #scriptScrollContainer { scroll-behavior: auto !important; }

/* Subtle CK watermark */
body.ck::after{
    content:"CK";
    position:fixed; left:10px; bottom:10px; z-index:9999;
    font:600 11px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    letter-spacing:2px;
    color:#d67d2d; opacity:.18;
    pointer-events:none;
}

/* Mirror mode for teleprompter */
.mirror .viewer{ transform: scaleX(-1); }

/* Toast system */
.tp-toast-container{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:8px;z-index:2147483646;max-width:320px}
.tp-toast{background:#0e141b;border:1px solid var(--edge);color:var(--fg);padding:10px 12px;border-radius:8px;box-shadow:0 8px 20px rgba(0,0,0,.6);opacity:0;transform:translateY(6px) scale(.99);transition:all 0.1s ease-out}
.tp-toast.show{opacity:1;transform:translateY(0) scale(1)}
.tp-toast.warn{border-color:#E0A43C}
.tp-toast.error{border-color:#E03E3E}
.tp-toast.ok{border-color:#3CE07A}

/* status color tokens for chips */
.chip.rec-recording{background:#3e0b0b;color:#ffd6d6;border-color:#E03E3E}
.chip.obs-connected{background:#06371a;color:#dfffe8;border-color:#3CE07A}
.chip.obs-reconnecting{background:#31250f;color:#fff6e8;border-color:#E0A43C}
.chip.idle{background:#0e141b;color:var(--muted);border-color:var(--edge)}

/* Inline OBS test message */
.obs-test-msg{font-size:13px;padding:6px 8px;border-radius:8px}
.obs-test-ok{background:rgba(56,161,105,0.08);color:#b7f4c9;border:1px solid rgba(56,161,105,0.18)}
.obs-test-error{background:rgba(224,62,62,0.06);color:#ffd6d6;border:1px solid rgba(224,62,62,0.12)}
