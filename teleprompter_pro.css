/* Overlay sheet */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:flex-start;justify-content:center;padding:40px;z-index:9999}
.overlay.hidden{display:none}
.overlay .sheet{background:#0e141b;border:1px solid #1f2937;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.5);max-width:720px;width:100%;padding:20px}
.sheet-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.shortcuts-grid{display:grid;grid-template-columns:180px 1fr;gap:10px 16px;margin:8px 0 12px}
.shortcuts-grid .dim,.dim{opacity:.7}
kbd{display:inline-block;min-width:1.6em;padding:.15em .45em;border:1px solid #374151;border-bottom-width:2px;border-radius:6px;background:#111827;color:#e5e7eb;font:12px/1.2 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;text-align:center}
.btn-chip{background:#0e141b;border:1px solid var(--edge);padding:8px 10px;border-radius:10px;cursor:pointer;color:var(--fg)}
.btn-chip:hover{background:#10161d}
.sheet-section{margin-top:12px;padding-top:8px;border-top:1px solid var(--edge)}
#validatePanel pre{white-space:pre-wrap;-webkit-user-select:text;user-select:text;margin-top:8px;background:#0e141b;color:var(--fg);border:1px solid var(--edge);border-radius:12px;padding:12px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;font-size:13px;line-height:1.4;max-height:40vh;overflow:auto}

/* Savanna theme (subtle, non-intrusive) */
body.savanna { --edge:#a9763a; }
body.savanna::before{
    content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
    background:
        radial-gradient(1200px 800px at 85% -10%, rgba(214,125,45,.08), transparent 70%),
        radial-gradient(900px 600px at -10% 110%, rgba(194,59,34,.06), transparent 70%);
}
body.savanna::after{
    content:""; position:fixed; right:6%; bottom:6%; width:160px; height:160px;
    background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220' viewBox='0 0 220 220'%3E%3Cg fill='%23d67d2d' fill-opacity='.10'%3E%3Ccircle cx='60' cy='60' r='28'/%3E%3Ccircle cx='115' cy='50' r='24'/%3E%3Ccircle cx='160' cy='75' r='22'/%3E%3Ccircle cx='85' cy='110' r='26'/%3E%3Cellipse cx='120' cy='155' rx='55' ry='36'/%3E%3C/g%3E%3C/svg%3E") center/contain no-repeat;
    filter: drop-shadow(0 2px 8px rgba(0,0,0,.2));
    pointer-events:none;
}

/* dB meter party mode */
#dbMeter.party .bar { animation: meterPulse 900ms linear infinite alternate; }
@keyframes meterPulse { from { opacity:.6 } to { opacity:1 } }
.section-title {
    display: flex;
    align-items: center;
    gap: 10px;
}
select { font-size: 14px; }
.select-lg { font-size: 16px; }
.select-sm { font-size: 12px; }
    .select-md { font-size: 14px; }  /* tweak to taste */
    .hidden { display: none !important; }

/* Inline utility classes (deduped & merged) */
.inl-x3{font-variant-numeric:tabular-nums;font-size:64px;line-height:1;margin-top:6px;min-width:200px}
.inl-x2{font-size:14px;color:#96a0aa;margin-top:16px}
/* For .inl-x1 two different min-widths appeared (200px, 240px); using the larger for layout safety */
.inl-x1{min-width:240px}
/* Inline style extractions (pass) */
.inl-x7{font-size:14px;color:#96a0aa}
/* Inline style extractions (pass) */
.inl-x6{background:#0e141b;border:1px solid var(--edge);padding:24px 32px;border-radius:16px;text-align:center}
/* Inline style extractions (pass) */
.inl-x5{min-width:200px}
/* Inline style extractions (pass) */
.inl-x4{display:none}
/* (Removed duplicate .inl-x1/.inl-x2/.inl-x3 definitions) */
/* Inline style extractions */
.inl-1{border:1px solid var(--edge); padding:4px 10px; border-radius:10px; background:#0e141b; color:var(--fg); margin-left:auto}
.inl-2{min-width:240px}
.inl-3{margin-top:16px}
.inl-4{min-width:200px}
.inl-5{display:none}
.inl-6{min-width:200px}
.inl-7{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:9999}
.inl-8{background:#0e141b;border:1px solid var(--edge);padding:24px 32px;border-radius:16px;text-align:center}
.inl-9{font-size:14px;color:#96a0aa}
.inl-10{font-variant-numeric:tabular-nums;font-size:64px;line-height:1;margin-top:6px}


    :root{ --bg:#0b0d10; --fg:#e7ebf0; --muted:#96a0aa; --accent:#7cc4ff; --card:#151a20; --edge:#22303d; --s1-color:#2ea8ff; --s2-color:#ff6b6b; }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";min-height:100svh;min-height:100dvh;display:flex;flex-direction:column}

    .topbar{display:flex;align-items:center;gap:10px;position:sticky;top:0;background:linear-gradient(var(--bg),transparent);padding:8px 16px;border-bottom:1px solid var(--edge);z-index:10}
    .topbar strong{letter-spacing:.2px}
    .chip{font-size:12px;color:var(--muted)}
.legend{display:flex;gap:8px;flex-wrap:wrap;margin-left:auto}
.tag{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border:1px solid var(--edge);border-radius:999px;font-size:12px;background:#0e141b}
.tag .dot{width:10px;height:10px;border-radius:50%}

    /* Segmented LED dB meter */
    /* Top-bar dB meter (primary) */
    #dbMeterTop{display:flex;gap:2px;height:14px;align-items:flex-end;margin-left:12px;position:relative;padding:0 2px;border:1px solid var(--edge);border-radius:4px;overflow:hidden;background:linear-gradient(90deg,#124,#124 5%,#135 5%,#135 20%,#145 20%,#145 40%,#254 40%,#352 60%,#542 80%,#731 90%,#921 95%,#b11);background-size:100% 100%;}
    .bar{width:6px;height:100%;background:linear-gradient(to top,var(--bar-color,#175030),var(--bar-color,#175030));flex:0 0 auto;opacity:.25;border-radius:2px;position:relative;transition:opacity .12s linear, filter .2s ease}
    .bar.on{opacity:1;filter:brightness(1.15)}
    /* Peak hold indicator */
    #dbMeterTop .peak-marker{position:absolute;top:-3px;height:3px;width:6px;background:#fff;border-radius:1px;box-shadow:0 0 4px rgba(255,255,255,.6);opacity:.85;transition:transform .08s linear, opacity .3s ease, background-color .15s linear, box-shadow .15s linear;}

    .app{display:grid;grid-template-columns:320px 1fr;flex:1 1 auto;min-height:0}
    .panel{padding:16px;border-right:1px solid var(--edge);overflow:auto;background:var(--card);min-height:0}
    .panel h2{margin:0 0 12px;font-size:18px}
    .panel .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    button,select,input[type="number"],input[type="text"]{background:#0e141b;color:var(--fg);border:1px solid var(--edge);padding:8px 10px;border-radius:10px;cursor:pointer}
    button:disabled{opacity:.5;cursor:not-allowed}
    textarea{width:100%;min-height:160px;background:#0e141b;color:var(--fg);border:1px solid var(--edge);border-radius:12px;padding:12px}
    .status{font-size:12px;color:var(--muted)}
    .timer{font-variant-numeric:tabular-nums;font-size:28px;margin:8px 0}

    /* Primary speech sync button — larger and more prominent */
    #recBtn{
        font-size:16px;
        font-weight:700;
        padding:12px 16px;
        border-radius:12px;
        min-width:240px;
        background:var(--accent);
        color:#07131c;
        border-color:var(--accent);
        box-shadow:0 2px 0 rgba(124,196,255,.35), 0 8px 20px rgba(124,196,255,.18);
        transition:filter .12s ease, box-shadow .15s ease;
    }
    #recBtn:hover{ filter:brightness(1.05); box-shadow:0 2px 0 rgba(124,196,255,.45), 0 10px 24px rgba(124,196,255,.22); }
    #recBtn:disabled{ opacity:.6; filter:none; box-shadow:none; }
    /* When listening, flip to a strong danger accent to emphasize Stop */
    body.listening #recBtn{
        background:#ff6b6b;
        border-color:#ff6b6b;
        color:#1b0a0a;
        box-shadow:0 2px 0 rgba(255,107,107,.35), 0 8px 20px rgba(255,107,107,.2);
    }

    .viewer{position:relative;overflow:auto;min-height:0}
    .script{max-width:900px;margin:0 auto;padding:40px}
        .script p{font-size:48px;line-height:1.35;margin:0 0 28px}
        /* Default: enable snapping for all script paragraphs, but only inside the viewer */
        .viewer .script { --anchor-snap: 45vh; }
        .viewer .script p { scroll-margin-block: var(--anchor-snap); }

        /* Toggle to “active only” mode at runtime */
        .viewer .script.snap-active-only p { scroll-margin-block: 0; }
        .viewer .script.snap-active-only p.active,
        .viewer .script.snap-active-only p.anchor {
            scroll-margin-block: var(--anchor-snap);
        }

        /* Safety: if we ever need to disable snapping entirely */
        .viewer .script.no-snap p { scroll-margin-block: 0; }

/* Live-hydrated teleprompter variables */
.viewer{
    --viewer-active-bg:        transparent;
    --viewer-inactive-opacity: 1;
    --viewer-font-size:        18px;
    --viewer-line-height:      1.5;
    --viewer-scroll-margin-top:140px;
    --viewer-anchor-padding:   0px;

    font-size: var(--viewer-font-size);
    line-height: var(--viewer-line-height);
}

/* Visual rules driven by settings */
.script p{ scroll-margin-top: var(--viewer-scroll-margin-top); }
.script p.anchor{ padding-top: var(--viewer-anchor-padding); }
/* When highlighting is enabled, underline the active paragraph instead of boxing it */
.viewer.highlight-on .script p.active{
    background: none;
    text-decoration: underline;
    text-decoration-thickness: 0.1em;
    text-underline-offset: 6px;
}
.script p:not(.active){
    opacity: var(--viewer-inactive-opacity);
    transition: opacity .12s ease;
}

/* Default: when highlight is off, keep active paragraphs without extra decoration */
.viewer:not(.highlight-on) .script p.active{
    background: none;
    text-decoration: none;
}

/* Optional snap-active-only mode */
.viewer.snap-only .script p:not(.active){
    opacity: var(--viewer-inactive-opacity, .4);
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
    .script p:not(.active){ transition: none; }
}
    .u{ text-decoration: underline; }
.note{ color: var(--muted); font-style: italic; margin:0 0 28px }

    .marker{position:sticky;top:40%;height:2px;background:var(--accent);box-shadow:0 0 6px var(--accent)}
    /* Bottom spacer: gives marker headroom near end without relying only on padding */
    #end-spacer{ height: 50vh; min-height: 280px; pointer-events:none; }

    body.listening .script p{ color:#cfe8ff; }
    body.listening .marker{ background:#9bd2ff; box-shadow:0 0 10px #9bd2ff; }
    body.listening .topbar{ box-shadow:0 2px 0 rgba(124,196,255,.35) inset; }

    @supports(height: 100dvh){ body{ min-height:100dvh; } }

    /* Camera overlay */
    .camWrap{ position:absolute; right:16px; bottom:16px; width:280px; aspect-ratio:16/9; border:1px solid var(--edge); border-radius:12px; overflow:hidden; box-shadow:0 6px 22px rgba(0,0,0,.45); background:#000; opacity:1; z-index:20; display:none; }
    .camWrap.mirrored video{ transform: scaleX(-1); }
    .camWrap video{ width:100%; height:100%; object-fit:cover; display:block; }
    .toolbar{display:flex;gap:6px;flex-wrap:wrap}
.toolbar button{font-size:6px;padding:6px 8px}

/* OBS toggle */
.obs-toggle-label{display:flex;align-items:center;gap:6px}
.obs-status{opacity:.75}
.obs-url{min-width:210px}
.obs-pass{min-width:140px}
/* Settings overlay */
.settings-sheet{max-width:860px}
.settings-title{margin:0}
.settings-body{display:flex;flex-direction:column;gap:18px}
.settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
.settings-card{border:1px solid var(--edge);padding:14px 16px;border-radius:14px;background:#0e141b;display:flex;flex-direction:column;gap:10px}
.settings-card h4{margin:0 0 4px;font-size:15px}
.settings-small{font-size:12px;color:var(--muted)}
.settings-inline-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.settings-tabs{display:flex;gap:6px;margin:4px 0 4px;flex-wrap:wrap}
.settings-tab{background:#0e141b;border:1px solid var(--edge);padding:6px 10px;border-radius:20px;font-size:12px;cursor:pointer}
.settings-tab.active{background:#12202a;color:var(--accent);border-color:var(--accent)}
.settings-footer{margin-top:8px;opacity:.7;text-align:right}
/* Settings card animations */
@keyframes cardFadeIn { from { opacity:0; transform:translateY(4px); } to { opacity:1; transform:translateY(0); } }
@keyframes cardFadeOut { from { opacity:1; transform:translateY(0); } to { opacity:0; transform:translateY(4px); } }
.anim-in{animation:cardFadeIn .22s ease-out;}
.anim-out{animation:cardFadeOut .18s ease-in;}

/* Sidebar hint for relocated media/OBS controls */
.sidebar-hint{flex:1 1 100%;text-align:left;opacity:.75}

/* Disable browser smooth scrolling for live-follow (always snap immediately) */
#viewer, #scriptScrollContainer { scroll-behavior: auto !important; }

/* Disable browser “helpful” scrolling + smooth behavior globally */
html, body, #viewer {
    scroll-behavior: auto !important;
    overflow-anchor: none !important;
}

/* visual stability in the scroller */
#viewer{
    /* stop scroll chaining into parent */
    overscroll-behavior: contain;
    /* prevent reflow when scrollbar appears/disappears */
    scrollbar-gutter: stable;
}

/* Subtle CK watermark */
body.ck::after{
    content:"CK";
    position:fixed; left:10px; bottom:10px; z-index:9999;
    font:600 11px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    letter-spacing:2px;
    color:#d67d2d; opacity:.18;
    pointer-events:none;
}
