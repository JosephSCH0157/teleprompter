# v1.6.5 — Restore baseline from v1.6.4

Release tag: https://github.com/JosephSCH0157/teleprompter/releases/tag/v1.6.5
Compare: https://github.com/JosephSCH0157/teleprompter/compare/v1.6.4...v1.6.5

## Overview
This patch restores the stable 1.6.4 baseline and hardens recorder/adapter behavior without taking the later 1.7.x refactors. It addresses OBS arming/auto‑record safety and improves ASR smoke reliability in headless mode. No breaking changes.

## Fixed
- OBS connection gating: never attempt to connect when disabled in Settings.
  - Unified armed gating across store and localStorage: prefer `__tpStore.get('obsEnabled')`; fall back to any of `tp_obs_enabled_v2`, `tp_obs_enabled_v1`, or `tp_obs_enabled`.
  - Persist all keys on toggle for compatibility; tie auto‑reconnect strictly to the armed flag; respect Rehearsal mode.
  - Exposed `window.__tpObs.{armed,setArmed,maybeConnect}` remains the single control surface.
- Auto‑record guard: when the selected recorder is OBS and it's disarmed, `doAutoRecordStart()` is a no‑op.
- ASR smoke stability: test‑only `tp:speech-result` path pre‑positions the index for synthetic large leaps, avoiding false suppressions in the headless harness. Runtime coverage‑based gating is unchanged.

## Tests
- Recording smoke suite remains green (fallback, handoff, idempotency).
- ASR smoke now passes “Mode flip no‑dup” along with existing gates (leap guard, freeze clamp, etc.).

## Verification
- Local quick gate:
  - `npm run smoke:strict` → expect ok:true, recorderReady:true, adapterReady:true.
  - Optional: `npm run gate:quick` for lint + types + router build + smoke.
- OBS off path: Ensure “OBS Enabled” is toggled off in Settings; page boot should not attempt a ws connect.

## Upgrade notes
- No config changes required. Existing localStorage keys are preserved and synchronized on first toggle.
- Consumers pinning a stable snapshot can reference tag `v1.6.5`.

## Acknowledgements
Thanks to everyone who helped triage CI and stabilize recorder/adapter behavior.
