{
  "version": 3,
  "sources": ["../scroll/scroll-writer.ts", "../features/scroll/scroll-prefs.ts", "../state/app-store.ts", "asr-legacy.ts"],
  "sourcesContent": ["// Central scroll writer shim.\n// All code that moves the main script viewport should route through this helper.\n\nexport interface ScrollWriter {\n  /** Absolute scroll in CSS px from top of script viewport. */\n  scrollTo(top: number, opts?: { behavior?: ScrollBehavior }): void;\n  /** Relative scroll in CSS px. Positive -> move text up (scroll down). */\n  scrollBy(delta: number, opts?: { behavior?: ScrollBehavior }): void;\n  /** Ensure a given y is visible (best-effort). */\n  ensureVisible?(top: number, paddingPx?: number): void;\n}\n\nlet cached: ScrollWriter | null = null;\nlet warned = false;\n\nexport function getScrollWriter(): ScrollWriter {\n  if (cached) return cached;\n\n  if (typeof window !== 'undefined') {\n    const maybe = (window as any).__tpScrollWrite;\n    if (typeof maybe === 'function') {\n      const fn = maybe as (_top: number) => void;\n      const getScroller = () =>\n        (document.getElementById('scriptScrollContainer') as HTMLElement | null) ||\n        (document.getElementById('viewer') as HTMLElement | null) ||\n        (document.scrollingElement as HTMLElement | null) ||\n        (document.documentElement as HTMLElement | null) ||\n        (document.body as HTMLElement | null);\n      cached = {\n        scrollTo(top: number) {\n          try { fn(top); } catch {}\n        },\n        scrollBy(delta: number) {\n          try {\n            const sc = getScroller();\n            const cur = sc ? (sc.scrollTop || 0) : 0;\n            fn(cur + (Number(delta) || 0));\n          } catch {}\n        },\n        ensureVisible(_top: number, _paddingPx?: number) {\n          // not supported for bare function writers\n        },\n      };\n      return cached;\n    }\n    if (maybe && typeof maybe === 'object') {\n      const w = maybe as { scrollTo?: (_top: number, _opts?: any) => void; scrollBy?: (_delta: number, _opts?: any) => void; ensureVisible?: (_top: number, _pad?: number) => void };\n      if (typeof w.scrollTo === 'function' && typeof w.scrollBy === 'function') {\n        const writerImpl = w as { scrollTo: (_top: number, _opts?: any) => void; scrollBy: (_delta: number, _opts?: any) => void; ensureVisible?: (_top: number, _pad?: number) => void };\n        cached = {\n          scrollTo(top: number, opts?: { behavior?: ScrollBehavior }) {\n            try { writerImpl.scrollTo(top, opts); } catch {}\n          },\n          scrollBy(delta: number, opts?: { behavior?: ScrollBehavior }) {\n            try { writerImpl.scrollBy(delta, opts); } catch {}\n          },\n          ensureVisible(top: number, paddingPx = 80) {\n            try {\n              if (typeof writerImpl.ensureVisible === 'function') {\n                writerImpl.ensureVisible(top, paddingPx);\n              } else {\n                writerImpl.scrollTo(Math.max(0, top - paddingPx), { behavior: 'auto' });\n              }\n            } catch {}\n          },\n        };\n        return cached;\n      }\n    }\n  }\n\n  if (!warned) {\n    if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n      try { console.warn('[scroll-writer] __tpScrollWrite missing or incomplete; scroll commands are no-ops.'); } catch {}\n    }\n    warned = true;\n  }\n\n  // No-op writer when SSOT writer is absent; avoids DOM fallbacks.\n  cached = {\n    scrollTo() { /* no-op: writer missing */ },\n    scrollBy() { /* no-op: writer missing */ },\n    ensureVisible() { /* no-op: writer missing */ },\n  };\n  return cached;\n}\n", "// src/features/scroll/scroll-prefs.ts\n// Tiny helper to persist scroll mode prefs alongside the TS store.\n\nexport type ScrollModePref = 'hybrid' | 'timed' | 'wpm' | 'asr' | 'step' | 'rehearsal';\n\nexport interface ScrollPrefs {\n  mode?: ScrollModePref;\n}\n\nexport interface ScrollStoreLike {\n  get?<T = unknown>(key: string): T;\n  set?<T = unknown>(key: string, value: T): T;\n  subscribe?<T = unknown>(key: string, fn: (value: T) => void): () => void;\n}\n\nconst CANONICAL_KEY = 'scrollMode';\nconst LEGACY_KEYS = ['tp_scroll_prefs_v1', 'tp_scroll_mode_v1', 'tp_scroll_mode'];\n\nfunction normalizeMode(mode: string | null | undefined): ScrollModePref | null {\n  const v = String(mode || '').toLowerCase();\n  if (v === 'manual') return 'step';\n  const allowed: ScrollModePref[] = ['hybrid', 'timed', 'wpm', 'asr', 'step', 'rehearsal'];\n  return allowed.includes(v as ScrollModePref) ? (v as ScrollModePref) : null;\n}\n\nfunction safeParse(raw: string | null): ScrollPrefs | null {\n  if (!raw) return null;\n  try {\n    const parsed = JSON.parse(raw);\n    if (!parsed || typeof parsed !== 'object') return null;\n    const normalized = normalizeMode((parsed as any).mode);\n    if (!normalized) return null;\n    return { mode: normalized };\n  } catch {\n    return null;\n  }\n}\n\nfunction readLegacyMode(key: string, raw: string | null): ScrollModePref | null {\n  if (!raw) return null;\n  if (key === 'tp_scroll_prefs_v1') {\n    return safeParse(raw)?.mode ?? null;\n  }\n  return normalizeMode(raw);\n}\n\nfunction cleanLegacyKeys(storage: Storage) {\n  LEGACY_KEYS.forEach((key) => {\n    try { storage.removeItem(key); } catch {}\n  });\n}\n\nfunction migrateLegacyScrollMode(): ScrollModePref | null {\n  if (typeof window === 'undefined') return null;\n  try {\n    const storage = window.localStorage;\n    const canonical = normalizeMode(storage.getItem(CANONICAL_KEY));\n    if (canonical) {\n      cleanLegacyKeys(storage);\n      return canonical;\n    }\n    for (const key of LEGACY_KEYS) {\n      const legacy = readLegacyMode(key, storage.getItem(key));\n      if (legacy) {\n        storage.setItem(CANONICAL_KEY, legacy);\n        cleanLegacyKeys(storage);\n        return legacy;\n      }\n    }\n    cleanLegacyKeys(storage);\n  } catch {\n    // swallow storage/migration failures\n  }\n  return null;\n}\n\nexport function loadScrollPrefs(): ScrollPrefs | null {\n  try {\n    if (typeof window === 'undefined') return null;\n    const mode = migrateLegacyScrollMode();\n    if (!mode) return null;\n    return { mode };\n  } catch {\n    return null;\n  }\n}\n\nexport function saveScrollPrefs(next: ScrollPrefs): void {\n  try {\n    if (typeof window === 'undefined') return;\n    const normalized = normalizeMode(next?.mode || null);\n    if (!normalized) return;\n    window.localStorage.setItem(CANONICAL_KEY, normalized);\n    cleanLegacyKeys(window.localStorage);\n  } catch {\n    // storage failures are non-fatal\n  }\n}\n\nexport function initScrollPrefsPersistence(store: ScrollStoreLike | undefined | null): void {\n  if (!store) return;\n\n  const fromStore = normalizeMode(store.get?.('scrollMode') as string | undefined);\n  const persisted = normalizeMode(loadScrollPrefs()?.mode);\n  const initial = normalizeMode(fromStore || persisted || 'hybrid') || 'hybrid';\n\n  try {\n    if (!fromStore || fromStore !== initial) {\n      store.set?.('scrollMode', initial as any);\n    }\n  } catch {\n    // ignore\n  }\n\n  try {\n    store.subscribe?.('scrollMode', (mode: any) => {\n      const normalized = normalizeMode(mode);\n      if (normalized) saveScrollPrefs({ mode: normalized });\n    });\n  } catch {\n    // ignore\n  }\n}\n", "// Minimal app store for centralizing Settings and small app state.\n// Exposes window.__tpStore with get/set/subscribe and automatic persistence for a few keys.\nimport { loadScrollPrefs, saveScrollPrefs } from '../features/scroll/scroll-prefs';\n\nconst IS_TEST = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\n\nconst DEVICE_KEY = 'tp_mic_device_v1';\nconst OBS_ENABLED_KEY = 'tp_obs_enabled';\nconst OBS_HOST_KEY = 'tp_obs_host';\nconst OBS_PASSWORD_KEY = 'tp_obs_password';\nconst OBS_SCENE_KEY = 'tp_obs_scene';\nconst OBS_RECONNECT_KEY = 'tp_obs_reconnect';\nconst AUTO_RECORD_KEY = 'tp_auto_record_on_start_v1';\nconst LEGACY_AUTO_RECORD_KEY = 'tp_auto_record';\nconst PREROLL_SEC_KEY = 'tp_preroll_seconds';\nconst DEV_HUD_KEY = 'tp_dev_hud';\nconst SETTINGS_TAB_KEY = 'tp_settings_tab';\nconst LEGACY_ASR_SETTINGS_KEY = 'tp_asr_settings_v1';\nconst ASR_ENGINE_KEY = 'tp_asr_engine_v1';\nconst ASR_LANG_KEY = 'tp_asr_language_v1';\nconst ASR_INTERIM_KEY = 'tp_asr_interim_v1';\nconst ASR_FILTER_KEY = 'tp_asr_filter_v1';\nconst ASR_THRESHOLD_KEY = 'tp_asr_threshold_v1';\nconst ASR_ENDPOINT_KEY = 'tp_asr_endpoint_v1';\nconst ASR_PROFILES_KEY = 'tp_asr_profiles_v1';\nconst ASR_ACTIVE_PROFILE_KEY = 'tp_asr_active_profile_v1';\n\n// Scroll router keys\nconst SCROLL_MODE_KEY = 'scrollMode';\nconst TIMED_SPEED_KEY = 'tp_scroll_timed_speed_v1';\nconst WPM_TARGET_KEY = 'tp_scroll_wpm_target_v1';\nconst WPM_BASEPX_KEY = 'tp_scroll_wpm_basepx_v1';\nconst WPM_MINPX_KEY = 'tp_scroll_wpm_minpx_v1';\nconst WPM_MAXPX_KEY = 'tp_scroll_wpm_maxpx_v1';\nconst WPM_EWMA_KEY = 'tp_scroll_wpm_ewma_v1';\nconst HYB_ATTACK_KEY = 'tp_scroll_hybrid_attack_v1';\nconst HYB_RELEASE_KEY = 'tp_scroll_hybrid_release_v1';\nconst HYB_IDLE_KEY = 'tp_scroll_hybrid_idle_v1';\nconst STEP_PX_KEY = 'tp_scroll_step_px_v1';\nconst REH_PUNCT_KEY = 'tp_scroll_reh_punct_v1';\nconst REH_RESUME_KEY = 'tp_scroll_reh_resume_v1';\nconst ALLOWED_PAGES = new Set<PageName>(['scripts']);\nconst ALLOWED_OVERLAYS = new Set<AppStoreState['overlay']>(['none', 'settings', 'help', 'shortcuts']);\nconst HUD_ENABLED_KEY = 'tp_hud_enabled_v1';\nconst HUD_SPEECH_NOTES_KEY = 'tp_hud_speech_notes_v1';\nconst OVERLAY_KEY = 'tp_overlay_v1';\nconst CAMERA_KEY = 'tp_camera_enabled_v1';\n\ntype SaveStatusState = 'idle' | 'saving' | 'saved' | 'failed';\n\nconst persistMap: Partial<Record<keyof AppStoreState, string>> = {\n  settingsTab: SETTINGS_TAB_KEY,\n  micDevice: DEVICE_KEY,\n  obsEnabled: OBS_ENABLED_KEY,\n  obsScene: OBS_SCENE_KEY,\n  obsReconnect: OBS_RECONNECT_KEY,\n  obsHost: OBS_HOST_KEY,\n  obsPassword: OBS_PASSWORD_KEY,\n  autoRecord: AUTO_RECORD_KEY,\n  prerollSeconds: PREROLL_SEC_KEY,\n  devHud: DEV_HUD_KEY,\n  hudEnabledByUser: HUD_ENABLED_KEY,\n  hudSpeechNotesEnabledByUser: HUD_SPEECH_NOTES_KEY,\n  overlay: OVERLAY_KEY,\n  cameraEnabled: CAMERA_KEY,\n  // Scroll router persistence\n  scrollMode: SCROLL_MODE_KEY,\n  timedSpeed: TIMED_SPEED_KEY,\n  wpmTarget: WPM_TARGET_KEY,\n  wpmBasePx: WPM_BASEPX_KEY,\n  wpmMinPx: WPM_MINPX_KEY,\n  wpmMaxPx: WPM_MAXPX_KEY,\n  wpmEwmaSec: WPM_EWMA_KEY,\n  hybridAttackMs: HYB_ATTACK_KEY,\n  hybridReleaseMs: HYB_RELEASE_KEY,\n  hybridIdleMs: HYB_IDLE_KEY,\n  stepPx: STEP_PX_KEY,\n  rehearsalPunct: REH_PUNCT_KEY,\n  rehearsalResumeMs: REH_RESUME_KEY,\n  'asr.engine': ASR_ENGINE_KEY,\n  'asr.language': ASR_LANG_KEY,\n  'asr.useInterimResults': ASR_INTERIM_KEY,\n  'asr.threshold': ASR_THRESHOLD_KEY,\n  'asr.endpointMs': ASR_ENDPOINT_KEY,\n  'asr.filterFillers': ASR_FILTER_KEY,\n  asrProfiles: ASR_PROFILES_KEY,\n  asrActiveProfileId: ASR_ACTIVE_PROFILE_KEY,\n};\n\nfunction parseJson<T>(value: string | null): T | null {\n  if (!value) return null;\n  try {\n    return JSON.parse(value) as T;\n  } catch {\n    return null;\n  }\n}\n\nfunction loadLegacyAsrSettings() {\n  try {\n    if (typeof window === 'undefined') return null;\n    const raw = window.localStorage.getItem(LEGACY_ASR_SETTINGS_KEY);\n    return parseJson<Partial<Record<string, any>>>(raw);\n  } catch {\n    return null;\n  }\n}\n\nexport type PageName = string;\n\ntype Subscriber<T = unknown> = (value: T) => void;\ntype SubscriptionMap = Record<string, Array<Subscriber<any>>>;\n\nexport type AppStoreState = {\n  // UI / Settings\n  settingsTab: string;\n  micDevice: string;\n  obsEnabled: boolean;\n  micGranted: boolean;\n  cameraEnabled: boolean;\n  cameraAvailable: boolean;\n  obsScene: string;\n  obsReconnect: boolean;\n  obsHost: string;\n  obsPassword: string;\n  autoRecord: boolean;\n  prerollSeconds: number;\n  devHud: boolean;\n  hudSupported: boolean;\n  hudEnabledByUser: boolean;\n  hudSpeechNotesEnabledByUser: boolean;\n  page: PageName;\n  overlay: 'none' | 'settings' | 'help' | 'shortcuts';\n  asrLive: boolean;\n  'asr.engine': string;\n  'asr.language': string;\n  'asr.useInterimResults': boolean;\n  'asr.filterFillers': boolean;\n  'asr.threshold': number;\n  'asr.endpointMs': number;\n  asrProfiles: Record<string, unknown>;\n  asrActiveProfileId: string | null;\n  asrLastAppliedAt: number;\n  asrLastAppliedSummary: Record<string, unknown>;\n  asrLastApplyOk: boolean;\n  settingsSaveStatus: {\n    state: SaveStatusState;\n    at: number;\n    error?: string;\n  };\n\n  // Scroll router (persisted)\n  scrollMode: string;\n  timedSpeed: number;\n  wpmTarget: number;\n  wpmBasePx: number;\n  wpmMinPx: number;\n  wpmMaxPx: number;\n  wpmEwmaSec: number;\n  hybridAttackMs: number;\n  hybridReleaseMs: number;\n  hybridIdleMs: number;\n  stepPx: number;\n  rehearsalPunct: string;\n  rehearsalResumeMs: number;\n\n  // transient session state (not persisted)\n  obsUrl: string;\n  obsPort: string;\n  obsSecure: boolean;\n\n  // fallthrough for any additional keys\n  [key: string]: unknown;\n};\n\nexport interface AppStore {\n  __tsOwned: true;\n  get<K extends keyof AppStoreState>(key: K): AppStoreState[K];\n  set<K extends keyof AppStoreState>(key: K, value: AppStoreState[K]): AppStoreState[K];\n  subscribe<K extends keyof AppStoreState>(key: K, fn: Subscriber<AppStoreState[K]>): () => void;\n  subscribeAll(map: Partial<Record<keyof AppStoreState, Subscriber<AppStoreState[keyof AppStoreState]>>>): () => void;\n  state: AppStoreState;\n  getSnapshot(): AppStoreState;\n}\n\ndeclare global {\n  interface Window {\n    __tpStore?: AppStore;\n  }\n}\n\nfunction migrateAutoRecordFlag() {\n  try {\n    const current = localStorage.getItem(AUTO_RECORD_KEY);\n    if (current !== null && typeof current !== 'undefined') {\n      if (localStorage.getItem(LEGACY_AUTO_RECORD_KEY) !== null) {\n        try {\n          localStorage.removeItem(LEGACY_AUTO_RECORD_KEY);\n        } catch {}\n      }\n      return;\n    }\n    const legacy = localStorage.getItem(LEGACY_AUTO_RECORD_KEY);\n    if (legacy !== null && typeof legacy !== 'undefined') {\n      localStorage.setItem(AUTO_RECORD_KEY, legacy === '1' ? '1' : '0');\n      try {\n        localStorage.removeItem(LEGACY_AUTO_RECORD_KEY);\n      } catch {}\n    }\n  } catch {}\n}\n\nmigrateAutoRecordFlag();\n\nfunction normalizeScrollMode(mode: string | null | undefined): string {\n  const v = String(mode || '').trim().toLowerCase();\n  if (!v) return 'hybrid';\n  if (v === 'manual') return 'step';\n  return v;\n}\n\nfunction readAndMigrateScrollMode(): string {\n  const legacyKeys = ['tp_scroll_mode', 'tp_scroll_mode_v1', 'tp_scroll_mode_v2', 'tp_scroll_mode_backup'];\n  try {\n    // Prefer canonical if present\n    const canonical = localStorage.getItem(SCROLL_MODE_KEY);\n    if (canonical) {\n      const norm = normalizeScrollMode(canonical);\n      if (norm !== canonical) localStorage.setItem(SCROLL_MODE_KEY, norm);\n      // Clear legacy keys if canonical exists\n      legacyKeys.forEach((k) => { try { localStorage.removeItem(k); } catch {} });\n      return norm;\n    }\n    // Otherwise migrate from any legacy key once\n    for (const k of legacyKeys) {\n      const legacy = localStorage.getItem(k);\n      if (legacy) {\n        const norm = normalizeScrollMode(legacy);\n        localStorage.setItem(SCROLL_MODE_KEY, norm);\n        try { localStorage.removeItem(k); } catch {}\n        return norm;\n      }\n    }\n  } catch {\n    // ignore\n  }\n  return 'hybrid';\n}\n\nfunction buildInitialState(): AppStoreState {\n  const legacyAsrSettings = loadLegacyAsrSettings();\n  return {\n    // UI / Settings\n    settingsTab: (() => {\n      try {\n        return localStorage.getItem(SETTINGS_TAB_KEY) || 'general';\n      } catch {\n        return 'general';\n      }\n    })(),\n    micDevice: (() => {\n      try {\n        return localStorage.getItem(DEVICE_KEY) || '';\n      } catch {\n        return '';\n      }\n    })(),\n    cameraEnabled: (() => {\n      try {\n        const raw = localStorage.getItem(CAMERA_KEY);\n        if (raw == null) return false;\n        return raw === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    cameraAvailable: false,\n    micGranted: false,\n    obsEnabled: (() => {\n      try {\n        return localStorage.getItem(OBS_ENABLED_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    obsScene: (() => {\n      try {\n        return localStorage.getItem(OBS_SCENE_KEY) || '';\n      } catch {\n        return '';\n      }\n    })(),\n    obsReconnect: (() => {\n      try {\n        return localStorage.getItem(OBS_RECONNECT_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    autoRecord: (() => {\n      try {\n        return localStorage.getItem(AUTO_RECORD_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    prerollSeconds: (() => {\n      try {\n        const n = parseInt(localStorage.getItem(PREROLL_SEC_KEY) || '3', 10);\n        return isFinite(n) ? Math.max(0, Math.min(10, n)) : 3;\n      } catch {\n        return 3;\n      }\n    })(),\n    devHud: (() => {\n      try {\n        return localStorage.getItem(DEV_HUD_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    hudSupported: true,\n    hudEnabledByUser: (() => {\n      try {\n        return localStorage.getItem(HUD_ENABLED_KEY) !== '0';\n      } catch {\n        return true;\n      }\n    })(),\n    hudSpeechNotesEnabledByUser: (() => {\n      try {\n        return localStorage.getItem(HUD_SPEECH_NOTES_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    asrLive: false,\n    'asr.engine': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_ENGINE_KEY);\n        if (raw) return raw;\n        if (legacyAsrSettings?.engine && typeof legacyAsrSettings.engine === 'string') {\n          return legacyAsrSettings.engine;\n        }\n      } catch {}\n      return 'webspeech';\n    })(),\n    'asr.language': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_LANG_KEY);\n        if (raw) return raw;\n        if (legacyAsrSettings?.lang && typeof legacyAsrSettings.lang === 'string') {\n          return legacyAsrSettings.lang;\n        }\n      } catch {}\n      return 'en-US';\n    })(),\n    'asr.useInterimResults': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_INTERIM_KEY);\n        if (raw !== null) return raw === '1';\n        if (legacyAsrSettings?.interim !== undefined) return !!legacyAsrSettings.interim;\n      } catch {}\n      return true;\n    })(),\n    'asr.filterFillers': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_FILTER_KEY);\n        if (raw !== null) return raw === '1';\n        if (legacyAsrSettings?.filterFillers !== undefined) return !!legacyAsrSettings.filterFillers;\n      } catch {}\n      return true;\n    })(),\n    'asr.threshold': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_THRESHOLD_KEY);\n        const num = Number(raw);\n        if (raw !== null && !Number.isNaN(num)) return num;\n        if (legacyAsrSettings?.threshold !== undefined) return Number(legacyAsrSettings.threshold) || 0.6;\n      } catch {}\n      return 0.6;\n    })(),\n    'asr.endpointMs': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_ENDPOINT_KEY);\n        const num = Number(raw);\n        if (raw !== null && !Number.isNaN(num)) return num;\n        if (legacyAsrSettings?.endpointMs !== undefined) return Number(legacyAsrSettings.endpointMs) || 700;\n      } catch {}\n      return 700;\n    })(),\n    asrProfiles: (() => {\n      try {\n        const raw = localStorage.getItem(ASR_PROFILES_KEY);\n        const parsed = parseJson<Record<string, unknown>>(raw);\n        if (parsed && typeof parsed === 'object') return parsed;\n      } catch {}\n      return {};\n    })(),\n    asrActiveProfileId: (() => {\n      try {\n        const raw = localStorage.getItem(ASR_ACTIVE_PROFILE_KEY);\n        if (raw) return raw;\n      } catch {}\n      return null;\n    })(),\n    asrLastAppliedAt: 0,\n    asrLastAppliedSummary: {},\n    asrLastApplyOk: false,\n    settingsSaveStatus: { state: 'idle', at: 0 },\n    overlay: (() => {\n      try {\n        const v = localStorage.getItem(OVERLAY_KEY) || 'none';\n        if (!ALLOWED_OVERLAYS.has(v as any)) {\n          try { localStorage.removeItem(OVERLAY_KEY); } catch {}\n          return 'none';\n        }\n        return v as any;\n      } catch {\n        return 'none';\n      }\n    })(),\n    page: (() => {\n      try {\n        const v = ('scripts') as PageName;\n        if (!ALLOWED_PAGES.has(v)) {\n          // page is no longer persisted\n          return 'scripts';\n        }\n        return v;\n      } catch {\n        return 'scripts';\n      }\n    })(),\n    obsHost: (() => {\n      try {\n        return localStorage.getItem(OBS_HOST_KEY) || '';\n      } catch {\n        return '';\n      }\n    })(),\n    obsPassword: (() => {\n      try {\n        return localStorage.getItem(OBS_PASSWORD_KEY) || '';\n      } catch {\n        return '';\n      }\n    })(),\n\n    // Scroll router (persisted)\n    scrollMode: (() => {\n      const fromPrefs = (() => {\n        try {\n          const prefs = loadScrollPrefs();\n          if (prefs?.mode) return normalizeScrollMode(prefs.mode);\n        } catch {}\n        return null;\n      })();\n      const migrated = readAndMigrateScrollMode();\n      const chosen = normalizeScrollMode(fromPrefs || migrated);\n      try { localStorage.setItem(SCROLL_MODE_KEY, chosen); } catch {}\n      return chosen;\n    })(),\n    timedSpeed: (() => {\n      try {\n        const v = parseFloat(localStorage.getItem(TIMED_SPEED_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 25;\n      } catch {\n        return 25;\n      }\n    })(),\n    wpmTarget: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(WPM_TARGET_KEY) || '');\n        return isFinite(v) && v >= 60 ? v : 180;\n      } catch {\n        return 180;\n      }\n    })(),\n    wpmBasePx: (() => {\n      try {\n        const v = parseFloat(localStorage.getItem(WPM_BASEPX_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 25;\n      } catch {\n        return 25;\n      }\n    })(),\n    wpmMinPx: (() => {\n      try {\n        const v = parseFloat(localStorage.getItem(WPM_MINPX_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 6;\n      } catch {\n        return 6;\n      }\n    })(),\n    wpmMaxPx: (() => {\n      try {\n        const v = parseFloat(localStorage.getItem(WPM_MAXPX_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 200;\n      } catch {\n        return 200;\n      }\n    })(),\n    wpmEwmaSec: (() => {\n      try {\n        const v = parseFloat(localStorage.getItem(WPM_EWMA_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 1.0;\n      } catch {\n        return 1.0;\n      }\n    })(),\n    hybridAttackMs: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(HYB_ATTACK_KEY) || '');\n        return isFinite(v) && v >= 0 ? v : 120;\n      } catch {\n        return 120;\n      }\n    })(),\n    hybridReleaseMs: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(HYB_RELEASE_KEY) || '');\n        return isFinite(v) && v >= 0 ? v : 250;\n      } catch {\n        return 250;\n      }\n    })(),\n    hybridIdleMs: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(HYB_IDLE_KEY) || '');\n        return isFinite(v) && v >= 0 ? v : 1500;\n      } catch {\n        return 1500;\n      }\n    })(),\n    stepPx: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(STEP_PX_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 120;\n      } catch {\n        return 120;\n      }\n    })(),\n    rehearsalPunct: (() => {\n      try {\n        const v = localStorage.getItem(REH_PUNCT_KEY);\n        return v != null && v !== '' ? v : '.,;:?!';\n      } catch {\n        return '.,;:?!';\n      }\n    })(),\n    rehearsalResumeMs: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(REH_RESUME_KEY) || '');\n        return isFinite(v) && v >= 100 ? v : 1000;\n      } catch {\n        return 1000;\n      }\n    })(),\n\n    // transient session state (not persisted)\n    obsUrl: '',\n    obsPort: '',\n    obsSecure: false,\n  };\n}\n\nfunction ensureExistingState(): Partial<AppStoreState> {\n  if (IS_TEST) {\n    try { delete (window as any).__tpStore; } catch {}\n    return {};\n  }\n  try {\n    const existing = (window as any).__tpStore;\n    if (!existing || typeof existing !== 'object') return {};\n    const snapshot =\n      typeof existing.getSnapshot === 'function'\n        ? existing.getSnapshot()\n        : (existing.state as Partial<AppStoreState> | undefined);\n    if (snapshot && typeof snapshot === 'object') return snapshot;\n  } catch {}\n  return {};\n}\n\nfunction sanitizeState(state: AppStoreState): AppStoreState {\n  // Clamp page to allowed set and clean persisted value if invalid\n  if (!ALLOWED_PAGES.has(state.page as PageName)) {\n    state.page = 'scripts';\n  }\n  // Clamp overlay to allowed set and clear bad persisted values\n  if (!ALLOWED_OVERLAYS.has(state.overlay)) {\n    state.overlay = 'none';\n    try { localStorage.removeItem(OVERLAY_KEY); } catch {}\n  }\n  if (state.scrollMode === 'manual') {\n    state.scrollMode = 'step';\n  }\n  if (!state.asrProfiles || typeof state.asrProfiles !== 'object') {\n    state.asrProfiles = {};\n  }\n  if (state.asrActiveProfileId && typeof state.asrActiveProfileId !== 'string') {\n    state.asrActiveProfileId = null;\n  }\n  if (typeof state.asrLastAppliedAt !== 'number') {\n    state.asrLastAppliedAt = 0;\n  }\n  if (!state.asrLastAppliedSummary || typeof state.asrLastAppliedSummary !== 'object') {\n    state.asrLastAppliedSummary = {};\n  }\n  if (typeof state.asrLastApplyOk !== 'boolean') {\n    state.asrLastApplyOk = false;\n  }\n  if (!state.settingsSaveStatus || typeof state.settingsSaveStatus !== 'object') {\n    state.settingsSaveStatus = { state: 'idle', at: 0 };\n  }\n  return state;\n}\n\nexport function createAppStore(initial?: Partial<AppStoreState>): AppStore {\n  const subs: SubscriptionMap = Object.create(null);\n  const baseState = buildInitialState();\n  const state: AppStoreState = sanitizeState(\n    Object.assign(\n      {},\n      baseState,\n      ensureExistingState(),\n      initial || {},\n    ),\n  );\n\n  function notify(key: keyof AppStoreState, value: AppStoreState[typeof key]) {\n    try {\n      const k = String(key);\n      const fns = subs[k] || [];\n      for (let i = 0; i < fns.length; i++) {\n        try {\n          fns[i](value);\n        } catch {}\n      }\n    } catch {}\n  }\n\n  function get<K extends keyof AppStoreState>(key: K): AppStoreState[K] {\n    try {\n      return state[key];\n    } catch {\n      return undefined as AppStoreState[K];\n    }\n  }\n\n  function set<K extends keyof AppStoreState>(key: K, value: AppStoreState[K]): AppStoreState[K] {\n    try {\n      if (key === 'page') {\n        value = (ALLOWED_PAGES.has(value as PageName) ? value : 'scripts') as AppStoreState[K];\n      }\n      if (key === 'overlay') {\n        value = (ALLOWED_OVERLAYS.has(value as AppStoreState['overlay']) ? value : 'none') as AppStoreState[K];\n      }\n      const prev = state[key];\n      if (prev === value) return value;\n      state[key] = value;\n      try {\n        const storageKey = persistMap[key];\n      if (storageKey) {\n        if (value === null || typeof value === 'undefined') {\n          localStorage.removeItem(storageKey);\n        } else if (typeof value === 'boolean') {\n          localStorage.setItem(storageKey, value ? '1' : '0');\n        } else if (typeof value === 'object') {\n          try {\n            localStorage.setItem(storageKey, JSON.stringify(value));\n          } catch {\n            // ignore serialization failures\n          }\n        } else {\n          localStorage.setItem(storageKey, String(value));\n        }\n          if (key === 'autoRecord') {\n            try {\n              localStorage.removeItem(LEGACY_AUTO_RECORD_KEY);\n            } catch {}\n          }\n          if (key === 'scrollMode') {\n            saveScrollPrefs({ mode: String(value) as any });\n          }\n        }\n      } catch {}\n      notify(key, value);\n      return value;\n    } catch {\n      return value;\n    }\n  }\n\n  function subscribe<K extends keyof AppStoreState>(\n    key: K,\n    fn: Subscriber<AppStoreState[K]>,\n  ): () => void {\n    if (typeof fn !== 'function') return () => {};\n    const k = String(key);\n    subs[k] = subs[k] || [];\n    subs[k].push(fn);\n    try {\n      fn(state[key]);\n    } catch {}\n    return function unsubscribe() {\n      try {\n        subs[k] = (subs[k] || []).filter((x: Subscriber<AppStoreState[K]>) => x !== fn);\n      } catch {}\n    };\n  }\n\n  function subscribeAll(\n    map: Partial<Record<keyof AppStoreState, Subscriber<AppStoreState[keyof AppStoreState]>>>,\n  ): () => void {\n    const unsubs: Array<() => void> = [];\n    try {\n      for (const k in map) {\n        if (Object.prototype.hasOwnProperty.call(map, k)) {\n          const key = k as keyof AppStoreState;\n          const fn = map[key];\n          if (fn) unsubs.push(subscribe(key, fn as any));\n        }\n      }\n    } catch {}\n    return function unsubscribeAll() {\n      unsubs.forEach((u) => u && u());\n    };\n  }\n\n  const appStore: AppStore = {\n    __tsOwned: true,\n    get,\n    set,\n    subscribe,\n    subscribeAll,\n    state,\n    getSnapshot: () => ({ ...state }),\n  };\n\n  try {\n    if (!IS_TEST) {\n      const w = window as any;\n      const existing = w.__tpStore;\n      if (!existing || !existing.__tsOwned) {\n        try {\n          Object.defineProperty(w, '__tpStore', {\n            value: appStore,\n            writable: true,\n            configurable: true,\n            enumerable: true,\n          });\n        } catch {\n          w.__tpStore = appStore;\n        }\n      }\n    }\n  } catch {}\n\n  return appStore;\n}\n\n// Create and expose a singleton by default so existing imports still work.\nconst appStoreSingleton = createAppStore();\nexport { appStoreSingleton as appStore };\n", "// @ts-nocheck\nexport {};\n\nimport { getScrollWriter } from '../scroll/scroll-writer';\nimport { appStore } from '../state/app-store';\n\n// Lightweight ASR ride-along (JS build) \u2014 mirrors src/index-hooks/asr.ts behavior\n// Uses the Web Speech API directly to avoid TS build requirements in dev.\n\r\n// Tunables (exported for tests)\r\nexport const LEAP_CONFIRM_SCORE = 0.75; // high-confidence confirmation threshold\r\nexport const LEAP_CONFIRM_WINDOW_MS = 600;\r\nexport const LEAP_SIZE = 4; // nominal leap distance\r\n// v2 Leap tuning: tighter gate + cooldown\r\nconst LEAP_TUNING = {\r\n  minScore: 0.68,      // previously ~0.50 \u2014 require stronger similarity before deferring/confirming a +4 jump\r\n  maxDistance: 4,      // cap distance (retain existing +4 semantics)\r\n  cooldownMs: 900,     // block rapid back-to-back leap attempts\r\n  minTokens: 3         // ignore very short hypothesis fragments\r\n};\r\nlet _lastLeapAt = 0;\r\nexport const POST_COMMIT_FREEZE_MS = 250;\r\nexport const DISPLAY_MIN_DR = 0.0015;\r\nexport const NO_COMMIT_HOLD_MS = 1200;\r\nexport const SILENCE_FREEZE_MS = 2500;\r\nexport const VAD_PARTIAL_GRACE_MS = 400;\r\n\r\n// Internal instance registry for tests/teardown\r\nconst __asrInstances = new Set();\nconst RESCUE_JUMPS_ENABLED = false; // temp gate: keep HUD telemetry but disable forced reposition\n\nconst scrollWriter = getScrollWriter();\n\nexport function initAsrFeature() {\n  try { console.info('[ASR] dev initAsrFeature()'); } catch {}\n  // Ensure the status chip node exists early, but hidden, to avoid layout shifts before it's placed into the top bar\r\n  try {\r\n    // If the scroll router already inserted the ASR speed badge, don't create a duplicate chip yet\r\n    const existingBadge = document.getElementById('asrSpeedBadge');\r\n    if (!existingBadge && !document.getElementById('asrChip')) {\r\n      const s = document.createElement('span');\r\n      s.id = 'asrChip'; s.className = 'chip'; s.textContent = 'ASR: off';\r\n      s.style.display = 'none';\r\n      document.body.appendChild(s);\r\n    }\r\n  } catch {}\r\n  // Simple text normalizer (aligns with TS normalizeText/stripFillers basics)\r\n  const normalize = (s) => {\r\n    try { return String(s || '').toLowerCase().replace(/[^a-z0-9\\s']/g, ' ').replace(/\\s+/g, ' ').trim(); } catch { return ''; }\r\n  };\r\n  const COVERAGE_THRESHOLD = 0.45; // conservative default; TS uses store threshold but we keep simple here\r\n\r\n  // Mount a small status chip in the top bar to reflect ASR state\r\n  const mountAsrChip = () => {\r\n    try {\r\n      // Replace the router's ASR speed badge with the ASR chip (avoid router visibility toggles hiding it)\r\n      let chip = document.getElementById('asrChip');\r\n      if (!chip) {\r\n        const old = document.getElementById('asrSpeedBadge');\r\n        if (old && old.parentElement) {\r\n          const repl = document.createElement('span');\r\n          repl.id = 'asrChip';\r\n          repl.className = 'chip';\r\n          repl.textContent = 'ASR: off';\r\n          try { old.replaceWith(repl); } catch { try { old.parentElement.insertBefore(repl, old); old.remove(); } catch {} }\r\n          try { repl.dataset.asrMount = 'badge'; } catch {}\r\n          chip = repl;\r\n        }\r\n      }\r\n      if (!chip) {\r\n        chip = document.createElement('span');\r\n        chip.id = 'asrChip'; chip.className = 'chip'; chip.textContent = 'ASR: off'; chip.style.display='none';\r\n        document.body.appendChild(chip);\r\n      }\r\n      chip.setAttribute('aria-live','polite');\r\n      chip.setAttribute('aria-atomic','true');\r\n      // If router later inserts the ASR speed badge, hijack it and replace in-place\r\n      const hijackBadgeIfPresent = () => {\r\n        try {\r\n          const badge = document.getElementById('asrSpeedBadge');\r\n          if (badge && badge.isConnected) {\r\n            if (badge === chip) return true; // already hijacked (unlikely since ids differ)\r\n            const host = badge.parentElement;\r\n            const repl = chip; // move our chip into badge position\r\n            try { badge.replaceWith(repl); } catch { try { host.insertBefore(repl, badge); badge.remove(); } catch {} }\r\n            try { repl.dataset.asrMount = 'badge'; repl.style.display = ''; } catch {}\r\n            return true;\r\n          }\r\n        } catch {}\r\n        return false;\r\n      };\r\n      // Attempt immediate hijack, then observe for late insertion\r\n      if (!hijackBadgeIfPresent()) {\r\n        try {\r\n          const moBadge = new MutationObserver(() => { if (hijackBadgeIfPresent()) { try { moBadge.disconnect(); } catch {} } });\r\n          moBadge.observe(document.documentElement || document.body, { childList: true, subtree: true });\r\n        } catch {}\r\n      }\r\n      // Update on state changes\r\n      const map = { idle: 'off', ready: 'ready', listening: 'listening', running: 'listening', error: 'error' };\r\n      window.addEventListener('asr:state', (e) => {\r\n        try { const st = e?.detail?.state; chip.textContent = 'ASR: ' + (map[st] || st || 'off'); } catch {}\r\n      });\r\n      // Move chip into top bar when available (append as last child to reduce clutter)\r\n      const attach = () => {\r\n        // If we are reusing the ASR speed badge, it's already mounted in the right place\r\n        if (chip && chip.isConnected && chip.dataset && chip.dataset.asrMount === 'badge') {\r\n          try { chip.style.display = ''; } catch {}\r\n          return true;\r\n        }\r\n        const host = document.querySelector('#topbarRight');\r\n        if (host && host.isConnected) {\r\n          try { host.appendChild(chip); chip.style.display = ''; return true; } catch {}\r\n        }\r\n        return false;\r\n      };\r\n      if (!attach()) {\r\n        let tries = 0; const t = setInterval(() => { tries++; if (attach() || tries > 20) clearInterval(t); }, 150);\r\n        const mo = new MutationObserver(() => { if (attach()) { try { mo.disconnect(); } catch {} } });\r\n        mo.observe(document.documentElement || document.body, { childList: true, subtree: true });\r\n      }\r\n      return chip;\r\n    } catch {}\r\n    return null;\r\n  };\r\n\r\n  class WebSpeechEngine {\r\n    constructor() {\r\n      const SR = (window.SpeechRecognition || window.webkitSpeechRecognition);\r\n      this.SR = SR || null;\r\n      this.rec = null; this.listeners = new Set(); this.running = false;\r\n      this._available = !!SR;\r\n    }\r\n    on(fn) { try { this.listeners.add(fn); } catch {} }\r\n    off(fn) { try { this.listeners.delete(fn); } catch {} }\r\n    emit(ev) { try { this.listeners.forEach(fn => { try { fn(ev); } catch {} }); } catch {} }\r\n    async start(opts) {\r\n      if (this.running) return;\r\n      if (!this._available) { this.emit({ type: 'ready' }); return; }\r\n      const rec = new this.SR();\r\n      this.rec = rec; this.running = true;\r\n      rec.lang = (opts && opts.lang) || 'en-US';\r\n      rec.interimResults = !!(opts && opts.interim !== false);\r\n      rec.continuous = true;\r\n      rec.onstart = () => { this.emit({ type: 'ready' }); this.emit({ type: 'listening' }); };\r\n      rec.onerror = (e) => { this.emit({ type: 'error', code: e?.error || 'error', message: e?.message || 'speech error' }); };\r\n      rec.onend = () => { this.running = false; this.emit({ type: 'stopped' }); };\r\n      rec.onresult = (e) => {\r\n        try {\r\n          for (let i = e.resultIndex; i < e.results.length; i++) {\r\n            const res = e.results[i];\r\n            const txt = String(res[0]?.transcript || '');\r\n            const conf = Number(res[0]?.confidence || (res.isFinal ? 1 : 0.5));\r\n            this.emit({ type: res.isFinal ? 'final' : 'partial', text: txt, confidence: conf });\r\n          }\r\n        } catch {}\r\n      };\r\n      try { rec.start(); } catch (err) { this.emit({ type: 'error', code: 'start', message: String(err && err.message || err) }); }\r\n    }\r\n    async stop() { try { if (this.rec) this.rec.stop(); } catch {} finally { this.running = false; this.emit({ type: 'stopped' }); } }\r\n  }\r\n\r\n  class AsrMode {\r\n    constructor(opts) {\r\n      this.opts = Object.assign({ rootSelector: '#scriptRoot, #script, body', lineSelector: '.line, p', markerOffsetPx: 140, windowSize: 6 }, opts || {});\r\n      this.engine = null; this.state = 'idle'; this.currentIdx = 0; this.rescueCount = 0;\r\n      // De-dup and gating state\r\n      this.lastIdx = -1; this.lastScore = 0; this.lastTs = 0; this.pending = null; this.freezeUntil = 0;\r\n      // Leap confirmation state\r\n      this._leapPending = { idx: -1, ts: 0 };\r\n      // Idle/voice tracking\r\n      this._lastCommitAt = 0; this._lastVADAt = 0; this._lastPartialAt = 0; this._speaking = false;\r\n      this._scrollAnim = null;\r\n      // Manual nudge tracking\r\n      this._nudgedAt = 0; this._nudgedAccepted = false;\r\n      // Telemetry counters\r\n      this._stats = { commits: 0, suppressed: { dup: 0, backwards: 0, leap: 0, freeze: 0 }, scoresSum: 0, gaps: [], tweenStepsSum: 0, tweenStepsN: 0 };\r\n      this._telemetryTimer = null;\r\n      // Stuck detector bookkeeping\r\n      this._stuckLastIdx = -1; this._stuckLastAt = 0;\r\n      // Idle rescue watchdog (accelerated: 3.5s)\r\n      this._idleRescueMs = 3500; this._idleRescueTimer = setInterval(() => {\r\n        try {\r\n          if (this.state !== 'running') return;\r\n          const now = performance.now();\r\n          const last = this._lastCommitAt || 0;\r\n          if (last && now - last > this._idleRescueMs) {\r\n            // Nudge forward one line (unless at end)\r\n            const all = this.getAllLineEls();\r\n            if (all && all.length) {\r\n              let rescueIdx = Math.min(this.currentIdx + 1, all.length - 1);\r\n              rescueIdx = this.nextSpokenFrom(rescueIdx);\r\n              if (rescueIdx !== this.currentIdx) {\r\n                const detail = { index: rescueIdx, reason: 'idle' };\r\n                this.dispatch('asr:rescue', detail);\r\n                try { (window.HUD?.log || console.debug)?.('asr:rescue (idle)', { index: rescueIdx }); } catch {}\r\n                if (RESCUE_JUMPS_ENABLED) {\r\n                  this.currentIdx = rescueIdx;\r\n                  this.scrollToLine(rescueIdx);\r\n                }\r\n                this._lastCommitAt = now; // reset window even when we skip the jump\r\n              }\r\n            }\r\n          }\r\n        } catch {}\r\n      }, 1000);\r\n  try { mountAsrChip(); } catch {}\r\n  try { __asrInstances.add(this); } catch {}\r\n      // VAD listener for gentle idle/silence behavior\r\n      try {\r\n        window.addEventListener('tp:vad', (e) => {\r\n          try {\r\n            const speaking = !!(e && e.detail && e.detail.speaking);\r\n            this._speaking = speaking;\r\n            this._lastVADAt = performance.now();\r\n            if (!speaking) {\r\n              // If silence holds for SILENCE_FREEZE_MS, show ready (avoids creep)\r\n              const due = this._lastVADAt + SILENCE_FREEZE_MS;\r\n              setTimeout(() => {\r\n                try {\r\n                  const now = performance.now();\r\n                  // Guard against false-silence: if any partial in last VAD_PARTIAL_GRACE_MS, stay running\r\n                  if (!this._speaking && now >= due && (now - (this._lastPartialAt || 0)) > VAD_PARTIAL_GRACE_MS) {\r\n                    this.setState('ready');\r\n                  }\r\n                } catch {}\r\n              }, SILENCE_FREEZE_MS + 10);\r\n            }\r\n          } catch {}\r\n        });\r\n      } catch {}\r\n      // Manual nudge/reset safety: wheel or arrow/home/end/page keys\r\n      try {\r\n        const reset = () => {\r\n          try {\r\n            this.lastIdx = -1; this.lastScore = 0; this.lastTs = 0; this.pending = null; this._leapPending = { idx: -1, ts: 0 };\r\n            this.dispatch('asr:rescue', { index: this.currentIdx, reason: 'manual' });\r\n            try { (window.HUD?.log || console.debug)?.('asr:rescue (manual)'); } catch {}\r\n            this._nudgedAt = performance.now(); this._nudgedAccepted = false;\r\n          } catch {}\r\n        };\r\n        let lastReset = 0;\r\n        const maybeReset = () => { const now = performance.now(); if (now - lastReset > 300) { lastReset = now; reset(); } };\r\n        window.addEventListener('wheel', maybeReset, { passive: true });\r\n        window.addEventListener('keydown', (ev) => {\r\n          try {\r\n            const k = (ev && (ev.code || ev.key || '')).toString();\r\n            if (/Arrow|Page|Home|End/.test(k)) maybeReset();\r\n          } catch {}\r\n        }, { capture: true });\r\n        window.addEventListener('tp:manual-nudge', maybeReset);\r\n      } catch {}\r\n    }\r\n    lineIsSilent(idx) {\r\n      try { return !!document.querySelector(`.line[data-line-idx=\"${idx}\"][data-silent=\"1\"]`); } catch { return false; }\r\n    }\r\n    nextSpokenFrom(idx) {\r\n      try {\r\n        const total = this.getAllLineEls().length;\r\n        let i = idx;\r\n        while (i < total && this.lineIsSilent(i)) i++;\r\n        return i;\r\n      } catch { return idx; }\r\n    }\r\n    // Direct index commit (dev/test). Applies the same gating used by tryAdvance, but skips coverage.\r\n    commitIndex(newIdx, bestScore = 1) {\r\n      try {\r\n        if (typeof newIdx !== 'number' || !isFinite(newIdx)) return;\r\n        if (newIdx < this.currentIdx) { try { this._stats.suppressed.backwards++; } catch {} return; }\r\n        const delta = newIdx - this.currentIdx;\r\n        if (!this._leapAllowed(delta, newIdx, bestScore)) return;\r\n        if (!this.shouldCommit(newIdx, bestScore)) return;\r\n        if (!this.gateLowConfidence(newIdx, bestScore)) return;\r\n        newIdx = this.nextSpokenFrom(newIdx);\r\n        this.currentIdx = newIdx;\r\n        try { this.scrollToLine(newIdx, bestScore); } catch {}\r\n        this.dispatch('asr:advance', { index: newIdx, score: bestScore });\r\n        try { (window.HUD?.log || console.debug)?.('asr:advance(idx)', { index: newIdx, score: Number(bestScore).toFixed(2) }); } catch {}\r\n        try { this.freezeUntil = performance.now() + POST_COMMIT_FREEZE_MS; } catch {}\r\n        try {\r\n          const now = performance.now();\r\n          if (this._lastCommitAt) { const gap = now - this._lastCommitAt; try { if (isFinite(gap)) this._stats.gaps.push(gap); } catch {} }\r\n          this._lastCommitAt = now;\r\n          try { this._stats.commits++; this._stats.scoresSum += (Number(bestScore) || 0); } catch {}\r\n        } catch {}\r\n      } catch {}\r\n    }\r\n    getState() { return this.state; }\r\n    async start() {\r\n      if (this.state !== 'idle') return;\r\n      // If HUD bus exists (speech-loader routes there), subscribe instead of starting our own SR.\r\n      const bus = (window.HUD && window.HUD.bus) || (window.__tpHud && window.__tpHud.bus) || null;\r\n      this._bus = bus;\r\n      this._busHandlers = [];\r\n      if (bus && typeof bus.on === 'function') {\r\n        // Prevent duplicate bindings if start called redundantly during mode flips\r\n        if (this._bus === bus && this._busHandlers && this._busHandlers.length) {\r\n          this.setState('listening');\r\n          this.dispatch('asr:state', { state: 'listening' });\r\n          return;\r\n        }\r\n        const onPartial = (p) => { try { this.onEngineEvent({ type: 'partial', text: String(p?.text || ''), confidence: 0.5 }); } catch {} };\r\n        const onFinal   = (p) => { try { this.onEngineEvent({ type: 'final',   text: String(p?.text || ''), confidence: 1.0 }); } catch {} };\r\n        try { bus.on('speech:partial', onPartial); this._busHandlers.push(['speech:partial', onPartial]); } catch {}\r\n        try { bus.on('speech:final',   onFinal);   this._busHandlers.push(['speech:final',   onFinal]);   } catch {}\r\n        this.setState('listening');\r\n        this.dispatch('asr:state', { state: 'listening' });\r\n        // Announce that we piggybacked on Speech Sync\r\n        try { (window.HUD?.log || console.debug)?.('asr', { mode: 'bus-follow' }); } catch {}\r\n        // Start periodic telemetry\r\n        try { if (this._telemetryTimer) clearInterval(this._telemetryTimer); } catch {}\r\n        try {\r\n          this._telemetryTimer = setInterval(() => this._emitStats(), 5000);\r\n          // In node/test, make timer non-blocking\r\n          try { this._telemetryTimer?.unref?.(); } catch {}\r\n        } catch {}\r\n        return;\r\n      }\r\n      // Fallback: start our own Web Speech recognizer\r\n      this.engine = new WebSpeechEngine();\r\n      this.engine.on((e) => this.onEngineEvent(e));\r\n      this.setState('ready');\r\n      try { if (this._telemetryTimer) clearInterval(this._telemetryTimer); } catch {}\r\n      try {\r\n        this._telemetryTimer = setInterval(() => this._emitStats(), 5000);\r\n        try { this._telemetryTimer?.unref?.(); } catch {}\r\n      } catch {}\r\n      await this.engine.start({ lang: 'en-US', interim: true });\r\n    }\r\n    async stop() {\r\n      // Unsubscribe from HUD bus if we used it\r\n      try {\r\n        if (this._bus && this._busHandlers && typeof this._bus.off === 'function') {\r\n          for (const [ev, fn] of this._busHandlers) { try { this._bus.off(ev, fn); } catch {} }\r\n        }\r\n      } catch {}\r\n      this._bus = null; this._busHandlers = [];\r\n      try { await this.engine?.stop?.(); } catch {}\r\n      this.setState('idle');\r\n      this.dispatch('asr:state', { state: this.state });\r\n      // Final telemetry flush\r\n      try { this._emitStats(true); } catch {}\r\n      try { if (this._telemetryTimer) clearInterval(this._telemetryTimer); } catch {}\r\n    }\r\n    onEngineEvent(e) {\r\n      if (e.type === 'ready') this.setState('ready');\r\n      if (e.type === 'listening') this.setState('listening');\r\n      if (e.type === 'partial' || e.type === 'final') {\r\n        if (this.state !== 'running') this.setState('running');\r\n        const text = normalize(e.text);\r\n        if (e.type === 'partial') { try { this._lastPartialAt = performance.now(); } catch {} }\r\n        this.tryAdvance(text, e.type === 'final', Number(e.confidence || (e.type === 'final' ? 1 : 0.5)));\r\n      }\r\n      if (e.type === 'error') { this.setState('error'); this.dispatch('asr:error', { code: e.code, message: e.message }); }\r\n      if (e.type === 'stopped') { this.setState('idle'); }\r\n    }\r\n  setState(s) { this.state = s; this.dispatch('asr:state', { state: s }); try { (window.HUD?.log || console.debug)?.('asr:state', s); } catch {} }\r\n    dispatch(name, detail) { try { window.dispatchEvent(new CustomEvent(name, { detail })); } catch {} }\r\n    getAllLineEls() {\r\n      const root = document.querySelector(this.opts.rootSelector) || document.body;\r\n      const list = Array.from(root.querySelectorAll(this.opts.lineSelector));\r\n      return list.length ? list : Array.from(document.querySelectorAll('.line, p'));\r\n    }\r\n    getWindow() {\r\n      const els = this.getAllLineEls();\r\n      const start = Math.max(0, Math.min(this.currentIdx, Math.max(0, els.length - 1)));\r\n      const end = Math.max(start, Math.min(els.length, start + this.opts.windowSize));\r\n      const texts = els.slice(start, end).map(el => normalize(el.textContent || ''));\r\n      return { lines: texts, idx0: start };\r\n    }\r\n    shouldCommit(idx, score) {\r\n      try {\r\n        const now = performance.now();\r\n        const sameIdx = idx === this.lastIdx;\r\n        const scoreGain = (Number(score) || 0) - (Number(this.lastScore) || 0);\r\n        // Manual nudge semantics: allow one same-line acceptance after nudge; subsequent same-line requires score gain >= 0.1\r\n        if (this._nudgedAt && idx === this.currentIdx) {\r\n          if (!this._nudgedAccepted) { this._nudgedAccepted = true; this.lastIdx = idx; this.lastScore = Number(score) || 0; this.lastTs = now; return true; }\r\n          if (scoreGain < 0.10) { try { this._stats.suppressed.dup++; } catch {} return false; }\r\n        }\r\n        if (sameIdx && scoreGain < 0.12 && (now - (this.lastTs || 0)) < 350) { try { this._stats.suppressed.dup++; } catch {} return false; }\r\n        this.lastIdx = idx; this.lastScore = Number(score) || 0; this.lastTs = now;\r\n        return true;\r\n      } catch { return true; }\r\n    }\r\n    gateLowConfidence(idx, score) {\r\n      try {\r\n        const now = performance.now();\r\n        const LOW = 0.55, WINDOW = 1200;\r\n        const s = Number(score) || 0;\r\n        if (s >= LOW) { this.pending = null; return true; }\r\n        const p = this.pending;\r\n        if (!p || p.idx !== idx || (now - p.ts) > WINDOW) { this.pending = { idx, score: s, ts: now }; return false; }\r\n        this.pending = null; return true;\r\n      } catch { return true; }\r\n    }\r\n    smoothScrollTo(scroller, top, ms = 160, score = 1) {\r\n      // Discrete stepped tween (reduces scroll spam to ~3-5 writes per commit)\r\n      try { if (this._scrollAnim && this._scrollAnim.cancel) this._scrollAnim.cancel(); } catch {}\r\n      const isWin = (scroller === document.scrollingElement || scroller === document.body);\r\n      const from = isWin ? (window.scrollY || window.pageYOffset || 0) : (scroller.scrollTop || 0);\r\n      const delta = Number(top || 0) - Number(from || 0);\r\n      // Deadband at target (\u00B10.002 scroll ratio)\r\n      try {\r\n        const denom = isWin ? ((document.documentElement?.scrollHeight || 0) - (window.innerHeight || 0)) : ((scroller.scrollHeight || 0) - (scroller.clientHeight || 0));\r\n        if (denom > 0) {\r\n          const rFrom = from / denom; const rTo = Number(top || 0) / denom;\r\n          if (Math.abs(rTo - rFrom) < 0.002) { try { this._stats.tweenStepsN++; } catch {} return 0; }\r\n        }\r\n      } catch {}\r\n      let cancelled = false;\r\n      // Score-aware steps: shaky spans snappy; rock-solid silky\r\n      let steps = Math.max(3, Math.min(5, Math.round(ms / 50))); // base 3-5\r\n      const s = Number(score) || 0;\r\n      if (s >= 0.85) steps = 5;\r\n      else if (s >= 0.5 && s <= 0.6) steps = Math.min(steps, 3);\r\n      try { this._stats.tweenStepsSum += steps; this._stats.tweenStepsN++; } catch {}\r\n      let i = 0;\n      const write = () => {\n        if (cancelled) return;\n        i++;\n        const k = i / steps;\n        const y = from + delta * (k < 0 ? 0 : (k > 1 ? 1 : k));\n        try { scrollWriter.scrollTo(y, { behavior: 'auto' }); } catch {}\n        if (i < steps) requestAnimationFrame(write);\n      };\n      this._scrollAnim = { cancel: () => { cancelled = true; } };\n      requestAnimationFrame(write);\n      return steps;\n    }\r\n    _leapAllowed(delta, idx, score) {\r\n      try {\r\n        if (delta < LEAP_SIZE) return true; // small forward movement\r\n        const now = performance.now();\r\n        const s = Number(score) || 0;\r\n        const tokenCount = this._lastHypTokensCount || 0;\r\n        // Hard gates first\r\n        if (Math.abs(delta) > LEAP_TUNING.maxDistance) return false;\r\n        if (s < LEAP_TUNING.minScore) { try { this._stats.suppressed.leap++; } catch {}; return false; }\r\n        if (tokenCount < LEAP_TUNING.minTokens) { try { this._stats.suppressed.leap++; } catch {}; return false; }\r\n        if ((now - _lastLeapAt) < LEAP_TUNING.cooldownMs) { try { this._stats.suppressed.leap++; } catch {}; return false; }\r\n        // Confirmation pathway\r\n        if (s >= LEAP_CONFIRM_SCORE) {\r\n          this._leapPending = { idx: -1, ts: 0 }; _lastLeapAt = now;\r\n          try { (window.HUD?.log || console.debug)?.('asr:confirm leap \\u2713', { d: '+' + delta }); } catch {}\r\n          return true;\r\n        }\r\n        if (this._leapPending && this._leapPending.idx === idx) {\r\n          if ((now - this._leapPending.ts) <= LEAP_CONFIRM_WINDOW_MS) {\r\n            this._leapPending = { idx: -1, ts: 0 }; _lastLeapAt = now;\r\n            try { (window.HUD?.log || console.debug)?.('asr:confirm leap \\u2713', { d: '+' + delta }); } catch {}\r\n            return true;\r\n          } else {\r\n            try { (window.HUD?.log || console.debug)?.('asr:confirm expired'); } catch {}\r\n            try { this._stats.suppressed.leap++; } catch {}\r\n          }\r\n        }\r\n        this._leapPending = { idx, ts: now }; _lastLeapAt = now;\r\n        try { (window.HUD?.log || console.debug)?.('asr:defer leap', { d: '+' + delta, score: s.toFixed(2) }); } catch {}\r\n        try { this._stats.suppressed.leap++; } catch {}\r\n        return false;\r\n      } catch { return true; }\r\n    }\r\n  tryAdvance(hyp, isFinal, confidence) {\r\n      // Freeze briefly after big jumps to avoid rubber-banding on line starts\r\n      try {\r\n        const now = performance.now();\r\n        if (now < (this.freezeUntil || 0)) {\r\n          const ms = Math.max(0, Math.round((this.freezeUntil || 0) - now));\r\n          try { this._stats.suppressed.freeze++; } catch {}\r\n          try { (window.HUD?.log || console.debug)?.('asr:drop freeze', { ms }); } catch {}\r\n          return;\r\n        }\r\n      } catch {}\r\n      // Cache hyp token count for leap gating\r\n      try { this._lastHypTokensCount = String(hyp || '').split(/\\s+/).filter(Boolean).length; } catch { this._lastHypTokensCount = 0; }\r\n      const { lines, idx0 } = this.getWindow();\r\n      let bestIdx = -1, bestScore = 0;\r\n      for (let i = 0; i < lines.length; i++) {\r\n        const score = coverageScore(lines[i], hyp) * (confidence || 1);\r\n        if (score > bestScore) { bestScore = score; bestIdx = i; }\r\n      }\r\n      const thr = Number(localStorage.getItem('tp_asr_threshold') || COVERAGE_THRESHOLD) || COVERAGE_THRESHOLD;\r\n      if (bestIdx >= 0 && bestScore >= thr) {\r\n  let newIdx = idx0 + bestIdx;\r\n        if (newIdx < this.currentIdx) { try { this._stats.suppressed.backwards++; } catch {} return; }\r\n        if (newIdx === this.currentIdx) { /* allow dedupe logic below to decide */ }\r\n        const delta = newIdx - this.currentIdx;\r\n        // Leap confirmation guard\r\n        if (!this._leapAllowed(delta, newIdx, bestScore)) return;\r\n        if (!this.shouldCommit(newIdx, bestScore)) return;\r\n        if (!this.gateLowConfidence(newIdx, bestScore)) return;\r\n  // Skip silent cue lines (pause/beat) automatically\r\n  newIdx = this.nextSpokenFrom(newIdx);\r\n  this.currentIdx = newIdx;\r\n        this.scrollToLine(newIdx, bestScore);\r\n        this.dispatch('asr:advance', { index: newIdx, score: bestScore });\r\n        try { (window.HUD?.log || console.debug)?.('asr:advance', { index: newIdx, score: Number(bestScore).toFixed(2) }); } catch {}\r\n        // Micro freeze after commit (applies to all commits, keeps double-fires down)\r\n        try { this.freezeUntil = performance.now() + POST_COMMIT_FREEZE_MS; } catch {}\r\n        // Mark commit time for idle-hold logic\r\n        try {\r\n          const now = performance.now();\r\n          if (this._lastCommitAt) { const gap = now - this._lastCommitAt; try { if (isFinite(gap)) this._stats.gaps.push(gap); } catch {} }\r\n          this._lastCommitAt = now;\r\n          try { this._stats.commits++; this._stats.scoresSum += (Number(bestScore) || 0); } catch {}\r\n        } catch {}\r\n        // End-of-script courtesy stop\r\n        try {\r\n          const total = this.getAllLineEls().length;\r\n          if (newIdx >= total - 1) { try { window.dispatchEvent(new CustomEvent('asr:stop')); } catch {} }\r\n        } catch {}\r\n        // Same-index stuck detector (nudges forward after STUCK.ms without commit change)\r\n        try {\r\n          const now2 = performance.now();\r\n          if (newIdx === this._stuckLastIdx) {\r\n            if (now2 - this._stuckLastAt > 2500) { // STUCK.ms\r\n              let rescueIdx = Math.min(newIdx + 1, this.getAllLineEls().length - 1);\r\n              rescueIdx = this.nextSpokenFrom(rescueIdx);\r\n              if (rescueIdx !== newIdx) {\r\n                const detail = { index: rescueIdx, reason: 'same-index' };\r\n                this.dispatch('asr:rescue', detail);\r\n                try { (window.HUD?.log || console.debug)?.('asr:rescue (same-index)', { from: newIdx, to: rescueIdx }); } catch {}\r\n                if (RESCUE_JUMPS_ENABLED) {\r\n                  this.currentIdx = rescueIdx;\r\n                  this.scrollToLine(rescueIdx);\r\n                }\r\n              }\r\n              this._stuckLastAt = now2; // reset window\r\n            }\r\n          } else { this._stuckLastIdx = newIdx; this._stuckLastAt = now2; }\r\n        } catch {}\r\n      } else if (isFinal) {\r\n        this.rescueCount++;\r\n        if (this.rescueCount <= 2) {\r\n          let rIdx = Math.min(this.currentIdx + 1, this.getAllLineEls().length - 1);\r\n          rIdx = this.nextSpokenFrom(rIdx);\r\n          const detail = { index: rIdx, reason: 'weak-final' };\r\n          this.dispatch('asr:rescue', detail);\r\n          try { (window.HUD?.log || console.debug)?.('asr:rescue', { index: rIdx }); } catch {}\r\n          if (RESCUE_JUMPS_ENABLED) {\r\n            this.currentIdx = rIdx;\r\n            this.scrollToLine(this.currentIdx);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    scrollToLine(idx, score = 1) {\r\n      const els = this.getAllLineEls();\r\n      const target = els[idx]; if (!target) return;\r\n      // Skip during pre-roll\r\n      try {\r\n        const ov = document.getElementById('countOverlay');\r\n        if (ov) { const cs = getComputedStyle(ov); const visible = cs.display !== 'none' && cs.visibility !== 'hidden' && !ov.classList.contains('hidden'); if (visible) return; }\r\n      } catch {}\r\n      const scroller = findScroller(target); const marker = this.opts.markerOffsetPx;\r\n      const top = elementTopRelativeTo(target, scroller) - marker;\r\n      try { const steps = this.smoothScrollTo(scroller, top, 160, score); if (typeof steps === 'number') { /* stats updated inside */ } } catch {}\r\n    }\r\n    _emitStats(final = false) {\r\n      try {\r\n        const commits = this._stats.commits || 0;\r\n        const avgScore = commits ? (this._stats.scoresSum / commits) : 0;\r\n        const tweenStepsAvg = (this._stats.tweenStepsN ? (this._stats.tweenStepsSum / this._stats.tweenStepsN) : 0);\r\n        let p95GapMs = 0;\r\n        if (this._stats.gaps && this._stats.gaps.length) {\r\n          const arr = this._stats.gaps.slice().sort((a,b)=>a-b);\r\n          const idx = Math.min(arr.length - 1, Math.floor(arr.length * 0.95));\r\n          p95GapMs = arr[idx] || 0;\r\n        }\r\n        const payload = {\r\n          commits,\r\n          suppressed: Object.assign({ dup:0, backwards:0, leap:0, freeze:0 }, this._stats.suppressed || {}),\r\n          avgScore: Number(avgScore.toFixed(3)),\r\n          p95GapMs: Math.round(p95GapMs),\r\n          tweenStepsAvg: Number(tweenStepsAvg.toFixed(2))\r\n        };\r\n        window.dispatchEvent(new CustomEvent('asr:stats', { detail: payload }));\r\n      } catch {}\r\n      // Reset counters for next window\r\n      this._stats = { commits: 0, suppressed: { dup: 0, backwards: 0, leap: 0, freeze: 0 }, scoresSum: 0, gaps: [], tweenStepsSum: 0, tweenStepsN: 0 };\r\n      if (final) { try { if (this._telemetryTimer) clearInterval(this._telemetryTimer); } catch {} }\r\n    }\r\n  }\r\n\r\n  // Small helpers for scrolling/coverage\r\n  function coverageScore(line, hyp) {\r\n    try {\r\n      const A = new Set(String(line || '').split(' ').filter(Boolean));\r\n      const B = new Set(String(hyp || '').split(' ').filter(Boolean));\r\n      if (A.size === 0) return 0; let inter = 0; for (const w of A) if (B.has(w)) inter++; return inter / A.size;\r\n    } catch { return 0; }\r\n  }\r\n  function findScroller(el) {\r\n    let node = el?.parentElement;\r\n    while (node) { try { const st = getComputedStyle(node); if (/(auto|scroll)/.test(st.overflowY || '')) return node; } catch {} node = node.parentElement; }\r\n    return document.scrollingElement || document.body;\r\n  }\r\n  function elementTopRelativeTo(el, scroller) {\r\n    const r1 = el.getBoundingClientRect();\r\n    const isWin = (scroller === document.scrollingElement || scroller === document.body);\r\n    const r2 = isWin ? { top: 0 } : scroller.getBoundingClientRect();\r\n    const scrollTop = isWin ? window.pageYOffset : scroller.scrollTop;\r\n    return r1.top - r2.top + scrollTop;\r\n  }\r\n\r\n  // Coordinator: follow Speech Sync and Mode changes; interlock auto-scroll\r\n  let asrMode = null; let speechActive = false; let asrActive = false; let autoHeld = false;\r\n  // Allow a dev/test override of mode via window.__tpModeOverride or tp:mode events\r\n  const getScrollMode = () => {\n    try {\n      const ov = (typeof window.__tpModeOverride === 'string') ? window.__tpModeOverride : null;\n      if (ov) return String(ov).toLowerCase();\n      const store = (window as any).__tpStore || appStore;\n      const v = store?.get?.('scrollMode');\n      if (typeof v === 'string') return v.toLowerCase();\n    } catch {}\n    return '';\n  };\n  const wantASR = () => getScrollMode() === 'asr';\n  const setChipVisible = (on) => { try { const c = document.getElementById('asrChip'); if (c) c.style.display = on ? '' : 'none'; } catch {} };\r\n  const setChipState = (state) => { try { window.dispatchEvent(new CustomEvent('asr:state', { detail: { state } })); } catch {} };\r\n  const holdAuto = () => {\r\n    if (autoHeld) return; autoHeld = true;\r\n    try { window.__scrollCtl?.stop?.(); } catch {}\r\n    try { (window.__tpAuto || window.Auto || window.__scrollCtl)?.setEnabled?.(false); } catch {}\r\n    try { window.dispatchEvent(new CustomEvent('autoscroll:disable', { detail: 'asr' })); } catch {}\r\n  };\r\n  const releaseAuto = () => {\r\n    if (!autoHeld) return; autoHeld = false;\r\n    // Do not auto-start on release; user intent or router will decide to re-enable\r\n    try { window.dispatchEvent(new CustomEvent('autoscroll:enable', { detail: 'asr' })); } catch {}\r\n  };\r\n  const ensureMode = async () => { if (!asrMode) asrMode = new AsrMode({}); return asrMode; };\n  const isSettingsHydrating = () => { try { return !!(window as any).__tpSettingsHydrating; } catch { return false; } };\n  const start = async () => {\n    if (asrActive) return;\n    if (isSettingsHydrating()) {\n      try { console.debug('[ASR] start blocked during settings hydration'); } catch {}\n      return;\n    }\n    try { const m = await ensureMode(); holdAuto(); await m.start(); asrActive = true; }\n    catch (err) { asrActive = false; releaseAuto(); try { console.warn('[ASR] start failed', err); } catch {} }\n  };\n  const stop  = async () => { if (!asrActive) return; try { await asrMode?.stop?.(); } finally { asrActive = false; releaseAuto(); } };\r\n\r\n  window.addEventListener('tp:speech-state', (ev) => {\r\n    try {\r\n      const d = ev?.detail || {}; const on = (d.running === true) || (typeof d.state === 'string' && (d.state === 'active' || d.state === 'running'));\r\n      speechActive = !!on;\r\n      // Reflect speech activity on the chip even outside pure ASR mode (e.g., Hybrid)\r\n      try { window.dispatchEvent(new CustomEvent('asr:state', { detail: { state: on ? 'listening' : 'idle' } })); } catch {}\r\n      // Idle-hold: if speaking but no commits for NO_COMMIT_HOLD_MS, keep 'running' (don't show idle)\r\n      try {\r\n        if (asrMode && asrMode._speaking) {\r\n          const due = asrMode._lastCommitAt + NO_COMMIT_HOLD_MS;\r\n          if (performance.now() > due && asrMode.state === 'running') {\r\n            // no-op: intentionally keep state 'running'; do not downgrade\r\n          }\r\n        }\r\n      } catch {}\r\n      if (speechActive && wantASR()) void start(); else void stop();\r\n    } catch {}\r\n  });\r\n  // Dev/test: mode override event (avoids DOM select in headless harness)\r\n  window.addEventListener('tp:mode', (ev) => {\r\n    try {\r\n      const m = (ev && ev.detail && ev.detail.mode) ? String(ev.detail.mode) : '';\r\n      if (!m) return;\r\n      try { window.__tpModeOverride = m; } catch {}\r\n      // If speech is active, apply start/stop based on new mode\r\n      if (speechActive) { wantASR() ? void start() : void stop(); }\r\n    } catch {}\r\n  });\r\n  try {\n    const store = (window as any).__tpStore || appStore;\n    store?.subscribe?.('scrollMode', () => {\n      const isAsr = wantASR();\n      if (isAsr) {\n        try { mountAsrChip(); } catch {}\n        setChipVisible(true);\n        setChipState(speechActive ? 'listening' : 'ready');\n      } else {\n        setChipState('idle');\n        setChipVisible(false);\n      }\n      if (!speechActive) return; // Do not start/stop engine when speech is off\n      isAsr ? void start() : void stop();\n    });\n  } catch {}\n  window.addEventListener('asr:toggle', (e) => { const armed = !!(e?.detail?.armed); armed ? void start() : void stop(); });\r\n  window.addEventListener('asr:stop', () => { void stop(); });\r\n\r\n  // Dev/test: direct speech-result hook (final-only) to drive commits without full coverage engine\r\n  // detail: { type: 'partial'|'final', index: number, score?: number }\r\n  window.addEventListener('tp:speech-result', (ev) => {\r\n    try {\r\n      if (!asrMode || !asrActive) return;\r\n      const d = ev && ev.detail || {};\r\n      const idx = Number(d.index);\r\n      if (!isFinite(idx)) return;\r\n      if (String(d.type || '').toLowerCase() !== 'final') return; // ignore partial in this minimal hook\r\n      // Allow test harness to jump directly: pre-position currentIdx when the leap exceeds our confirmation window.\r\n      // This keeps commitIndex gating intact while avoiding synthetic large-leap suppression in headless smoke tests.\r\n      try {\r\n        const cur = Number(asrMode.currentIdx || 0);\r\n        const delta = idx - cur;\r\n        if (delta > (LEAP_TUNING.maxDistance || LEAP_SIZE)) {\r\n          // Pre-position just behind the target to turn the jump into a small forward move\r\n          asrMode.currentIdx = Math.max(0, idx - 1);\r\n        }\r\n      } catch {}\r\n      try { asrMode.commitIndex?.(idx, Number(d.score || 1)); } catch {}\r\n    } catch {}\r\n  });\r\n\r\n  // Late-load reconcile\r\n  try {\r\n    const body = document.body; speechActive = !!(body && (body.classList.contains('speech-listening') || body.classList.contains('listening'))) || (window.speechOn === true);\r\n    const isAsr = wantASR();\r\n    if (isAsr) { try { mountAsrChip(); } catch {} setChipVisible(true); setChipState(speechActive ? 'listening' : 'ready'); }\r\n    else { setChipVisible(false); }\r\n    if (speechActive && isAsr) void start();\r\n  } catch {}\r\n}\r\n\r\nexport default initAsrFeature;\r\n\r\n// Test hook: tear down any live ASR instances and clear timers\r\nexport async function teardownASR() {\r\n  try {\r\n    for (const inst of Array.from(__asrInstances)) {\r\n      try { await inst.stop?.(); } catch {}\r\n      try { inst._emitStats?.(true); } catch {}\r\n      try { if (inst._telemetryTimer) clearInterval(inst._telemetryTimer); } catch {}\r\n      try { inst._telemetryTimer?.unref?.(); } catch {}\r\n    }\r\n  } catch {}\r\n  try { __asrInstances.clear?.(); } catch {}\r\n}\r\n\r\n// Also expose a window helper for headless smokes that don't import ESM named exports\r\ntry { if (typeof window !== 'undefined') { window.__asrFinalizeForTests = teardownASR; } } catch {}\r\n\r\n"],
  "mappings": "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",
  "names": ["start"]
}
