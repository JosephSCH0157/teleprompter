{
  "version": 3,
  "sources": ["../scroll/scroller.ts", "../env/dev-log.ts", "../scroll/scroll-writer.ts", "../scroll/audit.ts", "../features/scroll/scroll-prefs.ts", "../state/app-store.ts", "asr-legacy.ts"],
  "sourcesContent": ["let displayScrollChannel: BroadcastChannel | null = null;\nlet scrollEventTrackerInstalled = false;\n\nexport type ScrollerRole = 'main' | 'display';\n\nfunction shouldLogScrollWrite(): boolean {\n  if (typeof window === 'undefined') return false;\n  try {\n    const w = window as any;\n    if (w.__tpScrollDebug === true) return true;\n    if (w.__tpScrollWriteDebug === true) return true;\n    const qs = new URLSearchParams(window.location.search || '');\n    if (qs.has('scrollDebug') || qs.has('scrollWriteDebug')) return true;\n  } catch {\n    // ignore\n  }\n  return false;\n}\n\nfunction readLineIndex(el: Element | null): number | null {\n  if (!el) return null;\n  const line = (el as HTMLElement).closest ? (el as HTMLElement).closest('.line') as HTMLElement | null : null;\n  if (!line) return null;\n  const raw =\n    line.dataset.i ||\n    line.dataset.index ||\n    line.dataset.lineIdx ||\n    line.dataset.line ||\n    line.getAttribute('data-line') ||\n    line.getAttribute('data-line-idx');\n  if (raw != null && raw !== '') {\n    const n = Number(raw);\n    if (Number.isFinite(n)) return Math.max(0, Math.floor(n));\n  }\n  const id = line.id || '';\n  const m = /^tp-line-(\\d+)$/.exec(id);\n  if (m) return Math.max(0, Number(m[1]));\n  return null;\n}\n\nfunction computeAnchorLineIndex(scroller: HTMLElement | null): number | null {\n  if (!scroller) return null;\n  if (typeof document === 'undefined' || typeof window === 'undefined') return null;\n  const rect = scroller.getBoundingClientRect();\n  if (!rect.height || !rect.width) return null;\n  const markerPct = typeof (window as any).__TP_MARKER_PCT === 'number'\n    ? (window as any).__TP_MARKER_PCT\n    : 0.4;\n  const markerY = rect.top + rect.height * markerPct;\n  const markerX = rect.left + rect.width * 0.5;\n  const hit = document.elementFromPoint(markerX, markerY);\n  const hitIdx = readLineIndex(hit);\n  if (hitIdx != null) return hitIdx;\n  const lines = Array.from(scroller.querySelectorAll<HTMLElement>('.line'));\n  if (!lines.length) return null;\n  let bestIdx: number | null = null;\n  let bestDist = Infinity;\n  for (let i = 0; i < lines.length; i++) {\n    const el = lines[i];\n    const r = el.getBoundingClientRect();\n    const y = r.top + r.height * 0.5;\n    const d = Math.abs(y - markerY);\n    if (d < bestDist) {\n      bestDist = d;\n      bestIdx = readLineIndex(el) ?? i;\n    }\n  }\n  return bestIdx != null ? Math.max(0, Math.floor(bestIdx)) : null;\n}\n\nfunction isElementLike(node: unknown): node is HTMLElement {\n  return !!node && typeof node === 'object' && (node as any).nodeType === 1;\n}\n\nexport function getDisplayViewerElement(): HTMLElement | null {\n  if (typeof window === 'undefined') return null;\n  try {\n    const w = window as any;\n    const direct = w.__tpDisplayViewerEl;\n    if (isElementLike(direct)) return direct as HTMLElement;\n    const opener = w.opener as any;\n    const viaOpener = opener && !opener.closed ? opener.__tpDisplayViewerEl : null;\n    if (isElementLike(viaOpener)) return viaOpener as HTMLElement;\n  } catch {\n    // ignore\n  }\n  return null;\n}\n\nexport function getScrollerEl(role: ScrollerRole = 'main'): HTMLElement | null {\n  if (typeof document === 'undefined') return null;\n  if (role === 'display') {\n    return (\n      getDisplayViewerElement() ||\n      (document.getElementById('wrap') as HTMLElement | null)\n    );\n  }\n  try {\n    return (\n      (document.querySelector('main#viewer.viewer, #viewer') as HTMLElement | null) ||\n      (document.getElementById('viewer') as HTMLElement | null)\n    );\n  } catch {\n    return document.getElementById('viewer') as HTMLElement | null;\n  }\n}\n\nexport function getScrollContainer(): HTMLElement | null {\n  return getScrollerEl('main');\n}\n\nexport function getViewerElement(): HTMLElement | null {\n  try {\n    return (\n      getScrollerEl('main') ||\n      (document.querySelector('[data-role=\"viewer\"]') as HTMLElement | null) ||\n      (document.getElementById('wrap') as HTMLElement | null) ||\n      getDisplayViewerElement()\n    );\n  } catch {\n    return getDisplayViewerElement();\n  }\n}\n\nexport function getScriptRoot(): HTMLElement | null {\n  try {\n    return document.getElementById('script') as HTMLElement | null;\n  } catch {\n    return null;\n  }\n}\n\nexport function getFallbackScroller(): HTMLElement | null {\n  try {\n    return (\n      getScrollerEl('main') ||\n      getScrollerEl('display') ||\n      getScriptRoot() ||\n      (document.getElementById('wrap') as HTMLElement | null)\n    );\n  } catch {\n    return null;\n  }\n}\n\nexport function isWindowScroller(sc: HTMLElement | null): boolean {\n  return !!sc && (sc === document.scrollingElement || sc === document.documentElement || sc === document.body);\n}\n\nexport function isScrollable(el: HTMLElement | null): boolean {\n  if (!el) return false;\n  if (el.scrollHeight - el.clientHeight > 2) return true;\n  try {\n    const st = getComputedStyle(el);\n    return /(auto|scroll)/.test(st.overflowY || '');\n  } catch {\n    return false;\n  }\n}\n\nexport function resolveActiveScroller(primary: HTMLElement | null, fallback: HTMLElement | null): HTMLElement | null {\n  if (isScrollable(primary)) return primary;\n  if (isScrollable(fallback)) return fallback;\n  return primary || fallback;\n}\n\nexport function describeElement(el: HTMLElement | null): string {\n  if (!el) return 'none';\n  const id = el.id ? `#${el.id}` : '';\n  const cls = el.className ? `.${String(el.className).trim().split(/\\s+/).join('.')}` : '';\n  return `${el.tagName.toLowerCase()}${id}${cls}` || el.tagName.toLowerCase();\n}\n\nexport function getPrimaryScroller(): HTMLElement | null {\n  return getScrollerEl('main') || getScrollerEl('display');\n}\n\nexport function resolveViewerRole(): ScrollerRole {\n  if (typeof window === 'undefined') return 'main';\n  try {\n    const explicit = String((window as any).__TP_VIEWER_ROLE || '').toLowerCase();\n    if (explicit === 'display') return 'display';\n    if (explicit === 'main') return 'main';\n    const bodyRole = String(window.document?.body?.dataset?.viewerRole || '').toLowerCase();\n    if (bodyRole === 'display') return 'display';\n    if (bodyRole === 'main') return 'main';\n    if ((window as any).__TP_FORCE_DISPLAY) return 'display';\n    const path = String(window.location?.pathname || '').toLowerCase();\n    if (path.includes('display')) return 'display';\n  } catch {\n    // ignore\n  }\n  return 'main';\n}\n\nexport function getRuntimeScroller(role: ScrollerRole = resolveViewerRole()): HTMLElement | null {\n  if (typeof document === 'undefined') return null;\n  const root = getScriptRoot();\n  if (role === 'display') {\n    const primary = getScrollerEl('display');\n    const fallback = (document.getElementById('wrap') as HTMLElement | null) || root;\n    return resolveActiveScroller(primary, fallback);\n  }\n  const primary = getScrollerEl('main') || root;\n  const fallback = root || getScrollerEl('display');\n  return resolveActiveScroller(primary, fallback);\n}\n\nfunction isDisplayWindow(): boolean {\n  if (typeof window === 'undefined') return false;\n  try {\n    const params = new URLSearchParams(window.location.search || '');\n    if (params.get('display') === '1') return true;\n    const path = (window.location.pathname || '').toLowerCase();\n    if (path.includes('display')) return true;\n    if ((window as any).__TP_FORCE_DISPLAY) return true;\n  } catch {\n    // ignore\n  }\n  return false;\n}\n\nfunction isDevScrollSync(): boolean {\n  if (typeof window === 'undefined') return false;\n  try {\n    const w = window as any;\n    if (w.__tpScrollDebug || w.__tpScrollSyncDebug) return true;\n    if (w.__TP_DEV || w.__TP_DEV1 || w.__tpDevMode) return true;\n    if (w.localStorage?.getItem('tp_dev_mode') === '1') return true;\n    const params = new URLSearchParams(window.location.search || '');\n    if (params.has('scrollDebug') || params.has('dev') || params.has('debug')) return true;\n  } catch {\n    // ignore\n  }\n  return false;\n}\n\nexport function applyCanonicalScrollTop(\n  topPx: number,\n  opts: { scroller?: HTMLElement | null; reason?: string; source?: string } = {},\n): number {\n  const scroller =\n    opts.scroller ||\n    resolveActiveScroller(getPrimaryScroller(), getScriptRoot() || getFallbackScroller());\n  if (!scroller) return 0;\n  const max = Math.max(0, scroller.scrollHeight - scroller.clientHeight);\n  const target = Math.max(0, Math.min(Number(topPx) || 0, max));\n  const before = scroller.scrollTop || 0;\n  try {\n    scroller.scrollTop = target;\n  } catch {\n    // ignore\n  }\n  const after = scroller.scrollTop || target;\n  const writerSource = opts.source ?? opts.reason ?? 'programmatic';\n  try {\n    scroller.dataset.tpLastWriter = writerSource;\n  } catch {}\n  if (shouldLogScrollWrite()) {\n    try {\n      console.info('[SCROLL_WRITE_DETAIL]', {\n        source: writerSource,\n        reason: opts.reason,\n        target: Math.round(target),\n        before: Math.round(before),\n        after: Math.round(after),\n        scroller: describeElement(scroller),\n      });\n    } catch {}\n  }\n  try {\n    let actualTop = target;\n    try {\n      actualTop = scroller.scrollTop || target;\n    } catch {\n      // ignore\n    }\n    const ratio = max > 0 ? actualTop / max : 0;\n    const cursorLine = computeAnchorLineIndex(scroller);\n\n    const payload = {\n      type: 'scroll',\n      top: actualTop,\n      ratio,\n      anchorRatio: ratio,\n      cursorLine: cursorLine ?? undefined,\n    };\n\n    const send =\n      (window as any).sendToDisplay ||\n      (window as any).__tpSendToDisplay ||\n      (window as any).__tpDisplay?.sendToDisplay;\n    if (typeof send === 'function') {\n      send(payload);\n    } else {\n      const displayWin = (window as any).__tpDisplayWindow as Window | null | undefined;\n      if (displayWin && !displayWin.closed && typeof displayWin.postMessage === 'function') {\n        displayWin.postMessage(payload, '*');\n      } else if (typeof BroadcastChannel !== 'undefined') {\n        if (!displayScrollChannel) {\n          try { displayScrollChannel = new BroadcastChannel('tp_display'); } catch {}\n        }\n        try { displayScrollChannel?.postMessage(payload); } catch {}\n      }\n    }\n  } catch {\n    // ignore display sync failures\n  }\n  if (isDevScrollSync()) {\n    try {\n      console.debug('[SCROLL_SYNC]', {\n        top: Math.round(target),\n        scroller: describeElement(scroller),\n        reason: opts.reason,\n      });\n    } catch {\n      // ignore\n    }\n  }\n  return target;\n}\n\nexport function getScrollEl(): HTMLElement | null {\n  return resolveActiveScroller(getPrimaryScroller(), getScriptRoot() || getFallbackScroller());\n}\n\nexport function writeScrollTop(\n  topPx: number,\n  opts: { scroller?: HTMLElement | null; reason?: string } = {},\n): number {\n  return applyCanonicalScrollTop(topPx, { scroller: opts.scroller, reason: opts.reason ?? 'writeScrollTop' });\n}\n\nif (typeof window !== 'undefined') {\n  try {\n    const w = window as any;\n\n    if (!isDisplayWindow()) {\n      w.__tpScrollWrite = {\n        scrollTo(top: number) {\n          applyCanonicalScrollTop(top, { reason: 'writer:scrollTo', source: 'scroll-writer' });\n        },\n        scrollBy(delta: number) {\n          const sc =\n            resolveActiveScroller(getPrimaryScroller(), getScriptRoot() || getFallbackScroller());\n          const cur = sc ? (sc.scrollTop || 0) : 0;\n          applyCanonicalScrollTop(cur + (Number(delta) || 0), { reason: 'writer:scrollBy', source: 'scroll-writer' });\n        },\n      };\n    }\n  } catch {\n    // ignore\n  }\n}\n\nif (typeof window !== 'undefined') {\n  try {\n    if (!scrollEventTrackerInstalled) {\n      const handler = (event: Event) => {\n        if (!shouldLogScrollWrite()) return;\n        const target = event.target as HTMLElement | null;\n        if (!target) return;\n        try {\n          console.info('[SCROLL_EVENT]', {\n            scrollTop: Math.round(target.scrollTop || 0),\n            tpLastWriter: target.dataset.tpLastWriter ?? null,\n            isTrusted: event.isTrusted,\n            scroller: describeElement(target),\n          });\n        } catch {}\n      };\n      window.addEventListener('scroll', handler, { capture: true, passive: true });\n      scrollEventTrackerInstalled = true;\n    }\n  } catch {}\n}\n", "// Centralized dev log-level helpers.\n// Levels:\n// 0 = silent\n// 1 = normal dev (state transitions + warnings/errors)\n// 2 = verbose probes\n// 3 = trace/stack heavy diagnostics\n\nconst MIN_LOG_LEVEL = 0;\nconst MAX_LOG_LEVEL = 3;\nconst DEFAULT_DEV_LOG_LEVEL = 1;\n\nconst tagLastAt = new Map<string, number>();\n\nfunction clampLogLevel(value: number): number {\n  if (!Number.isFinite(value)) return MIN_LOG_LEVEL;\n  return Math.max(MIN_LOG_LEVEL, Math.min(MAX_LOG_LEVEL, Math.floor(value)));\n}\n\nfunction parseLogLevelRaw(value: unknown): number | null {\n  if (value == null) return null;\n  const parsed = Number(value);\n  if (!Number.isFinite(parsed)) return null;\n  return clampLogLevel(parsed);\n}\n\nfunction isDevContext(): boolean {\n  if (typeof window === 'undefined') return false;\n  try {\n    const w = window as any;\n    if (w.__TP_DEV || w.__TP_DEV1 || w.__tpDevMode) return true;\n    const params = new URLSearchParams(window.location.search || '');\n    if (params.has('dev') || params.has('debug') || params.has('dev1')) return true;\n    if (window.localStorage?.getItem('tp_dev_mode') === '1') return true;\n  } catch {\n    // ignore\n  }\n  return false;\n}\n\nexport function getTpLogLevel(): number {\n  if (typeof window === 'undefined') return MIN_LOG_LEVEL;\n  try {\n    const w = window as any;\n    const runtimeLevel = parseLogLevelRaw(w.__tpLogLevel);\n    if (runtimeLevel != null) return runtimeLevel;\n  } catch {\n    // ignore\n  }\n  try {\n    const stored = parseLogLevelRaw(window.localStorage?.getItem('tp_log_level'));\n    if (stored != null) return stored;\n  } catch {\n    // ignore\n  }\n  try {\n    const params = new URLSearchParams(window.location.search || '');\n    const fromQuery =\n      parseLogLevelRaw(params.get('tp_log_level')) ??\n      parseLogLevelRaw(params.get('logLevel')) ??\n      parseLogLevelRaw(params.get('log'));\n    if (fromQuery != null) return fromQuery;\n  } catch {\n    // ignore\n  }\n  return isDevContext() ? DEFAULT_DEV_LOG_LEVEL : MIN_LOG_LEVEL;\n}\n\nexport function shouldLogLevel(minLevel: number): boolean {\n  return getTpLogLevel() >= clampLogLevel(minLevel);\n}\n\nexport function shouldLogTag(\n  tag: string,\n  minLevel = 2,\n  throttleMs = 500,\n): boolean {\n  if (!shouldLogLevel(minLevel)) return false;\n  const throttle = Math.max(0, Math.floor(throttleMs));\n  if (!tag || throttle <= 0) return true;\n  const now = Date.now();\n  const last = tagLastAt.get(tag) ?? 0;\n  if (now - last < throttle) return false;\n  tagLastAt.set(tag, now);\n  return true;\n}\n\n", "// Central scroll writer shim.\n// All code that moves the main script viewport should route through this helper.\n\nimport { getAsrBlockElements } from './asr-block-store';\nimport {\n  describeElement,\n  getDisplayViewerElement,\n  getRuntimeScroller,\n  getScrollerEl,\n  getViewerElement,\n  resolveViewerRole,\n} from './scroller';\nimport { shouldLogLevel } from '../env/dev-log';\n\r\nexport interface ScrollWriter {\r\n  /** Absolute scroll in CSS px from top of script viewport. */\r\n  scrollTo(top: number, opts?: { behavior?: ScrollBehavior }): void;\r\n  /** Relative scroll in CSS px. Positive -> move text up (scroll down). */\r\n  scrollBy(delta: number, opts?: { behavior?: ScrollBehavior }): void;\r\n  /** Ensure a given y is visible (best-effort). */\r\n  ensureVisible?(top: number, paddingPx?: number): void;\r\n}\r\n\r\nlet cached: ScrollWriter | null = null;\nlet warned = false;\nlet activeSeekAnim: { cancel: () => void } | null = null;\nlet activeSeekAnimRunId = 0;\nlet lastWriteMismatchAt = 0;\nlet lastWriteMismatchKey = '';\nlet lastNonFiniteGuardAt = 0;\n\nconst WRITE_MISMATCH_LOG_THROTTLE_MS = 2000;\nconst WRITE_MISMATCH_EPSILON_PX = 1;\nconst NON_FINITE_GUARD_THROTTLE_MS = 1000;\nconst ASR_SEEK_DEFAULT_LINES_PER_SEC = 2.8;\nconst ASR_SEEK_MIN_DURATION_MS = 140;\nconst ASR_SEEK_MAX_DURATION_MS = 560;\nconst ASR_SEEK_EPSILON_PX = 0.5;\nconst ASR_SEEK_MIN_PX_PER_SEC = 36;\nconst ASR_SEEK_MAX_PX_PER_SEC = 420;\nconst ASR_SEEK_MAX_VIEWPORTS_PER_SEC = 1.25;\n\ntype SeekAnimationOptions = {\n  targetTop?: number | null;\n  maxPxPerSecond?: number | null;\n  minDurationMs?: number;\n  maxDurationMs?: number;\n  forceAnimated?: boolean;\n};\n\nfunction shouldWarnWrites(): boolean {\n  return shouldLogLevel(1);\n}\n\nfunction shouldVerboseWrites(): boolean {\n  return shouldLogLevel(2);\n}\n\nfunction shouldTraceWrites(): boolean {\n  return shouldLogLevel(3);\n}\n\nfunction logNonFiniteGuard(reason: string, value: unknown, detail?: Record<string, unknown>): void {\n  if (!shouldWarnWrites()) return;\n  const now = Date.now();\n  if (now - lastNonFiniteGuardAt < NON_FINITE_GUARD_THROTTLE_MS) return;\n  lastNonFiniteGuardAt = now;\n  try {\n    console.warn('[scroll-writer] non-finite value', {\n      reason,\n      value,\n      ...(detail || {}),\n    });\n  } catch {\n    // ignore\n  }\n}\n\nfunction withWriteEnabled<T>(reason: string, delta: number, fn: () => T): T {\n  const w = window as any;\n  const prev = w.__tpScrollWriteActive;\n  w.__tpScrollWriteActive = true;\n  if (shouldTraceWrites()) {\n    try { console.trace('[scroll-write]', reason, delta); } catch {}\n  }\n  try { return fn(); }\n  finally { w.__tpScrollWriteActive = prev; }\n}\n\nfunction findScroller(el: HTMLElement): HTMLElement {\n  const runtime = getRuntimeScroller(resolveViewerRole());\n  return (\n    runtime ||\n    getScrollerEl('main') ||\n    getScrollerEl('display') ||\n    getDisplayViewerElement() ||\n    getViewerElement() ||\n    el\n  );\n}\n\nfunction elementTopRelativeTo(el: HTMLElement, scroller: HTMLElement): number {\n  try {\n    const rect = el.getBoundingClientRect();\n    const scRect = scroller.getBoundingClientRect();\n    return rect.top - scRect.top + scroller.scrollTop;\n  } catch {\n    return el.offsetTop || 0;\n  }\n}\n\nfunction markerOffsetPx(fallbackScroller: HTMLElement): number {\n  const markerPct =\n    typeof (window as any).__TP_MARKER_PCT === 'number'\n      ? (window as any).__TP_MARKER_PCT\n      : 0.4;\n  const viewer = getViewerElement();\n  const host = viewer || fallbackScroller;\n  const h = host?.clientHeight || window.innerHeight || 0;\n  return Math.max(0, Math.round(h * markerPct));\n}\n\nfunction easeInOutCubic(t: number): number {\n  if (t <= 0) return 0;\n  if (t >= 1) return 1;\n  return t < 0.5\n    ? 4 * t * t * t\n    : 1 - Math.pow(-2 * t + 2, 3) / 2;\n}\n\nfunction getScrollMode(): string {\n  try {\n    const store = (window as any).__tpStore;\n    if (store && typeof store.get === 'function') {\n      const scrollMode = store.get('scrollMode');\n      if (scrollMode != null) return String(scrollMode).toLowerCase();\n      const legacyMode = store.get('mode');\n      if (legacyMode != null) return String(legacyMode).toLowerCase();\n    }\n    const router: any = (window as any).__tpScrollMode;\n    if (router && typeof router.getMode === 'function') {\n      const mode = router.getMode();\n      if (mode != null) return String(mode).toLowerCase();\n    }\n    if (typeof router === 'string') return router.toLowerCase();\n  } catch {}\n  return '';\n}\n\nfunction prefersReducedMotion(): boolean {\n  try {\n    return !!window.matchMedia?.('(prefers-reduced-motion: reduce)')?.matches;\n  } catch {\n    return false;\n  }\n}\n\nfunction cancelSeekAnimation(): void {\n  activeSeekAnimRunId += 1;\n  if (!activeSeekAnim) return;\n  try { activeSeekAnim.cancel(); } catch {}\n  activeSeekAnim = null;\n}\n\nexport function isSeekAnimationActive(): boolean {\n  return activeSeekAnim != null;\n}\n\nfunction readScrollTop(scroller: HTMLElement): number {\n  return scroller.scrollTop || 0;\n}\n\nfunction getDeltaScroller(): HTMLElement | null {\n  return (\n    getRuntimeScroller(resolveViewerRole()) ||\n    getScrollerEl('main') ||\n    getScrollerEl('display') ||\n    getDisplayViewerElement() ||\n    (document.getElementById('wrap') as HTMLElement | null)\n  );\n}\n\nfunction estimateDelta(targetTop: number): number {\n  try {\n    const sc = getDeltaScroller();\n    const cur = sc ? readScrollTop(sc) : 0;\n    return (Number(targetTop) || 0) - (Number(cur) || 0);\n  } catch {\n    return Number(targetTop) || 0;\n  }\n}\n\nfunction logWriteMismatch(scroller: HTMLElement, target: number, before: number, after: number, reason: string): void {\n  if (!shouldWarnWrites()) return;\n  if (Math.abs(after - target) <= WRITE_MISMATCH_EPSILON_PX) return;\n  const now = Date.now();\n  const key = `${reason}|${describeElement(scroller)}|${Math.round(target)}|${Math.round(after)}`;\n  if (key === lastWriteMismatchKey && now - lastWriteMismatchAt < WRITE_MISMATCH_LOG_THROTTLE_MS) return;\n  lastWriteMismatchKey = key;\n  lastWriteMismatchAt = now;\n  let overflow = '';\n  let overflowY = '';\n  try {\n    const style = getComputedStyle(scroller);\n    overflow = String(style.overflow || '');\n    overflowY = String(style.overflowY || '');\n  } catch {\n    overflow = '';\n    overflowY = '';\n  }\n  const maxTop = Math.max(0, (scroller.scrollHeight || 0) - (scroller.clientHeight || 0));\n  const activeScroller = getRuntimeScroller(resolveViewerRole());\n  try {\n    console.warn('[scroll-writer] write mismatch', {\n      reason,\n      scroller: describeElement(scroller),\n      targetTop: Math.round(target),\n      before: Math.round(before),\n      after: Math.round(after),\n      deltaPx: Math.round(after - before),\n      overflow,\n      overflowY,\n      scrollHeight: Math.round(scroller.scrollHeight || 0),\n      clientHeight: Math.round(scroller.clientHeight || 0),\n      maxTop: Math.round(maxTop),\n      activeScroller: describeElement(activeScroller),\n      isActiveScroller: activeScroller === scroller,\n    });\n  } catch {}\n}\n\nfunction writeScrollTop(scroller: HTMLElement, top: number, reason = 'writeScrollTop'): void {\n  const rawFrom = scroller.scrollTop;\n  const from = Number.isFinite(rawFrom) ? rawFrom : 0;\n  if (!Number.isFinite(rawFrom)) {\n    logNonFiniteGuard('writeScrollTop:from', rawFrom, {\n      scroller: describeElement(scroller),\n      reason,\n    });\n  }\n  const rawTop = Number(top);\n  if (!Number.isFinite(rawTop)) {\n    logNonFiniteGuard('writeScrollTop:target', top, {\n      scroller: describeElement(scroller),\n      reason,\n    });\n    return;\n  }\n  const maxTop = Math.max(0, (scroller.scrollHeight || 0) - (scroller.clientHeight || 0));\n  const target = Math.max(0, Math.min(rawTop, maxTop));\n  const delta = target - from;\n  withWriteEnabled(reason, delta, () => {\n    // Use direct assignment for deterministic writes. `scrollTo({behavior:'auto'})`\n    // can still settle asynchronously in some browser/CSS combinations.\n    scroller.scrollTop = target;\n  });\n  const after = readScrollTop(scroller);\n  logWriteMismatch(scroller, target, from, after, reason);\n}\n\nfunction resolveSeekTarget(blockIdx: number): {\n  blockEl: HTMLElement;\n  scroller: HTMLElement;\n  top: number;\n  blockTopPx: number;\n  lineIdx: number | null;\n} | null {\n  const blocks = getAsrBlockElements();\n  const el = blocks[blockIdx];\n  if (!el) return null;\n  const scroller = findScroller(el);\n  const mode = getScrollMode();\n  const blockTopPx = elementTopRelativeTo(el, scroller);\n  if (!Number.isFinite(blockTopPx)) {\n    logNonFiniteGuard('resolveSeekTarget:blockTopPx', blockTopPx, { blockIdx });\n    return null;\n  }\n  const top = mode === 'asr'\n    ? blockTopPx\n    : blockTopPx - markerOffsetPx(scroller);\n  if (!Number.isFinite(top)) {\n    logNonFiniteGuard('resolveSeekTarget:top', top, { blockIdx, mode });\n    return null;\n  }\n  let lineIdx: number | null = null;\n  try {\n    const firstLine = el.querySelector<HTMLElement>('.line[data-line], .line[data-line-idx], .line');\n    const rawIdx = firstLine?.dataset?.line ?? firstLine?.dataset?.lineIdx;\n    const parsed = Number(rawIdx);\n    if (Number.isFinite(parsed)) lineIdx = Math.max(0, Math.floor(parsed));\n  } catch {\n    lineIdx = null;\n  }\n  return { blockEl: el, scroller, top, blockTopPx, lineIdx };\n}\n\nfunction resolveSeekLineHeightPx(target: { blockEl: HTMLElement; scroller: HTMLElement }): number {\n  const lineEl = target.blockEl.querySelector<HTMLElement>('.line[data-line], .line[data-line-idx], .line');\n  const lineRectH = lineEl?.getBoundingClientRect?.().height ?? 0;\n  if (Number.isFinite(lineRectH) && lineRectH > 4) return lineRectH;\n  const lineOffsetH = lineEl?.offsetHeight ?? 0;\n  if (Number.isFinite(lineOffsetH) && lineOffsetH > 4) return lineOffsetH;\n  try {\n    const computed = lineEl ? Number.parseFloat(getComputedStyle(lineEl).lineHeight) : Number.NaN;\n    if (Number.isFinite(computed) && computed > 4) return computed;\n  } catch {\n    // ignore\n  }\n  const scrollerRectH = target.scroller.getBoundingClientRect?.().height ?? 0;\n  if (Number.isFinite(scrollerRectH) && scrollerRectH > 0) {\n    return Math.max(24, Math.min(96, scrollerRectH * 0.09));\n  }\n  return 56;\n}\n\nexport function getScrollWriter(): ScrollWriter {\n  if (cached) return cached;\n\r\n  if (typeof window !== 'undefined') {\r\n    const maybe = (window as any).__tpScrollWrite;\r\n    if (typeof maybe === 'function') {\n      const fn = maybe as (_top: number) => void;\n      const getScroller = () =>\n        getRuntimeScroller(resolveViewerRole()) ||\n        getScrollerEl('main') ||\n        getScrollerEl('display') ||\n        getDisplayViewerElement();\n      cached = {\n        scrollTo(top: number) {\n          try {\n            const sc = getScroller();\n            const cur = sc ? (sc.scrollTop || 0) : 0;\n            const next = Number(top) || 0;\n            withWriteEnabled('scrollTo', next - cur, () => fn(next));\n          } catch {}\n        },\n        scrollBy(delta: number) {\n          try {\n            const sc = getScroller();\n            const cur = sc ? (sc.scrollTop || 0) : 0;\n            const d = Number(delta) || 0;\n            withWriteEnabled('scrollBy', d, () => fn(cur + d));\n          } catch {}\n        },\n        ensureVisible(_top: number, _paddingPx?: number) {\n          // not supported for bare function writers\n        },\n      };\n      return cached;\r\n    }\r\n    if (maybe && typeof maybe === 'object') {\r\n      const w = maybe as { scrollTo?: (_top: number, _opts?: any) => void; scrollBy?: (_delta: number, _opts?: any) => void; ensureVisible?: (_top: number, _pad?: number) => void };\n      if (typeof w.scrollTo === 'function' && typeof w.scrollBy === 'function') {\n        const writerImpl = w as { scrollTo: (_top: number, _opts?: any) => void; scrollBy: (_delta: number, _opts?: any) => void; ensureVisible?: (_top: number, _pad?: number) => void };\n        cached = {\n          scrollTo(top: number, opts?: { behavior?: ScrollBehavior }) {\n            try { withWriteEnabled('scrollTo', estimateDelta(top), () => writerImpl.scrollTo(top, opts)); } catch {}\n          },\n          scrollBy(delta: number, opts?: { behavior?: ScrollBehavior }) {\n            try { withWriteEnabled('scrollBy', Number(delta) || 0, () => writerImpl.scrollBy(delta, opts)); } catch {}\n          },\n          ensureVisible(top: number, paddingPx = 80) {\n            try {\n              if (typeof writerImpl.ensureVisible === 'function') {\n                withWriteEnabled('ensureVisible', estimateDelta(top), () => writerImpl.ensureVisible!(top, paddingPx));\n              } else {\n                const next = Math.max(0, top - paddingPx);\n                withWriteEnabled('ensureVisible', estimateDelta(next), () => writerImpl.scrollTo(next, { behavior: 'auto' }));\n              }\n            } catch {}\n          },\n        };\n        return cached;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!warned) {\r\n    if (typeof console !== 'undefined' && typeof console.warn === 'function') {\r\n      try { console.warn('[scroll-writer] __tpScrollWrite missing or incomplete; scroll commands are no-ops.'); } catch {}\r\n    }\r\n    warned = true;\r\n  }\r\n\r\n  // No-op writer when SSOT writer is absent; avoids DOM fallbacks.\r\n  cached = {\r\n    scrollTo() { /* no-op: writer missing */ },\r\n    scrollBy() { /* no-op: writer missing */ },\r\n    ensureVisible() { /* no-op: writer missing */ },\r\n  };\r\n  return cached;\n}\n\nexport function seekToBlock(blockIdx: number, reason: string) {\n  cancelSeekAnimation();\n  const target = resolveSeekTarget(blockIdx);\n  if (!target) return;\n  const { scroller, top, blockTopPx, lineIdx } = target;\n\n  try {\n    if (shouldVerboseWrites()) {\n      const currentScrollTop = readScrollTop(scroller);\n      try {\n        console.log('[scroll-writer] seek target', {\n          blockIdx,\n          lineIdx,\n          blockTopPx: Math.round(blockTopPx),\n          currentScrollTop: Math.round(currentScrollTop),\n          targetTop: Math.round(top),\n          deltaPx: Math.round(top - currentScrollTop),\n          reason: reason || 'seekToBlock',\n        });\n      } catch {}\n    }\n    writeScrollTop(scroller, top, reason || 'seekToBlock');\n    try {\n      if (reason && typeof console !== 'undefined') {\n        (console as any).debug?.('[scroll-writer] seekToBlock', { blockIdx, reason });\n      }\n    } catch {}\n  } catch {\n    // ignore\n  }\n}\n\nexport function seekToBlockAnimated(blockIdx: number, reason: string, opts: SeekAnimationOptions = {}) {\n  cancelSeekAnimation();\n  const runId = activeSeekAnimRunId;\n  const mode = getScrollMode();\n  const forceAnimated = opts.forceAnimated === true;\n  if ((!forceAnimated && mode !== 'asr') || (!forceAnimated && prefersReducedMotion())) {\n    seekToBlock(blockIdx, reason);\n    return;\n  }\n  const target = resolveSeekTarget(blockIdx);\n  if (!target) return;\n  const { scroller, top: blockTargetTop, blockTopPx, lineIdx } = target;\n  const startTop = readScrollTop(scroller);\n  const maxTop = Math.max(0, (scroller.scrollHeight || 0) - (scroller.clientHeight || 0));\n  const requestedTopRaw = Number(opts.targetTop);\n  const hasRequestedTop = Number.isFinite(requestedTopRaw);\n  const targetTop = hasRequestedTop\n    ? Math.max(0, Math.min(requestedTopRaw, maxTop))\n    : blockTargetTop;\n  const lineHeightPx = resolveSeekLineHeightPx(target);\n  const configuredMaxPxPerSecond = Number(opts.maxPxPerSecond);\n  const baseMaxPxPerSecond =\n    Number.isFinite(configuredMaxPxPerSecond) && configuredMaxPxPerSecond > 0\n      ? configuredMaxPxPerSecond\n      : lineHeightPx * ASR_SEEK_DEFAULT_LINES_PER_SEC;\n  const viewportMaxPxPerSecond = Math.max(\n    ASR_SEEK_MIN_PX_PER_SEC,\n    (scroller.clientHeight || 0) * ASR_SEEK_MAX_VIEWPORTS_PER_SEC,\n  );\n  const maxPxPerSecond = Math.max(\n    ASR_SEEK_MIN_PX_PER_SEC,\n    Math.min(baseMaxPxPerSecond, ASR_SEEK_MAX_PX_PER_SEC, viewportMaxPxPerSecond),\n  );\n  const minDurationMsRaw = Number(opts.minDurationMs);\n  const maxDurationMsRaw = Number(opts.maxDurationMs);\n  const minDurationMs =\n    Number.isFinite(minDurationMsRaw) && minDurationMsRaw > 0\n      ? minDurationMsRaw\n      : ASR_SEEK_MIN_DURATION_MS;\n  const maxDurationMs =\n    Number.isFinite(maxDurationMsRaw) && maxDurationMsRaw > minDurationMs\n      ? maxDurationMsRaw\n      : Math.max(minDurationMs, ASR_SEEK_MAX_DURATION_MS);\n  const deltaPx = targetTop - startTop;\n  if (shouldVerboseWrites()) {\n    try {\n      console.log('[scroll-writer] seek target', {\n        blockIdx,\n        lineIdx,\n        blockTopPx: Math.round(blockTopPx),\n        lineHeightPx: Math.round(lineHeightPx),\n        currentScrollTop: Math.round(startTop),\n        targetTop: Math.round(targetTop),\n        requestedTop: hasRequestedTop ? Math.round(requestedTopRaw) : null,\n        maxPxPerSecond: Math.round(maxPxPerSecond),\n        deltaPx: Math.round(deltaPx),\n        reason: reason || 'seekToBlockAnimated',\n      });\n    } catch {}\n  }\n  if (!Number.isFinite(targetTop) || Math.abs(deltaPx) < ASR_SEEK_EPSILON_PX) {\n    writeScrollTop(scroller, targetTop, reason || 'seekToBlockAnimated');\n    return;\n  }\n  const durationMs = Math.max(\n    minDurationMs,\n    Math.min(maxDurationMs, (Math.abs(deltaPx) / maxPxPerSecond) * 1000),\n  );\n  const start = typeof performance !== 'undefined' ? performance.now() : Date.now();\n  let cancelled = false;\n  activeSeekAnim = {\n    cancel() {\n      cancelled = true;\n      activeSeekAnim = null;\n    },\n  };\n  const tick = (now: number) => {\n    if (cancelled || runId !== activeSeekAnimRunId) return;\n    const elapsed = now - start;\n    const t = Math.max(0, Math.min(1, elapsed / durationMs));\n    const eased = easeInOutCubic(t);\n    const next = startTop + (targetTop - startTop) * eased;\n    writeScrollTop(scroller, next, reason || 'seekToBlockAnimated');\n    if (t < 1) {\n      requestAnimationFrame(tick);\n    } else {\n      if (runId === activeSeekAnimRunId) {\n        activeSeekAnim = null;\n      }\n    }\n  };\n  requestAnimationFrame(tick);\n}\n", "type AuditPhase = 'idle' | 'preroll' | 'live' | 'wrap' | 'stopped' | 'stopping' | string;\n\nexport type ScrollModeAuditWrite = {\n  writer: string;\n  from?: string | null;\n  to?: string | null;\n  phase?: AuditPhase | null;\n  source?: string;\n  via?: string;\n  stack?: boolean;\n};\n\nconst EXPECTED_WRITERS = new Set<string>([\n  'ui/applyUiScrollMode',\n  'features/scroll/mode-router',\n  'scroll/mode-router',\n  'state/app-store',\n]);\n\nconst CONTINUOUS_MODES = new Set<string>(['timed', 'wpm', 'hybrid', 'asr']);\nconst FORBIDDEN_PHASES = new Set<string>(['idle', 'preroll']);\nconst RACE_WINDOW_MS = 150;\nconst TRANSITION_SUPPRESS_MS = 50;\n\ntype PendingWriter = { writer: string; meta?: Partial<ScrollModeAuditWrite> };\nconst writerStack: PendingWriter[] = [];\n\nlet lastWriteAt = 0;\nlet lastWriter = '';\nlet lastMode = '';\nlet lastPhase = '';\n\nexport function auditEnabled(): boolean {\n  try {\n    const w = window as any;\n    if (w?.__TP_DEV || w?.__TP_DEV1 || w?.__tpDevMode) return true;\n    if (w?.localStorage?.getItem?.('tp_dev_mode') === '1') return true;\n    if (typeof location !== 'undefined' && location.search.includes('dev=1')) return true;\n  } catch {}\n  return false;\n}\n\nexport function withScrollModeWriter<T>(\n  writer: string,\n  fn: () => T,\n  meta?: Partial<ScrollModeAuditWrite>,\n): T {\n  if (!auditEnabled()) return fn();\n  writerStack.push({ writer, meta });\n  try {\n    return fn();\n  } finally {\n    writerStack.pop();\n  }\n}\n\nexport function getScrollModeAuditContext(): PendingWriter | null {\n  if (!auditEnabled()) return null;\n  return writerStack.length ? writerStack[writerStack.length - 1] : null;\n}\n\nfunction isContinuousMode(mode: string): boolean {\n  return CONTINUOUS_MODES.has(mode);\n}\n\nfunction normalize(value: string | null | undefined): string {\n  return String(value || '').trim().toLowerCase();\n}\n\nfunction emitUnexpected(label: string, payload: Record<string, unknown>): void {\n  try {\n    console.warn(`[scroll-audit] UNEXPECTED ${label}`, payload);\n  } catch {}\n}\n\nexport function recordWindowSetterCall(\n  name: string,\n  detail?: Record<string, unknown>,\n  withStack = false,\n): void {\n  if (!auditEnabled()) return;\n  const payload: Record<string, unknown> = {\n    name,\n    detail: detail || {},\n  };\n  if (withStack) {\n    try {\n      payload.stack = new Error().stack;\n    } catch {}\n  }\n  emitUnexpected('window-setter', payload);\n}\n\nexport function recordScrollModeWrite(event: ScrollModeAuditWrite): void {\n  if (!auditEnabled()) return;\n  const now = Date.now();\n  const writer = event.writer || 'unknown';\n  const from = normalize(event.from);\n  const to = normalize(event.to);\n  if (!to || to === from) return;\n\n  const phase = normalize(event.phase);\n  const reasons: string[] = [];\n\n  if (!EXPECTED_WRITERS.has(writer)) reasons.push('unexpected-writer');\n  if (FORBIDDEN_PHASES.has(phase) && isContinuousMode(to)) reasons.push('forbidden-phase');\n  const deltaMs = lastWriteAt ? now - lastWriteAt : 0;\n  if (lastWriteAt && deltaMs < RACE_WINDOW_MS) reasons.push('rapid-write');\n\n  if (reasons.length > 0) {\n    const payload: Record<string, unknown> = {\n      reasons,\n      writer,\n      from,\n      to,\n      phase: phase || 'unknown',\n      deltaMs: lastWriteAt ? deltaMs : null,\n      lastWriter: lastWriter || null,\n      lastMode: lastMode || null,\n      lastPhase: lastPhase || null,\n    };\n    if (event.source) payload.source = event.source;\n    if (event.via) payload.via = event.via;\n    if (event.stack) {\n      try {\n        payload.stack = new Error().stack;\n      } catch {}\n    }\n    emitUnexpected('scrollMode-write', payload);\n  }\n\n  lastWriteAt = now;\n  lastWriter = writer;\n  lastMode = to;\n  lastPhase = phase;\n}\n\nexport function recordModeTransition(event: ScrollModeAuditWrite): void {\n  if (!auditEnabled()) return;\n  const now = Date.now();\n  if (lastWriteAt && now - lastWriteAt < TRANSITION_SUPPRESS_MS) return;\n  const from = normalize(event.from);\n  const to = normalize(event.to);\n  if (!to || to === from) return;\n  const phase = normalize(event.phase);\n  if (FORBIDDEN_PHASES.has(phase) && isContinuousMode(to)) {\n    const payload: Record<string, unknown> = {\n      reason: 'forbidden-phase',\n      writer: event.writer,\n      from,\n      to,\n      phase: phase || 'unknown',\n    };\n    if (event.source) payload.source = event.source;\n    if (event.via) payload.via = event.via;\n    if (event.stack) {\n      try {\n        payload.stack = new Error().stack;\n      } catch {}\n    }\n    emitUnexpected('scrollMode-transition', payload);\n  }\n}\n", "// src/features/scroll/scroll-prefs.ts\n// Tiny helper to persist scroll mode prefs alongside the TS store.\nimport { withScrollModeWriter } from '../../scroll/audit';\n\nexport type ScrollModePref = 'hybrid' | 'timed' | 'wpm' | 'asr' | 'step' | 'rehearsal';\n\nexport interface ScrollPrefs {\n  mode?: ScrollModePref;\n}\n\nexport interface ScrollStoreLike {\n  get?<T = unknown>(key: string): T;\n  set?<T = unknown>(key: string, value: T): T;\n  subscribe?<T = unknown>(key: string, fn: (value: T) => void): () => void;\n}\n\nconst CANONICAL_KEY = 'scrollMode';\nconst LEGACY_KEYS = ['tp_scroll_prefs_v1', 'tp_scroll_mode_v1', 'tp_scroll_mode'];\n\nfunction normalizeMode(mode: string | null | undefined): ScrollModePref | null {\n  const v = String(mode || '').toLowerCase();\n  if (v === 'manual') return 'step';\n  const allowed: ScrollModePref[] = ['hybrid', 'timed', 'wpm', 'asr', 'step', 'rehearsal'];\n  return allowed.includes(v as ScrollModePref) ? (v as ScrollModePref) : null;\n}\n\nfunction safeParse(raw: string | null): ScrollPrefs | null {\n  if (!raw) return null;\n  try {\n    const parsed = JSON.parse(raw);\n    if (!parsed || typeof parsed !== 'object') return null;\n    const normalized = normalizeMode((parsed as any).mode);\n    if (!normalized) return null;\n    return { mode: normalized };\n  } catch {\n    return null;\n  }\n}\n\nfunction readLegacyMode(key: string, raw: string | null): ScrollModePref | null {\n  if (!raw) return null;\n  if (key === 'tp_scroll_prefs_v1') {\n    return safeParse(raw)?.mode ?? null;\n  }\n  return normalizeMode(raw);\n}\n\nfunction cleanLegacyKeys(storage: Storage) {\n  LEGACY_KEYS.forEach((key) => {\n    try { storage.removeItem(key); } catch {}\n  });\n}\n\nfunction migrateLegacyScrollMode(): ScrollModePref | null {\n  if (typeof window === 'undefined') return null;\n  try {\n    const storage = window.localStorage;\n    const canonical = normalizeMode(storage.getItem(CANONICAL_KEY));\n    if (canonical) {\n      cleanLegacyKeys(storage);\n      return canonical;\n    }\n    for (const key of LEGACY_KEYS) {\n      const legacy = readLegacyMode(key, storage.getItem(key));\n      if (legacy) {\n        storage.setItem(CANONICAL_KEY, legacy);\n        cleanLegacyKeys(storage);\n        return legacy;\n      }\n    }\n    cleanLegacyKeys(storage);\n  } catch {\n    // swallow storage/migration failures\n  }\n  return null;\n}\n\nexport function loadScrollPrefs(): ScrollPrefs | null {\n  try {\n    if (typeof window === 'undefined') return null;\n    const mode = migrateLegacyScrollMode();\n    if (!mode) return null;\n    return { mode };\n  } catch {\n    return null;\n  }\n}\n\nexport function saveScrollPrefs(next: ScrollPrefs): void {\n  try {\n    if (typeof window === 'undefined') return;\n    const normalized = normalizeMode(next?.mode || null);\n    if (!normalized) return;\n    window.localStorage.setItem(CANONICAL_KEY, normalized);\n    cleanLegacyKeys(window.localStorage);\n  } catch {\n    // storage failures are non-fatal\n  }\n}\n\nexport function initScrollPrefsPersistence(store: ScrollStoreLike | undefined | null): void {\n  if (!store) return;\n\n  const fromStore = normalizeMode(store.get?.('scrollMode') as string | undefined);\n  const persisted = normalizeMode(loadScrollPrefs()?.mode);\n  const initial = normalizeMode(fromStore || persisted || 'hybrid') || 'hybrid';\n\n  try {\n    if (!fromStore || fromStore !== initial) {\n      withScrollModeWriter('state/app-store', () => {\n        try { store.set?.('scrollMode', initial as any); } catch {}\n      }, { source: 'migration' });\n    }\n  } catch {\n    // ignore\n  }\n\n  try {\n    store.subscribe?.('scrollMode', (mode: any) => {\n      const normalized = normalizeMode(mode);\n      if (normalized) saveScrollPrefs({ mode: normalized });\n    });\n  } catch {\n    // ignore\n  }\n}\n", "// Minimal app store for centralizing Settings and small app state.\n// Exposes window.__tpStore with get/set/subscribe and automatic persistence for a few keys.\nimport { loadScrollPrefs, saveScrollPrefs } from '../features/scroll/scroll-prefs';\nimport { getScrollModeAuditContext, recordScrollModeWrite } from '../scroll/audit';\n\nconst IS_TEST = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'test';\n\nconst DEVICE_KEY = 'tp_mic_device_v1';\nconst OBS_ENABLED_KEY = 'tp_obs_enabled';\nconst OBS_HOST_KEY = 'tp_obs_host';\nconst OBS_PASSWORD_KEY = 'tp_obs_password';\nconst OBS_SCENE_KEY = 'tp_obs_scene';\nconst OBS_RECONNECT_KEY = 'tp_obs_reconnect';\nconst AUTO_RECORD_KEY = 'tp_auto_record_on_start_v1';\nconst LEGACY_AUTO_RECORD_KEY = 'tp_auto_record';\nconst PREROLL_SEC_KEY = 'tp_preroll_seconds';\nconst DEV_HUD_KEY = 'tp_dev_hud';\nconst SETTINGS_TAB_KEY = 'tp_settings_tab';\nconst LEGACY_ASR_SETTINGS_KEY = 'tp_asr_settings_v1';\nconst ASR_ENGINE_KEY = 'tp_asr_engine_v1';\nconst ASR_LANG_KEY = 'tp_asr_language_v1';\nconst ASR_INTERIM_KEY = 'tp_asr_interim_v1';\nconst ASR_FILTER_KEY = 'tp_asr_filter_v1';\nconst ASR_THRESHOLD_KEY = 'tp_asr_threshold_v1';\nconst ASR_ENDPOINT_KEY = 'tp_asr_endpoint_v1';\nconst ASR_PROFILES_KEY = 'tp_asr_profiles_v1';\nconst ASR_ACTIVE_PROFILE_KEY = 'tp_asr_active_profile_v1';\nconst SINGLE_MONITOR_READ_KEY = 'tp_single_monitor_read_v1';\nconst ASR_CALM_MODE_KEY = 'tp_asr_calm_mode_v1';\nconst ASR_TUNING_PROFILES_KEY = 'tp_asr_tuning_profiles_v1';\nconst ASR_TUNING_ACTIVE_PROFILE_KEY = 'tp_asr_tuning_active_profile_v1';\n\n// Scroll router keys\nconst SCROLL_MODE_KEY = 'scrollMode';\nconst TIMED_SPEED_KEY = 'tp_scroll_timed_speed_v1';\nconst WPM_TARGET_KEY = 'tp_scroll_wpm_target_v1';\nconst WPM_BASEPX_KEY = 'tp_scroll_wpm_basepx_v1';\nconst WPM_MINPX_KEY = 'tp_scroll_wpm_minpx_v1';\nconst WPM_MAXPX_KEY = 'tp_scroll_wpm_maxpx_v1';\nconst WPM_EWMA_KEY = 'tp_scroll_wpm_ewma_v1';\nconst HYB_ATTACK_KEY = 'tp_scroll_hybrid_attack_v1';\nconst HYB_RELEASE_KEY = 'tp_scroll_hybrid_release_v1';\nconst HYB_IDLE_KEY = 'tp_scroll_hybrid_idle_v1';\nconst STEP_PX_KEY = 'tp_scroll_step_px_v1';\nconst REH_PUNCT_KEY = 'tp_scroll_reh_punct_v1';\nconst REH_RESUME_KEY = 'tp_scroll_reh_resume_v1';\nconst ALLOWED_PAGES = new Set<PageName>(['scripts']);\nconst ALLOWED_OVERLAYS = new Set<AppStoreState['overlay']>(['none', 'settings', 'help', 'shortcuts']);\nconst HUD_ENABLED_KEY = 'tp_hud_enabled_v1';\nconst HUD_SPEECH_NOTES_KEY = 'tp_hud_speech_notes_v1';\nconst OVERLAY_KEY = 'tp_overlay_v1';\nconst CAMERA_KEY = 'tp_camera_enabled_v1';\n\ntype SaveStatusState = 'idle' | 'saving' | 'saved' | 'failed';\n\nconst persistMap: Partial<Record<keyof AppStoreState, string>> = {\n  settingsTab: SETTINGS_TAB_KEY,\n  micDevice: DEVICE_KEY,\n  obsEnabled: OBS_ENABLED_KEY,\n  obsScene: OBS_SCENE_KEY,\n  obsReconnect: OBS_RECONNECT_KEY,\n  obsHost: OBS_HOST_KEY,\n  obsPassword: OBS_PASSWORD_KEY,\n  autoRecord: AUTO_RECORD_KEY,\n  prerollSeconds: PREROLL_SEC_KEY,\n  devHud: DEV_HUD_KEY,\n  hudEnabledByUser: HUD_ENABLED_KEY,\n  hudSpeechNotesEnabledByUser: HUD_SPEECH_NOTES_KEY,\n  overlay: OVERLAY_KEY,\n  cameraEnabled: CAMERA_KEY,\n  singleMonitorReadEnabled: SINGLE_MONITOR_READ_KEY,\n  // Scroll router persistence\n  scrollMode: SCROLL_MODE_KEY,\n  timedSpeed: TIMED_SPEED_KEY,\n  wpmTarget: WPM_TARGET_KEY,\n  wpmBasePx: WPM_BASEPX_KEY,\n  wpmMinPx: WPM_MINPX_KEY,\n  wpmMaxPx: WPM_MAXPX_KEY,\n  wpmEwmaSec: WPM_EWMA_KEY,\n  hybridAttackMs: HYB_ATTACK_KEY,\n  hybridReleaseMs: HYB_RELEASE_KEY,\n  hybridIdleMs: HYB_IDLE_KEY,\n  stepPx: STEP_PX_KEY,\n  rehearsalPunct: REH_PUNCT_KEY,\n  rehearsalResumeMs: REH_RESUME_KEY,\n  'asr.engine': ASR_ENGINE_KEY,\n  'asr.language': ASR_LANG_KEY,\n  'asr.useInterimResults': ASR_INTERIM_KEY,\n  'asr.threshold': ASR_THRESHOLD_KEY,\n  'asr.endpointMs': ASR_ENDPOINT_KEY,\n  'asr.filterFillers': ASR_FILTER_KEY,\n  asrCalmModeEnabled: ASR_CALM_MODE_KEY,\n  asrProfiles: ASR_PROFILES_KEY,\n  asrActiveProfileId: ASR_ACTIVE_PROFILE_KEY,\n  asrTuningProfiles: ASR_TUNING_PROFILES_KEY,\n  asrTuningActiveProfileId: ASR_TUNING_ACTIVE_PROFILE_KEY,\n};\n\nfunction parseJson<T>(value: string | null): T | null {\n  if (!value) return null;\n  try {\n    return JSON.parse(value) as T;\n  } catch {\n    return null;\n  }\n}\n\nfunction loadLegacyAsrSettings() {\n  try {\n    if (typeof window === 'undefined') return null;\n    const raw = window.localStorage.getItem(LEGACY_ASR_SETTINGS_KEY);\n    return parseJson<Partial<Record<string, any>>>(raw);\n  } catch {\n    return null;\n  }\n}\n\nexport type PageName = string;\n\ntype Subscriber<T = unknown> = (value: T) => void;\ntype SubscriptionMap = Record<string, Array<Subscriber<any>>>;\n\nexport type AppStoreState = {\n  // UI / Settings\n  settingsTab: string;\n  micDevice: string;\n  obsEnabled: boolean;\n  micGranted: boolean;\n  cameraEnabled: boolean;\n  singleMonitorReadEnabled: boolean;\n  cameraAvailable: boolean;\n  obsScene: string;\n  obsReconnect: boolean;\n  obsHost: string;\n  obsPassword: string;\n  autoRecord: boolean;\n  prerollSeconds: number;\n  devHud: boolean;\n  hudSupported: boolean;\n  hudEnabledByUser: boolean;\n  hudSpeechNotesEnabledByUser: boolean;\n  page: PageName;\n  overlay: 'none' | 'settings' | 'help' | 'shortcuts';\n  asrLive: boolean;\n  'asr.engine': string;\n  'asr.language': string;\n  'asr.useInterimResults': boolean;\n  'asr.filterFillers': boolean;\n  'asr.threshold': number;\n  'asr.endpointMs': number;\n  asrCalmModeEnabled: boolean;\n  asrProfiles: Record<string, unknown>;\n  asrActiveProfileId: string | null;\n  asrTuningProfiles: Record<string, unknown>;\n  asrTuningActiveProfileId: string | null;\n  asrLastAppliedAt: number;\n  asrLastAppliedSummary: Record<string, unknown>;\n  asrLastApplyOk: boolean;\n  settingsSaveStatus: {\n    state: SaveStatusState;\n    at: number;\n    error?: string;\n  };\n\n  // Scroll router (persisted)\n  scrollMode: string;\n  timedSpeed: number;\n  wpmTarget: number;\n  wpmBasePx: number;\n  wpmMinPx: number;\n  wpmMaxPx: number;\n  wpmEwmaSec: number;\n  hybridAttackMs: number;\n  hybridReleaseMs: number;\n  hybridIdleMs: number;\n  stepPx: number;\n  rehearsalPunct: string;\n  rehearsalResumeMs: number;\n\n  // transient session state (not persisted)\n  obsUrl: string;\n  obsPort: string;\n  obsSecure: boolean;\n\n  // fallthrough for any additional keys\n  [key: string]: unknown;\n};\n\nexport interface AppStore {\n  __tsOwned: true;\n  get<K extends keyof AppStoreState>(key: K): AppStoreState[K];\n  set<K extends keyof AppStoreState>(key: K, value: AppStoreState[K]): AppStoreState[K];\n  subscribe<K extends keyof AppStoreState>(key: K, fn: Subscriber<AppStoreState[K]>): () => void;\n  subscribeAll(map: Partial<Record<keyof AppStoreState, Subscriber<AppStoreState[keyof AppStoreState]>>>): () => void;\n  state: AppStoreState;\n  getSnapshot(): AppStoreState;\n}\n\ndeclare global {\n  interface Window {\n    __tpStore?: AppStore;\n  }\n}\n\nfunction migrateAutoRecordFlag() {\n  try {\n    const current = localStorage.getItem(AUTO_RECORD_KEY);\n    if (current !== null && typeof current !== 'undefined') {\n      if (localStorage.getItem(LEGACY_AUTO_RECORD_KEY) !== null) {\n        try {\n          localStorage.removeItem(LEGACY_AUTO_RECORD_KEY);\n        } catch {}\n      }\n      return;\n    }\n    const legacy = localStorage.getItem(LEGACY_AUTO_RECORD_KEY);\n    if (legacy !== null && typeof legacy !== 'undefined') {\n      localStorage.setItem(AUTO_RECORD_KEY, legacy === '1' ? '1' : '0');\n      try {\n        localStorage.removeItem(LEGACY_AUTO_RECORD_KEY);\n      } catch {}\n    }\n  } catch {}\n}\n\nmigrateAutoRecordFlag();\n\nfunction normalizeScrollMode(mode: string | null | undefined): string {\n  const v = String(mode || '').trim().toLowerCase();\n  if (!v) return 'hybrid';\n  if (v === 'manual') return 'step';\n  return v;\n}\n\nfunction readAndMigrateScrollMode(): string {\n  const legacyKeys = ['tp_scroll_mode', 'tp_scroll_mode_v1', 'tp_scroll_mode_v2', 'tp_scroll_mode_backup'];\n  try {\n    // Prefer canonical if present\n    const canonical = localStorage.getItem(SCROLL_MODE_KEY);\n    if (canonical) {\n      const norm = normalizeScrollMode(canonical);\n      if (norm === 'asr') {\n        localStorage.setItem(SCROLL_MODE_KEY, 'hybrid');\n        try { localStorage.setItem('tp_asr_boot_fallback', '1'); } catch {}\n        legacyKeys.forEach((k) => { try { localStorage.removeItem(k); } catch {} });\n        return 'hybrid';\n      }\n      if (norm !== canonical) localStorage.setItem(SCROLL_MODE_KEY, norm);\n      // Clear legacy keys if canonical exists\n      legacyKeys.forEach((k) => { try { localStorage.removeItem(k); } catch {} });\n      return norm;\n    }\n    // Otherwise migrate from any legacy key once\n    for (const k of legacyKeys) {\n      const legacy = localStorage.getItem(k);\n      if (legacy) {\n        const norm = normalizeScrollMode(legacy);\n        if (norm === 'asr') {\n          localStorage.setItem(SCROLL_MODE_KEY, 'hybrid');\n          try { localStorage.setItem('tp_asr_boot_fallback', '1'); } catch {}\n          try { localStorage.removeItem(k); } catch {}\n          return 'hybrid';\n        }\n        localStorage.setItem(SCROLL_MODE_KEY, norm);\n        try { localStorage.removeItem(k); } catch {}\n        return norm;\n      }\n    }\n  } catch {\n    // ignore\n  }\n  return 'hybrid';\n}\n\nfunction buildInitialState(): AppStoreState {\n  const legacyAsrSettings = loadLegacyAsrSettings();\n  return {\n    // UI / Settings\n    settingsTab: (() => {\n      try {\n        return localStorage.getItem(SETTINGS_TAB_KEY) || 'general';\n      } catch {\n        return 'general';\n      }\n    })(),\n    micDevice: (() => {\n      try {\n        return localStorage.getItem(DEVICE_KEY) || '';\n      } catch {\n        return '';\n      }\n    })(),\n    cameraEnabled: (() => {\n      try {\n        const raw = localStorage.getItem(CAMERA_KEY);\n        if (raw == null) return false;\n        return raw === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    cameraAvailable: false,\n    micGranted: false,\n    obsEnabled: (() => {\n      try {\n        return localStorage.getItem(OBS_ENABLED_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    obsScene: (() => {\n      try {\n        return localStorage.getItem(OBS_SCENE_KEY) || '';\n      } catch {\n        return '';\n      }\n    })(),\n    obsReconnect: (() => {\n      try {\n        return localStorage.getItem(OBS_RECONNECT_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    autoRecord: (() => {\n      try {\n        return localStorage.getItem(AUTO_RECORD_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    prerollSeconds: (() => {\n      try {\n        const n = parseInt(localStorage.getItem(PREROLL_SEC_KEY) || '3', 10);\n        return isFinite(n) ? Math.max(0, Math.min(10, n)) : 3;\n      } catch {\n        return 3;\n      }\n    })(),\n    devHud: (() => {\n      try {\n        return localStorage.getItem(DEV_HUD_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    hudSupported: true,\n    hudEnabledByUser: (() => {\n      try {\n        return localStorage.getItem(HUD_ENABLED_KEY) !== '0';\n      } catch {\n        return true;\n      }\n    })(),\n    hudSpeechNotesEnabledByUser: (() => {\n      try {\n        return localStorage.getItem(HUD_SPEECH_NOTES_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    singleMonitorReadEnabled: (() => {\n      try {\n        return localStorage.getItem(SINGLE_MONITOR_READ_KEY) === '1';\n      } catch {\n        return false;\n      }\n    })(),\n    asrLive: false,\n    'asr.engine': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_ENGINE_KEY);\n        if (raw) return raw;\n        if (legacyAsrSettings?.engine && typeof legacyAsrSettings.engine === 'string') {\n          return legacyAsrSettings.engine;\n        }\n      } catch {}\n      return 'webspeech';\n    })(),\n    'asr.language': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_LANG_KEY);\n        if (raw) return raw;\n        if (legacyAsrSettings?.lang && typeof legacyAsrSettings.lang === 'string') {\n          return legacyAsrSettings.lang;\n        }\n      } catch {}\n      return 'en-US';\n    })(),\n    'asr.useInterimResults': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_INTERIM_KEY);\n        if (raw !== null) return raw === '1';\n        if (legacyAsrSettings?.interim !== undefined) return !!legacyAsrSettings.interim;\n      } catch {}\n      return true;\n    })(),\n    'asr.filterFillers': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_FILTER_KEY);\n        if (raw !== null) return raw === '1';\n        if (legacyAsrSettings?.filterFillers !== undefined) return !!legacyAsrSettings.filterFillers;\n      } catch {}\n      return true;\n    })(),\n    'asr.threshold': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_THRESHOLD_KEY);\n        const num = Number(raw);\n        if (raw !== null && !Number.isNaN(num)) return num;\n        if (legacyAsrSettings?.threshold !== undefined) return Number(legacyAsrSettings.threshold) || 0.6;\n      } catch {}\n      return 0.6;\n    })(),\n    'asr.endpointMs': (() => {\n      try {\n        const raw = localStorage.getItem(ASR_ENDPOINT_KEY);\n        const num = Number(raw);\n        if (raw !== null && !Number.isNaN(num)) return num;\n        if (legacyAsrSettings?.endpointMs !== undefined) return Number(legacyAsrSettings.endpointMs) || 700;\n      } catch {}\n      return 700;\n    })(),\n    asrCalmModeEnabled: (() => {\n      try {\n        const raw = localStorage.getItem(ASR_CALM_MODE_KEY);\n        if (raw !== null) return raw === '1';\n      } catch {}\n      return false;\n    })(),\n    asrProfiles: (() => {\n      try {\n        const raw = localStorage.getItem(ASR_PROFILES_KEY);\n        const parsed = parseJson<Record<string, unknown>>(raw);\n        if (parsed && typeof parsed === 'object') return parsed;\n      } catch {}\n      return {};\n    })(),\n    asrActiveProfileId: (() => {\n      try {\n        const raw = localStorage.getItem(ASR_ACTIVE_PROFILE_KEY);\n        if (raw) return raw;\n      } catch {}\n      return null;\n    })(),\n    asrTuningProfiles: (() => {\n      try {\n        const raw = localStorage.getItem(ASR_TUNING_PROFILES_KEY);\n        const parsed = parseJson<Record<string, unknown>>(raw);\n        if (parsed && typeof parsed === 'object') return parsed;\n      } catch {}\n      return {};\n    })(),\n    asrTuningActiveProfileId: (() => {\n      try {\n        const raw = localStorage.getItem(ASR_TUNING_ACTIVE_PROFILE_KEY);\n        if (raw) return raw;\n      } catch {}\n      return null;\n    })(),\n    asrLastAppliedAt: 0,\n    asrLastAppliedSummary: {},\n    asrLastApplyOk: false,\n    settingsSaveStatus: { state: 'idle', at: 0 },\n    overlay: (() => {\n      try {\n        const v = localStorage.getItem(OVERLAY_KEY) || 'none';\n        if (!ALLOWED_OVERLAYS.has(v as any)) {\n          try { localStorage.removeItem(OVERLAY_KEY); } catch {}\n          return 'none';\n        }\n        return v as any;\n      } catch {\n        return 'none';\n      }\n    })(),\n    page: (() => {\n      try {\n        const v = ('scripts') as PageName;\n        if (!ALLOWED_PAGES.has(v)) {\n          // page is no longer persisted\n          return 'scripts';\n        }\n        return v;\n      } catch {\n        return 'scripts';\n      }\n    })(),\n    obsHost: (() => {\n      try {\n        return localStorage.getItem(OBS_HOST_KEY) || '';\n      } catch {\n        return '';\n      }\n    })(),\n    obsPassword: (() => {\n      try {\n        return localStorage.getItem(OBS_PASSWORD_KEY) || '';\n      } catch {\n        return '';\n      }\n    })(),\n\n    // Scroll router (persisted)\n    scrollMode: (() => {\n      const fromPrefs = (() => {\n        try {\n          const prefs = loadScrollPrefs();\n          if (prefs?.mode) return normalizeScrollMode(prefs.mode);\n        } catch {}\n        return null;\n      })();\n      if (fromPrefs === 'asr') {\n        try { localStorage.setItem('tp_asr_boot_fallback', '1'); } catch {}\n      }\n      const migrated = readAndMigrateScrollMode();\n      const chosen = normalizeScrollMode((fromPrefs === 'asr' ? null : fromPrefs) || migrated);\n      try { localStorage.setItem(SCROLL_MODE_KEY, chosen); } catch {}\n      return chosen;\n    })(),\n    timedSpeed: (() => {\n      try {\n        const v = parseFloat(localStorage.getItem(TIMED_SPEED_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 25;\n      } catch {\n        return 25;\n      }\n    })(),\n    wpmTarget: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(WPM_TARGET_KEY) || '');\n        return isFinite(v) && v >= 60 ? v : 180;\n      } catch {\n        return 180;\n      }\n    })(),\n    wpmBasePx: (() => {\n      try {\n        const v = parseFloat(localStorage.getItem(WPM_BASEPX_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 25;\n      } catch {\n        return 25;\n      }\n    })(),\n    wpmMinPx: (() => {\n      try {\n        const v = parseFloat(localStorage.getItem(WPM_MINPX_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 6;\n      } catch {\n        return 6;\n      }\n    })(),\n    wpmMaxPx: (() => {\n      try {\n        const v = parseFloat(localStorage.getItem(WPM_MAXPX_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 200;\n      } catch {\n        return 200;\n      }\n    })(),\n    wpmEwmaSec: (() => {\n      try {\n        const v = parseFloat(localStorage.getItem(WPM_EWMA_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 1.0;\n      } catch {\n        return 1.0;\n      }\n    })(),\n    hybridAttackMs: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(HYB_ATTACK_KEY) || '');\n        return isFinite(v) && v >= 0 ? v : 120;\n      } catch {\n        return 120;\n      }\n    })(),\n    hybridReleaseMs: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(HYB_RELEASE_KEY) || '');\n        return isFinite(v) && v >= 0 ? v : 250;\n      } catch {\n        return 250;\n      }\n    })(),\n    hybridIdleMs: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(HYB_IDLE_KEY) || '');\n        return isFinite(v) && v >= 0 ? v : 1500;\n      } catch {\n        return 1500;\n      }\n    })(),\n    stepPx: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(STEP_PX_KEY) || '');\n        return isFinite(v) && v > 0 ? v : 120;\n      } catch {\n        return 120;\n      }\n    })(),\n    rehearsalPunct: (() => {\n      try {\n        const v = localStorage.getItem(REH_PUNCT_KEY);\n        return v != null && v !== '' ? v : '.,;:?!';\n      } catch {\n        return '.,;:?!';\n      }\n    })(),\n    rehearsalResumeMs: (() => {\n      try {\n        const v = parseInt(localStorage.getItem(REH_RESUME_KEY) || '');\n        return isFinite(v) && v >= 100 ? v : 1000;\n      } catch {\n        return 1000;\n      }\n    })(),\n\n    // transient session state (not persisted)\n    obsUrl: '',\n    obsPort: '',\n    obsSecure: false,\n  };\n}\n\nfunction ensureExistingState(): Partial<AppStoreState> {\n  if (IS_TEST) {\n    try { delete (window as any).__tpStore; } catch {}\n    return {};\n  }\n  try {\n    const existing = (window as any).__tpStore;\n    if (!existing || typeof existing !== 'object') return {};\n    const snapshot =\n      typeof existing.getSnapshot === 'function'\n        ? existing.getSnapshot()\n        : (existing.state as Partial<AppStoreState> | undefined);\n    if (snapshot && typeof snapshot === 'object') return snapshot;\n  } catch {}\n  return {};\n}\n\nfunction sanitizeState(state: AppStoreState): AppStoreState {\n  // Clamp page to allowed set and clean persisted value if invalid\n  if (!ALLOWED_PAGES.has(state.page as PageName)) {\n    state.page = 'scripts';\n  }\n  // Clamp overlay to allowed set and clear bad persisted values\n  if (!ALLOWED_OVERLAYS.has(state.overlay)) {\n    state.overlay = 'none';\n    try { localStorage.removeItem(OVERLAY_KEY); } catch {}\n  }\n  if (state.scrollMode === 'manual') {\n    state.scrollMode = 'step';\n  }\n  if (!state.asrProfiles || typeof state.asrProfiles !== 'object') {\n    state.asrProfiles = {};\n  }\n  if (state.asrActiveProfileId && typeof state.asrActiveProfileId !== 'string') {\n    state.asrActiveProfileId = null;\n  }\n  if (!state.asrTuningProfiles || typeof state.asrTuningProfiles !== 'object') {\n    state.asrTuningProfiles = {};\n  }\n  if (state.asrTuningActiveProfileId && typeof state.asrTuningActiveProfileId !== 'string') {\n    state.asrTuningActiveProfileId = null;\n  }\n  if (typeof state.asrLastAppliedAt !== 'number') {\n    state.asrLastAppliedAt = 0;\n  }\n  if (!state.asrLastAppliedSummary || typeof state.asrLastAppliedSummary !== 'object') {\n    state.asrLastAppliedSummary = {};\n  }\n  if (typeof state.asrLastApplyOk !== 'boolean') {\n    state.asrLastApplyOk = false;\n  }\n  if (!state.settingsSaveStatus || typeof state.settingsSaveStatus !== 'object') {\n    state.settingsSaveStatus = { state: 'idle', at: 0 };\n  }\n  return state;\n}\n\nexport function createAppStore(initial?: Partial<AppStoreState>): AppStore {\n  const subs: SubscriptionMap = Object.create(null);\n  const baseState = buildInitialState();\n  const state: AppStoreState = sanitizeState(\n    Object.assign(\n      {},\n      baseState,\n      ensureExistingState(),\n      initial || {},\n    ),\n  );\n\n  function notify(key: keyof AppStoreState, value: AppStoreState[typeof key]) {\n    try {\n      const k = String(key);\n      const fns = subs[k] || [];\n      for (let i = 0; i < fns.length; i++) {\n        try {\n          fns[i](value);\n        } catch {}\n      }\n    } catch {}\n  }\n\n  function get<K extends keyof AppStoreState>(key: K): AppStoreState[K] {\n    try {\n      return state[key];\n    } catch {\n      return undefined as AppStoreState[K];\n    }\n  }\n\n  function set<K extends keyof AppStoreState>(key: K, value: AppStoreState[K]): AppStoreState[K] {\n    try {\n      if (key === 'page') {\n        value = (ALLOWED_PAGES.has(value as PageName) ? value : 'scripts') as AppStoreState[K];\n      }\n      if (key === 'overlay') {\n        value = (ALLOWED_OVERLAYS.has(value as AppStoreState['overlay']) ? value : 'none') as AppStoreState[K];\n      }\n      const prev = state[key];\n      if (prev === value) return value;\n      state[key] = value;\n      if (key === 'scrollMode') {\n        try {\n          const ctx = getScrollModeAuditContext();\n          recordScrollModeWrite({\n            writer: ctx?.writer || 'unknown',\n            from: prev as any,\n            to: value as any,\n            phase: (state as any)['session.phase'],\n            source: ctx?.meta?.source,\n            via: ctx?.meta?.via,\n            stack: !!ctx?.meta?.stack,\n          });\n        } catch {}\n      }\n      try {\n        const storageKey = persistMap[key];\n      if (storageKey) {\n        if (value === null || typeof value === 'undefined') {\n          localStorage.removeItem(storageKey);\n        } else if (typeof value === 'boolean') {\n          localStorage.setItem(storageKey, value ? '1' : '0');\n        } else if (typeof value === 'object') {\n          try {\n            localStorage.setItem(storageKey, JSON.stringify(value));\n          } catch {\n            // ignore serialization failures\n          }\n        } else {\n          localStorage.setItem(storageKey, String(value));\n        }\n          if (key === 'autoRecord') {\n            try {\n              localStorage.removeItem(LEGACY_AUTO_RECORD_KEY);\n            } catch {}\n          }\n          if (key === 'scrollMode') {\n            saveScrollPrefs({ mode: String(value) as any });\n          }\n        }\n      } catch {}\n      notify(key, value);\n      return value;\n    } catch {\n      return value;\n    }\n  }\n\n  function subscribe<K extends keyof AppStoreState>(\n    key: K,\n    fn: Subscriber<AppStoreState[K]>,\n  ): () => void {\n    if (typeof fn !== 'function') return () => {};\n    const k = String(key);\n    subs[k] = subs[k] || [];\n    subs[k].push(fn);\n    try {\n      fn(state[key]);\n    } catch {}\n    return function unsubscribe() {\n      try {\n        subs[k] = (subs[k] || []).filter((x: Subscriber<AppStoreState[K]>) => x !== fn);\n      } catch {}\n    };\n  }\n\n  function subscribeAll(\n    map: Partial<Record<keyof AppStoreState, Subscriber<AppStoreState[keyof AppStoreState]>>>,\n  ): () => void {\n    const unsubs: Array<() => void> = [];\n    try {\n      for (const k in map) {\n        if (Object.prototype.hasOwnProperty.call(map, k)) {\n          const key = k as keyof AppStoreState;\n          const fn = map[key];\n          if (fn) unsubs.push(subscribe(key, fn as any));\n        }\n      }\n    } catch {}\n    return function unsubscribeAll() {\n      unsubs.forEach((u) => u && u());\n    };\n  }\n\n  const appStore: AppStore = {\n    __tsOwned: true,\n    get,\n    set,\n    subscribe,\n    subscribeAll,\n    state,\n    getSnapshot: () => ({ ...state }),\n  };\n\n  try {\n    if (!IS_TEST) {\n      const w = window as any;\n      const existing = w.__tpStore;\n      if (!existing || !existing.__tsOwned) {\n        try {\n          Object.defineProperty(w, '__tpStore', {\n            value: appStore,\n            writable: true,\n            configurable: true,\n            enumerable: true,\n          });\n        } catch {\n          w.__tpStore = appStore;\n        }\n      }\n    }\n  } catch {}\n\n  return appStore;\n}\n\n// Create and expose a singleton by default so existing imports still work.\nconst appStoreSingleton = createAppStore();\nexport { appStoreSingleton as appStore };\n", "// @ts-nocheck\nexport {};\n\nimport { getScrollWriter } from '../scroll/scroll-writer';\nimport { appStore } from '../state/app-store';\n\n// Lightweight ASR ride-along (JS build) \u2014 mirrors src/index-hooks/asr.ts behavior\n// Uses the Web Speech API directly to avoid TS build requirements in dev.\n\n// Tunables (exported for tests)\nexport const LEAP_CONFIRM_SCORE = 0.75; // high-confidence confirmation threshold\nexport const LEAP_CONFIRM_WINDOW_MS = 600;\nexport const LEAP_SIZE = 4; // nominal leap distance\n// v2 Leap tuning: tighter gate + cooldown\nconst LEAP_TUNING = {\n  minScore: 0.68,      // previously ~0.50 \u2014 require stronger similarity before deferring/confirming a +4 jump\n  maxDistance: 4,      // cap distance (retain existing +4 semantics)\n  cooldownMs: 900,     // block rapid back-to-back leap attempts\n  minTokens: 3         // ignore very short hypothesis fragments\n};\nlet _lastLeapAt = 0;\nexport const POST_COMMIT_FREEZE_MS = 250;\nexport const DISPLAY_MIN_DR = 0.0015;\nexport const NO_COMMIT_HOLD_MS = 1200;\nexport const SILENCE_FREEZE_MS = 2500;\nexport const VAD_PARTIAL_GRACE_MS = 400;\n\n// Internal instance registry for tests/teardown\nconst __asrInstances = new Set();\nconst RESCUE_JUMPS_ENABLED = false; // temp gate: keep HUD telemetry but disable forced reposition\n\nconst scrollWriter = getScrollWriter();\n\nexport function initAsrFeature() {\n  try { console.info('[ASR] dev initAsrFeature()'); } catch {}\n  // Ensure the status chip node exists early, but hidden, to avoid layout shifts before it's placed into the top bar\n  try {\n    // If the scroll router already inserted the ASR speed badge, don't create a duplicate chip yet\n    const existingBadge = document.getElementById('asrSpeedBadge');\n    if (!existingBadge && !document.getElementById('asrChip')) {\n      const s = document.createElement('span');\n      s.id = 'asrChip'; s.className = 'chip'; s.textContent = 'ASR: off';\n      s.style.display = 'none';\n      document.body.appendChild(s);\n    }\n  } catch {}\n  // Simple text normalizer (aligns with TS normalizeText/stripFillers basics)\n  const normalize = (s) => {\n    try { return String(s || '').toLowerCase().replace(/[^a-z0-9\\s']/g, ' ').replace(/\\s+/g, ' ').trim(); } catch { return ''; }\n  };\n  const COVERAGE_THRESHOLD = 0.45; // conservative default; TS uses store threshold but we keep simple here\n\n  // Mount a small status chip in the top bar to reflect ASR state\n  const mountAsrChip = () => {\n    try {\n      // Replace the router's ASR speed badge with the ASR chip (avoid router visibility toggles hiding it)\n      let chip = document.getElementById('asrChip');\n      if (!chip) {\n        const old = document.getElementById('asrSpeedBadge');\n        if (old && old.parentElement) {\n          const repl = document.createElement('span');\n          repl.id = 'asrChip';\n          repl.className = 'chip';\n          repl.textContent = 'ASR: off';\n          try { old.replaceWith(repl); } catch { try { old.parentElement.insertBefore(repl, old); old.remove(); } catch {} }\n          try { repl.dataset.asrMount = 'badge'; } catch {}\n          chip = repl;\n        }\n      }\n      if (!chip) {\n        chip = document.createElement('span');\n        chip.id = 'asrChip'; chip.className = 'chip'; chip.textContent = 'ASR: off'; chip.style.display='none';\n        document.body.appendChild(chip);\n      }\n      chip.setAttribute('aria-live','polite');\n      chip.setAttribute('aria-atomic','true');\n      // If router later inserts the ASR speed badge, hijack it and replace in-place\n      const hijackBadgeIfPresent = () => {\n        try {\n          const badge = document.getElementById('asrSpeedBadge');\n          if (badge && badge.isConnected) {\n            if (badge === chip) return true; // already hijacked (unlikely since ids differ)\n            const host = badge.parentElement;\n            const repl = chip; // move our chip into badge position\n            try { badge.replaceWith(repl); } catch { try { host.insertBefore(repl, badge); badge.remove(); } catch {} }\n            try { repl.dataset.asrMount = 'badge'; repl.style.display = ''; } catch {}\n            return true;\n          }\n        } catch {}\n        return false;\n      };\n      // Attempt immediate hijack, then observe for late insertion\n      if (!hijackBadgeIfPresent()) {\n        try {\n          const moBadge = new MutationObserver(() => { if (hijackBadgeIfPresent()) { try { moBadge.disconnect(); } catch {} } });\n          moBadge.observe(document.documentElement || document.body, { childList: true, subtree: true });\n        } catch {}\n      }\n      // Update on state changes\n      const map = { idle: 'off', ready: 'ready', listening: 'listening', running: 'listening', error: 'error' };\n      window.addEventListener('asr:state', (e) => {\n        try { const st = e?.detail?.state; chip.textContent = 'ASR: ' + (map[st] || st || 'off'); } catch {}\n      });\n      // Move chip into top bar when available (append as last child to reduce clutter)\n      const attach = () => {\n        // If we are reusing the ASR speed badge, it's already mounted in the right place\n        if (chip && chip.isConnected && chip.dataset && chip.dataset.asrMount === 'badge') {\n          try { chip.style.display = ''; } catch {}\n          return true;\n        }\n        const host = document.querySelector('#topbarRight');\n        if (host && host.isConnected) {\n          try { host.appendChild(chip); chip.style.display = ''; return true; } catch {}\n        }\n        return false;\n      };\n      if (!attach()) {\n        let tries = 0; const t = setInterval(() => { tries++; if (attach() || tries > 20) clearInterval(t); }, 150);\n        const mo = new MutationObserver(() => { if (attach()) { try { mo.disconnect(); } catch {} } });\n        mo.observe(document.documentElement || document.body, { childList: true, subtree: true });\n      }\n      return chip;\n    } catch {}\n    return null;\n  };\n\n  class WebSpeechEngine {\n    constructor() {\n      const SR = (window.SpeechRecognition || window.webkitSpeechRecognition);\n      this.SR = SR || null;\n      this.rec = null; this.listeners = new Set(); this.running = false;\n      this._available = !!SR;\n    }\n    on(fn) { try { this.listeners.add(fn); } catch {} }\n    off(fn) { try { this.listeners.delete(fn); } catch {} }\n    emit(ev) { try { this.listeners.forEach(fn => { try { fn(ev); } catch {} }); } catch {} }\n    async start(opts) {\n      if (this.running) return;\n      if (!this._available) { this.emit({ type: 'ready' }); return; }\n      const rec = new this.SR();\n      this.rec = rec; this.running = true;\n      rec.lang = (opts && opts.lang) || 'en-US';\n      rec.interimResults = !!(opts && opts.interim !== false);\n      rec.continuous = true;\n      rec.onstart = () => { this.emit({ type: 'ready' }); this.emit({ type: 'listening' }); };\n      rec.onerror = (e) => { this.emit({ type: 'error', code: e?.error || 'error', message: e?.message || 'speech error' }); };\n      rec.onend = () => { this.running = false; this.emit({ type: 'stopped' }); };\n      rec.onresult = (e) => {\n        try {\n          for (let i = e.resultIndex; i < e.results.length; i++) {\n            const res = e.results[i];\n            const txt = String(res[0]?.transcript || '');\n            const conf = Number(res[0]?.confidence || (res.isFinal ? 1 : 0.5));\n            this.emit({ type: res.isFinal ? 'final' : 'partial', text: txt, confidence: conf });\n          }\n        } catch {}\n      };\n      try { rec.start(); } catch (err) { this.emit({ type: 'error', code: 'start', message: String(err && err.message || err) }); }\n    }\n    async stop() { try { if (this.rec) this.rec.stop(); } catch {} finally { this.running = false; this.emit({ type: 'stopped' }); } }\n  }\n\n  class AsrMode {\n    constructor(opts) {\n      this.opts = Object.assign({ rootSelector: '#scriptRoot, #script, body', lineSelector: '.line, p', markerOffsetPx: 140, windowSize: 6 }, opts || {});\n      this.engine = null; this.state = 'idle'; this.currentIdx = 0; this.rescueCount = 0;\n      // De-dup and gating state\n      this.lastIdx = -1; this.lastScore = 0; this.lastTs = 0; this.pending = null; this.freezeUntil = 0;\n      // Leap confirmation state\n      this._leapPending = { idx: -1, ts: 0 };\n      // Idle/voice tracking\n      this._lastCommitAt = 0; this._lastVADAt = 0; this._lastPartialAt = 0; this._speaking = false;\n      this._scrollAnim = null;\n      // Manual nudge tracking\n      this._nudgedAt = 0; this._nudgedAccepted = false;\n      // Telemetry counters\n      this._stats = { commits: 0, suppressed: { dup: 0, backwards: 0, leap: 0, freeze: 0 }, scoresSum: 0, gaps: [], tweenStepsSum: 0, tweenStepsN: 0 };\n      this._telemetryTimer = null;\n      // Stuck detector bookkeeping\n      this._stuckLastIdx = -1; this._stuckLastAt = 0;\n      // Idle rescue watchdog (accelerated: 3.5s)\n      this._idleRescueMs = 3500; this._idleRescueTimer = setInterval(() => {\n        try {\n          if (this.state !== 'running') return;\n          const now = performance.now();\n          const last = this._lastCommitAt || 0;\n          if (last && now - last > this._idleRescueMs) {\n            // Nudge forward one line (unless at end)\n            const all = this.getAllLineEls();\n            if (all && all.length) {\n              let rescueIdx = Math.min(this.currentIdx + 1, all.length - 1);\n              rescueIdx = this.nextSpokenFrom(rescueIdx);\n              if (rescueIdx !== this.currentIdx) {\n                const detail = { index: rescueIdx, reason: 'idle' };\n                this.dispatch('asr:rescue', detail);\n                try { (window.HUD?.log || console.debug)?.('asr:rescue (idle)', { index: rescueIdx }); } catch {}\n                if (RESCUE_JUMPS_ENABLED) {\n                  this.currentIdx = rescueIdx;\n                  this.scrollToLine(rescueIdx);\n                }\n                this._lastCommitAt = now; // reset window even when we skip the jump\n              }\n            }\n          }\n        } catch {}\n      }, 1000);\n  try { mountAsrChip(); } catch {}\n  try { __asrInstances.add(this); } catch {}\n      // VAD listener for gentle idle/silence behavior\n      try {\n        window.addEventListener('tp:vad', (e) => {\n          try {\n            const speaking = !!(e && e.detail && e.detail.speaking);\n            this._speaking = speaking;\n            this._lastVADAt = performance.now();\n            if (!speaking) {\n              // If silence holds for SILENCE_FREEZE_MS, show ready (avoids creep)\n              const due = this._lastVADAt + SILENCE_FREEZE_MS;\n              setTimeout(() => {\n                try {\n                  const now = performance.now();\n                  // Guard against false-silence: if any partial in last VAD_PARTIAL_GRACE_MS, stay running\n                  if (!this._speaking && now >= due && (now - (this._lastPartialAt || 0)) > VAD_PARTIAL_GRACE_MS) {\n                    this.setState('ready');\n                  }\n                } catch {}\n              }, SILENCE_FREEZE_MS + 10);\n            }\n          } catch {}\n        });\n      } catch {}\n      // Manual nudge/reset safety: wheel or arrow/home/end/page keys\n      try {\n        const reset = () => {\n          try {\n            this.lastIdx = -1; this.lastScore = 0; this.lastTs = 0; this.pending = null; this._leapPending = { idx: -1, ts: 0 };\n            this.dispatch('asr:rescue', { index: this.currentIdx, reason: 'manual' });\n            try { (window.HUD?.log || console.debug)?.('asr:rescue (manual)'); } catch {}\n            this._nudgedAt = performance.now(); this._nudgedAccepted = false;\n          } catch {}\n        };\n        let lastReset = 0;\n        const maybeReset = () => { const now = performance.now(); if (now - lastReset > 300) { lastReset = now; reset(); } };\n        window.addEventListener('wheel', maybeReset, { passive: true });\n        window.addEventListener('keydown', (ev) => {\n          try {\n            const k = (ev && (ev.code || ev.key || '')).toString();\n            if (/Arrow|Page|Home|End/.test(k)) maybeReset();\n          } catch {}\n        }, { capture: true });\n        window.addEventListener('tp:manual-nudge', maybeReset);\n      } catch {}\n    }\n    lineIsSilent(idx) {\n      try { return !!document.querySelector(`.line[data-line-idx=\"${idx}\"][data-silent=\"1\"]`); } catch { return false; }\n    }\n    nextSpokenFrom(idx) {\n      try {\n        const total = this.getAllLineEls().length;\n        let i = idx;\n        while (i < total && this.lineIsSilent(i)) i++;\n        return i;\n      } catch { return idx; }\n    }\n    // Direct index commit (dev/test). Applies the same gating used by tryAdvance, but skips coverage.\n    commitIndex(newIdx, bestScore = 1) {\n      try {\n        if (typeof newIdx !== 'number' || !isFinite(newIdx)) return;\n        if (newIdx < this.currentIdx) { try { this._stats.suppressed.backwards++; } catch {} return; }\n        const delta = newIdx - this.currentIdx;\n        if (!this._leapAllowed(delta, newIdx, bestScore)) return;\n        if (!this.shouldCommit(newIdx, bestScore)) return;\n        if (!this.gateLowConfidence(newIdx, bestScore)) return;\n        newIdx = this.nextSpokenFrom(newIdx);\n        this.currentIdx = newIdx;\n        try { this.scrollToLine(newIdx, bestScore); } catch {}\n        this.dispatch('asr:advance', { index: newIdx, score: bestScore });\n        try { (window.HUD?.log || console.debug)?.('asr:advance(idx)', { index: newIdx, score: Number(bestScore).toFixed(2) }); } catch {}\n        try { this.freezeUntil = performance.now() + POST_COMMIT_FREEZE_MS; } catch {}\n        try {\n          const now = performance.now();\n          if (this._lastCommitAt) { const gap = now - this._lastCommitAt; try { if (isFinite(gap)) this._stats.gaps.push(gap); } catch {} }\n          this._lastCommitAt = now;\n          try { this._stats.commits++; this._stats.scoresSum += (Number(bestScore) || 0); } catch {}\n        } catch {}\n      } catch {}\n    }\n    getState() { return this.state; }\n    async start() {\n      if (this.state !== 'idle') return;\n      // If HUD bus exists (speech-loader routes there), subscribe instead of starting our own SR.\n      const bus = (window.HUD && window.HUD.bus) || (window.__tpHud && window.__tpHud.bus) || null;\n      this._bus = bus;\n      this._busHandlers = [];\n      if (bus && typeof bus.on === 'function') {\n        // Prevent duplicate bindings if start called redundantly during mode flips\n        if (this._bus === bus && this._busHandlers && this._busHandlers.length) {\n          this.setState('listening');\n          this.dispatch('asr:state', { state: 'listening' });\n          return;\n        }\n        const onPartial = (p) => { try { this.onEngineEvent({ type: 'partial', text: String(p?.text || ''), confidence: 0.5 }); } catch {} };\n        const onFinal   = (p) => { try { this.onEngineEvent({ type: 'final',   text: String(p?.text || ''), confidence: 1.0 }); } catch {} };\n        try { bus.on('speech:partial', onPartial); this._busHandlers.push(['speech:partial', onPartial]); } catch {}\n        try { bus.on('speech:final',   onFinal);   this._busHandlers.push(['speech:final',   onFinal]);   } catch {}\n        this.setState('listening');\n        this.dispatch('asr:state', { state: 'listening' });\n        // Announce that we piggybacked on Speech Sync\n        try { (window.HUD?.log || console.debug)?.('asr', { mode: 'bus-follow' }); } catch {}\n        // Start periodic telemetry\n        try { if (this._telemetryTimer) clearInterval(this._telemetryTimer); } catch {}\n        try {\n          this._telemetryTimer = setInterval(() => this._emitStats(), 5000);\n          // In node/test, make timer non-blocking\n          try { this._telemetryTimer?.unref?.(); } catch {}\n        } catch {}\n        return;\n      }\n      // Fallback: start our own Web Speech recognizer\n      this.engine = new WebSpeechEngine();\n      this.engine.on((e) => this.onEngineEvent(e));\n      this.setState('ready');\n      try { if (this._telemetryTimer) clearInterval(this._telemetryTimer); } catch {}\n      try {\n        this._telemetryTimer = setInterval(() => this._emitStats(), 5000);\n        try { this._telemetryTimer?.unref?.(); } catch {}\n      } catch {}\n      await this.engine.start({ lang: 'en-US', interim: true });\n    }\n    async stop() {\n      // Unsubscribe from HUD bus if we used it\n      try {\n        if (this._bus && this._busHandlers && typeof this._bus.off === 'function') {\n          for (const [ev, fn] of this._busHandlers) { try { this._bus.off(ev, fn); } catch {} }\n        }\n      } catch {}\n      this._bus = null; this._busHandlers = [];\n      try { await this.engine?.stop?.(); } catch {}\n      this.setState('idle');\n      this.dispatch('asr:state', { state: this.state });\n      // Final telemetry flush\n      try { this._emitStats(true); } catch {}\n      try { if (this._telemetryTimer) clearInterval(this._telemetryTimer); } catch {}\n    }\n    onEngineEvent(e) {\n      if (e.type === 'ready') this.setState('ready');\n      if (e.type === 'listening') this.setState('listening');\n      if (e.type === 'partial' || e.type === 'final') {\n        if (this.state !== 'running') this.setState('running');\n        const text = normalize(e.text);\n        if (e.type === 'partial') { try { this._lastPartialAt = performance.now(); } catch {} }\n        this.tryAdvance(text, e.type === 'final', Number(e.confidence || (e.type === 'final' ? 1 : 0.5)));\n      }\n      if (e.type === 'error') { this.setState('error'); this.dispatch('asr:error', { code: e.code, message: e.message }); }\n      if (e.type === 'stopped') { this.setState('idle'); }\n    }\n  setState(s) { this.state = s; this.dispatch('asr:state', { state: s }); try { (window.HUD?.log || console.debug)?.('asr:state', s); } catch {} }\n    dispatch(name, detail) { try { window.dispatchEvent(new CustomEvent(name, { detail })); } catch {} }\n    getAllLineEls() {\n      const root = document.querySelector(this.opts.rootSelector) || document.body;\n      const list = Array.from(root.querySelectorAll(this.opts.lineSelector));\n      return list.length ? list : Array.from(document.querySelectorAll('.line, p'));\n    }\n    getWindow() {\n      const els = this.getAllLineEls();\n      const start = Math.max(0, Math.min(this.currentIdx, Math.max(0, els.length - 1)));\n      const end = Math.max(start, Math.min(els.length, start + this.opts.windowSize));\n      const texts = els.slice(start, end).map(el => normalize(el.textContent || ''));\n      return { lines: texts, idx0: start };\n    }\n    shouldCommit(idx, score) {\n      try {\n        const now = performance.now();\n        const sameIdx = idx === this.lastIdx;\n        const scoreGain = (Number(score) || 0) - (Number(this.lastScore) || 0);\n        // Manual nudge semantics: allow one same-line acceptance after nudge; subsequent same-line requires score gain >= 0.1\n        if (this._nudgedAt && idx === this.currentIdx) {\n          if (!this._nudgedAccepted) { this._nudgedAccepted = true; this.lastIdx = idx; this.lastScore = Number(score) || 0; this.lastTs = now; return true; }\n          if (scoreGain < 0.10) { try { this._stats.suppressed.dup++; } catch {} return false; }\n        }\n        if (sameIdx && scoreGain < 0.12 && (now - (this.lastTs || 0)) < 350) { try { this._stats.suppressed.dup++; } catch {} return false; }\n        this.lastIdx = idx; this.lastScore = Number(score) || 0; this.lastTs = now;\n        return true;\n      } catch { return true; }\n    }\n    gateLowConfidence(idx, score) {\n      try {\n        const now = performance.now();\n        const LOW = 0.55, WINDOW = 1200;\n        const s = Number(score) || 0;\n        if (s >= LOW) { this.pending = null; return true; }\n        const p = this.pending;\n        if (!p || p.idx !== idx || (now - p.ts) > WINDOW) { this.pending = { idx, score: s, ts: now }; return false; }\n        this.pending = null; return true;\n      } catch { return true; }\n    }\n    smoothScrollTo(scroller, top, ms = 160, score = 1) {\n      // Discrete stepped tween (reduces scroll spam to ~3-5 writes per commit)\n      try { if (this._scrollAnim && this._scrollAnim.cancel) this._scrollAnim.cancel(); } catch {}\n      const isWin = (scroller === document.scrollingElement || scroller === document.body);\n      const from = isWin ? (window.scrollY || window.pageYOffset || 0) : (scroller.scrollTop || 0);\n      const delta = Number(top || 0) - Number(from || 0);\n      // Deadband at target (\u00B10.002 scroll ratio)\n      try {\n        const denom = isWin ? ((document.documentElement?.scrollHeight || 0) - (window.innerHeight || 0)) : ((scroller.scrollHeight || 0) - (scroller.clientHeight || 0));\n        if (denom > 0) {\n          const rFrom = from / denom; const rTo = Number(top || 0) / denom;\n          if (Math.abs(rTo - rFrom) < 0.002) { try { this._stats.tweenStepsN++; } catch {} return 0; }\n        }\n      } catch {}\n      let cancelled = false;\n      // Score-aware steps: shaky spans snappy; rock-solid silky\n      let steps = Math.max(3, Math.min(5, Math.round(ms / 50))); // base 3-5\n      const s = Number(score) || 0;\n      if (s >= 0.85) steps = 5;\n      else if (s >= 0.5 && s <= 0.6) steps = Math.min(steps, 3);\n      try { this._stats.tweenStepsSum += steps; this._stats.tweenStepsN++; } catch {}\n      let i = 0;\n      const write = () => {\n        if (cancelled) return;\n        i++;\n        const k = i / steps;\n        const y = from + delta * (k < 0 ? 0 : (k > 1 ? 1 : k));\n        try { scrollWriter.scrollTo(y, { behavior: 'auto' }); } catch {}\n        if (i < steps) requestAnimationFrame(write);\n      };\n      this._scrollAnim = { cancel: () => { cancelled = true; } };\n      requestAnimationFrame(write);\n      return steps;\n    }\n    _leapAllowed(delta, idx, score) {\n      try {\n        if (delta < LEAP_SIZE) return true; // small forward movement\n        const now = performance.now();\n        const s = Number(score) || 0;\n        const tokenCount = this._lastHypTokensCount || 0;\n        // Hard gates first\n        if (Math.abs(delta) > LEAP_TUNING.maxDistance) return false;\n        if (s < LEAP_TUNING.minScore) { try { this._stats.suppressed.leap++; } catch {}; return false; }\n        if (tokenCount < LEAP_TUNING.minTokens) { try { this._stats.suppressed.leap++; } catch {}; return false; }\n        if ((now - _lastLeapAt) < LEAP_TUNING.cooldownMs) { try { this._stats.suppressed.leap++; } catch {}; return false; }\n        // Confirmation pathway\n        if (s >= LEAP_CONFIRM_SCORE) {\n          this._leapPending = { idx: -1, ts: 0 }; _lastLeapAt = now;\n          try { (window.HUD?.log || console.debug)?.('asr:confirm leap \\u2713', { d: '+' + delta }); } catch {}\n          return true;\n        }\n        if (this._leapPending && this._leapPending.idx === idx) {\n          if ((now - this._leapPending.ts) <= LEAP_CONFIRM_WINDOW_MS) {\n            this._leapPending = { idx: -1, ts: 0 }; _lastLeapAt = now;\n            try { (window.HUD?.log || console.debug)?.('asr:confirm leap \\u2713', { d: '+' + delta }); } catch {}\n            return true;\n          } else {\n            try { (window.HUD?.log || console.debug)?.('asr:confirm expired'); } catch {}\n            try { this._stats.suppressed.leap++; } catch {}\n          }\n        }\n        this._leapPending = { idx, ts: now }; _lastLeapAt = now;\n        try { (window.HUD?.log || console.debug)?.('asr:defer leap', { d: '+' + delta, score: s.toFixed(2) }); } catch {}\n        try { this._stats.suppressed.leap++; } catch {}\n        return false;\n      } catch { return true; }\n    }\n  tryAdvance(hyp, isFinal, confidence) {\n      // Freeze briefly after big jumps to avoid rubber-banding on line starts\n      try {\n        const now = performance.now();\n        if (now < (this.freezeUntil || 0)) {\n          const ms = Math.max(0, Math.round((this.freezeUntil || 0) - now));\n          try { this._stats.suppressed.freeze++; } catch {}\n          try { (window.HUD?.log || console.debug)?.('asr:drop freeze', { ms }); } catch {}\n          return;\n        }\n      } catch {}\n      // Cache hyp token count for leap gating\n      try { this._lastHypTokensCount = String(hyp || '').split(/\\s+/).filter(Boolean).length; } catch { this._lastHypTokensCount = 0; }\n      const { lines, idx0 } = this.getWindow();\n      let bestIdx = -1, bestScore = 0;\n      for (let i = 0; i < lines.length; i++) {\n        const score = coverageScore(lines[i], hyp) * (confidence || 1);\n        if (score > bestScore) { bestScore = score; bestIdx = i; }\n      }\n      const thr = Number(localStorage.getItem('tp_asr_threshold') || COVERAGE_THRESHOLD) || COVERAGE_THRESHOLD;\n      if (bestIdx >= 0 && bestScore >= thr) {\n  let newIdx = idx0 + bestIdx;\n        if (newIdx < this.currentIdx) { try { this._stats.suppressed.backwards++; } catch {} return; }\n        if (newIdx === this.currentIdx) { /* allow dedupe logic below to decide */ }\n        const delta = newIdx - this.currentIdx;\n        // Leap confirmation guard\n        if (!this._leapAllowed(delta, newIdx, bestScore)) return;\n        if (!this.shouldCommit(newIdx, bestScore)) return;\n        if (!this.gateLowConfidence(newIdx, bestScore)) return;\n  // Skip silent cue lines (pause/beat) automatically\n  newIdx = this.nextSpokenFrom(newIdx);\n  this.currentIdx = newIdx;\n        this.scrollToLine(newIdx, bestScore);\n        this.dispatch('asr:advance', { index: newIdx, score: bestScore });\n        try { (window.HUD?.log || console.debug)?.('asr:advance', { index: newIdx, score: Number(bestScore).toFixed(2) }); } catch {}\n        // Micro freeze after commit (applies to all commits, keeps double-fires down)\n        try { this.freezeUntil = performance.now() + POST_COMMIT_FREEZE_MS; } catch {}\n        // Mark commit time for idle-hold logic\n        try {\n          const now = performance.now();\n          if (this._lastCommitAt) { const gap = now - this._lastCommitAt; try { if (isFinite(gap)) this._stats.gaps.push(gap); } catch {} }\n          this._lastCommitAt = now;\n          try { this._stats.commits++; this._stats.scoresSum += (Number(bestScore) || 0); } catch {}\n        } catch {}\n        // End-of-script courtesy stop\n        try {\n          const total = this.getAllLineEls().length;\n          if (newIdx >= total - 1) { try { window.dispatchEvent(new CustomEvent('asr:stop')); } catch {} }\n        } catch {}\n        // Same-index stuck detector (nudges forward after STUCK.ms without commit change)\n        try {\n          const now2 = performance.now();\n          if (newIdx === this._stuckLastIdx) {\n            if (now2 - this._stuckLastAt > 2500) { // STUCK.ms\n              let rescueIdx = Math.min(newIdx + 1, this.getAllLineEls().length - 1);\n              rescueIdx = this.nextSpokenFrom(rescueIdx);\n              if (rescueIdx !== newIdx) {\n                const detail = { index: rescueIdx, reason: 'same-index' };\n                this.dispatch('asr:rescue', detail);\n                try { (window.HUD?.log || console.debug)?.('asr:rescue (same-index)', { from: newIdx, to: rescueIdx }); } catch {}\n                if (RESCUE_JUMPS_ENABLED) {\n                  this.currentIdx = rescueIdx;\n                  this.scrollToLine(rescueIdx);\n                }\n              }\n              this._stuckLastAt = now2; // reset window\n            }\n          } else { this._stuckLastIdx = newIdx; this._stuckLastAt = now2; }\n        } catch {}\n      } else if (isFinal) {\n        this.rescueCount++;\n        if (this.rescueCount <= 2) {\n          let rIdx = Math.min(this.currentIdx + 1, this.getAllLineEls().length - 1);\n          rIdx = this.nextSpokenFrom(rIdx);\n          const detail = { index: rIdx, reason: 'weak-final' };\n          this.dispatch('asr:rescue', detail);\n          try { (window.HUD?.log || console.debug)?.('asr:rescue', { index: rIdx }); } catch {}\n          if (RESCUE_JUMPS_ENABLED) {\n            this.currentIdx = rIdx;\n            this.scrollToLine(this.currentIdx);\n          }\n        }\n      }\n    }\n    scrollToLine(idx, score = 1) {\n      const els = this.getAllLineEls();\n      const target = els[idx]; if (!target) return;\n      // Skip during pre-roll\n      try {\n        const ov = document.getElementById('countOverlay');\n        if (ov) { const cs = getComputedStyle(ov); const visible = cs.display !== 'none' && cs.visibility !== 'hidden' && !ov.classList.contains('hidden'); if (visible) return; }\n      } catch {}\n      const scroller = findScroller(target); const marker = this.opts.markerOffsetPx;\n      const top = elementTopRelativeTo(target, scroller) - marker;\n      try { const steps = this.smoothScrollTo(scroller, top, 160, score); if (typeof steps === 'number') { /* stats updated inside */ } } catch {}\n    }\n    _emitStats(final = false) {\n      try {\n        const commits = this._stats.commits || 0;\n        const avgScore = commits ? (this._stats.scoresSum / commits) : 0;\n        const tweenStepsAvg = (this._stats.tweenStepsN ? (this._stats.tweenStepsSum / this._stats.tweenStepsN) : 0);\n        let p95GapMs = 0;\n        if (this._stats.gaps && this._stats.gaps.length) {\n          const arr = this._stats.gaps.slice().sort((a,b)=>a-b);\n          const idx = Math.min(arr.length - 1, Math.floor(arr.length * 0.95));\n          p95GapMs = arr[idx] || 0;\n        }\n        const payload = {\n          commits,\n          suppressed: Object.assign({ dup:0, backwards:0, leap:0, freeze:0 }, this._stats.suppressed || {}),\n          avgScore: Number(avgScore.toFixed(3)),\n          p95GapMs: Math.round(p95GapMs),\n          tweenStepsAvg: Number(tweenStepsAvg.toFixed(2))\n        };\n        window.dispatchEvent(new CustomEvent('asr:stats', { detail: payload }));\n      } catch {}\n      // Reset counters for next window\n      this._stats = { commits: 0, suppressed: { dup: 0, backwards: 0, leap: 0, freeze: 0 }, scoresSum: 0, gaps: [], tweenStepsSum: 0, tweenStepsN: 0 };\n      if (final) { try { if (this._telemetryTimer) clearInterval(this._telemetryTimer); } catch {} }\n    }\n  }\n\n  // Small helpers for scrolling/coverage\n  function coverageScore(line, hyp) {\n    try {\n      const A = new Set(String(line || '').split(' ').filter(Boolean));\n      const B = new Set(String(hyp || '').split(' ').filter(Boolean));\n      if (A.size === 0) return 0; let inter = 0; for (const w of A) if (B.has(w)) inter++; return inter / A.size;\n    } catch { return 0; }\n  }\n  function findScroller(el) {\n    let node = el?.parentElement;\n    while (node) { try { const st = getComputedStyle(node); if (/(auto|scroll)/.test(st.overflowY || '')) return node; } catch {} node = node.parentElement; }\n    return document.scrollingElement || document.body;\n  }\n  function elementTopRelativeTo(el, scroller) {\n    const r1 = el.getBoundingClientRect();\n    const isWin = (scroller === document.scrollingElement || scroller === document.body);\n    const r2 = isWin ? { top: 0 } : scroller.getBoundingClientRect();\n    const scrollTop = isWin ? window.pageYOffset : scroller.scrollTop;\n    return r1.top - r2.top + scrollTop;\n  }\n\n  // Coordinator: follow Speech Sync and Mode changes; interlock auto-scroll\n  let asrMode = null; let speechActive = false; let asrActive = false; let autoHeld = false;\n  // Allow a dev/test override of mode via window.__tpModeOverride or tp:mode events\n  const getScrollMode = () => {\n    try {\n      const ov = (typeof window.__tpModeOverride === 'string') ? window.__tpModeOverride : null;\n      if (ov) return String(ov).toLowerCase();\n      const store = (window as any).__tpStore || appStore;\n      const v = store?.get?.('scrollMode');\n      if (typeof v === 'string') return v.toLowerCase();\n    } catch {}\n    return '';\n  };\n  const wantASR = () => getScrollMode() === 'asr';\n  const setChipVisible = (on) => { try { const c = document.getElementById('asrChip'); if (c) c.style.display = on ? '' : 'none'; } catch {} };\n  const setChipState = (state) => { try { window.dispatchEvent(new CustomEvent('asr:state', { detail: { state } })); } catch {} };\n  const holdAuto = () => {\n    if (autoHeld) return; autoHeld = true;\n    try { window.__scrollCtl?.stop?.(); } catch {}\n    try { (window.__tpAuto || window.Auto || window.__scrollCtl)?.setEnabled?.(false); } catch {}\n    try { window.dispatchEvent(new CustomEvent('autoscroll:disable', { detail: 'asr' })); } catch {}\n  };\n  const releaseAuto = () => {\n    if (!autoHeld) return; autoHeld = false;\n    // Do not auto-start on release; user intent or router will decide to re-enable\n    try { window.dispatchEvent(new CustomEvent('autoscroll:enable', { detail: 'asr' })); } catch {}\n  };\n  const ensureMode = async () => { if (!asrMode) asrMode = new AsrMode({}); return asrMode; };\n  const isSettingsHydrating = () => { try { return !!(window as any).__tpSettingsHydrating; } catch { return false; } };\n  const start = async () => {\n    if (asrActive) return;\n    if (isSettingsHydrating()) {\n      try { console.debug('[ASR] start blocked during settings hydration'); } catch {}\n      return;\n    }\n    try { const m = await ensureMode(); holdAuto(); await m.start(); asrActive = true; }\n    catch (err) { asrActive = false; releaseAuto(); try { console.warn('[ASR] start failed', err); } catch {} }\n  };\n  const stop  = async () => { if (!asrActive) return; try { await asrMode?.stop?.(); } finally { asrActive = false; releaseAuto(); } };\n\n  window.addEventListener('tp:speech-state', (ev) => {\n    try {\n      const d = ev?.detail || {}; const on = (d.running === true) || (typeof d.state === 'string' && (d.state === 'active' || d.state === 'running'));\n      speechActive = !!on;\n      // Reflect speech activity on the chip even outside pure ASR mode (e.g., Hybrid)\n      try { window.dispatchEvent(new CustomEvent('asr:state', { detail: { state: on ? 'listening' : 'idle' } })); } catch {}\n      // Idle-hold: if speaking but no commits for NO_COMMIT_HOLD_MS, keep 'running' (don't show idle)\n      try {\n        if (asrMode && asrMode._speaking) {\n          const due = asrMode._lastCommitAt + NO_COMMIT_HOLD_MS;\n          if (performance.now() > due && asrMode.state === 'running') {\n            // no-op: intentionally keep state 'running'; do not downgrade\n          }\n        }\n      } catch {}\n      if (speechActive && wantASR()) void start(); else void stop();\n    } catch {}\n  });\n  // Dev/test: mode override event (avoids DOM select in headless harness)\n  window.addEventListener('tp:mode', (ev) => {\n    try {\n      const m = (ev && ev.detail && ev.detail.mode) ? String(ev.detail.mode) : '';\n      if (!m) return;\n      try { window.__tpModeOverride = m; } catch {}\n      // If speech is active, apply start/stop based on new mode\n      if (speechActive) { wantASR() ? void start() : void stop(); }\n    } catch {}\n  });\n  try {\n    const store = (window as any).__tpStore || appStore;\n    store?.subscribe?.('scrollMode', () => {\n      const isAsr = wantASR();\n      if (isAsr) {\n        try { mountAsrChip(); } catch {}\n        setChipVisible(true);\n        setChipState(speechActive ? 'listening' : 'ready');\n      } else {\n        setChipState('idle');\n        setChipVisible(false);\n      }\n      if (!speechActive) return; // Do not start/stop engine when speech is off\n      isAsr ? void start() : void stop();\n    });\n  } catch {}\n  window.addEventListener('asr:toggle', (e) => { const armed = !!(e?.detail?.armed); armed ? void start() : void stop(); });\n  window.addEventListener('asr:stop', () => { void stop(); });\n\n  // Dev/test: direct speech-result hook (final-only) to drive commits without full coverage engine\n  // detail: { type: 'partial'|'final', index: number, score?: number }\n  window.addEventListener('tp:speech-result', (ev) => {\n    try {\n      if (!asrMode || !asrActive) return;\n      const d = ev && ev.detail || {};\n      const idx = Number(d.index);\n      if (!isFinite(idx)) return;\n      if (String(d.type || '').toLowerCase() !== 'final') return; // ignore partial in this minimal hook\n      // Allow test harness to jump directly: pre-position currentIdx when the leap exceeds our confirmation window.\n      // This keeps commitIndex gating intact while avoiding synthetic large-leap suppression in headless smoke tests.\n      try {\n        const cur = Number(asrMode.currentIdx || 0);\n        const delta = idx - cur;\n        if (delta > (LEAP_TUNING.maxDistance || LEAP_SIZE)) {\n          // Pre-position just behind the target to turn the jump into a small forward move\n          asrMode.currentIdx = Math.max(0, idx - 1);\n        }\n      } catch {}\n      try { asrMode.commitIndex?.(idx, Number(d.score || 1)); } catch {}\n    } catch {}\n  });\n\n  // Late-load reconcile\n  try {\n    const body = document.body; speechActive = !!(body && (body.classList.contains('speech-listening') || body.classList.contains('listening'))) || (window.speechOn === true);\n    const isAsr = wantASR();\n    if (isAsr) { try { mountAsrChip(); } catch {} setChipVisible(true); setChipState(speechActive ? 'listening' : 'ready'); }\n    else { setChipVisible(false); }\n    if (speechActive && isAsr) void start();\n  } catch {}\n}\n\nexport default initAsrFeature;\n\n// Test hook: tear down any live ASR instances and clear timers\nexport async function teardownASR() {\n  try {\n    for (const inst of Array.from(__asrInstances)) {\n      try { await inst.stop?.(); } catch {}\n      try { inst._emitStats?.(true); } catch {}\n      try { if (inst._telemetryTimer) clearInterval(inst._telemetryTimer); } catch {}\n      try { inst._telemetryTimer?.unref?.(); } catch {}\n    }\n  } catch {}\n  try { __asrInstances.clear?.(); } catch {}\n}\n\n// Also expose a window helper for headless smokes that don't import ESM named exports\ntry { if (typeof window !== 'undefined') { window.__asrFinalizeForTests = teardownASR; } } catch {}\n\n"],
  "mappings": "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",
  "names": ["primary", "fallback", "normalize", "start"]
}
