{
  "version": 3,
  "sources": ["recorders-core.ts", "recorders-bridge-compat.ts"],
  "sourcesContent": ["/* ------------------------------------------------------------------\r\n * Recorder core (registry + SSOT engine)\r\n * ------------------------------------------------------------------ */\r\n\r\ndeclare global {\r\n  // Allow legacy globals (e.g., window.__tpHud) without sprinkling casts everywhere.\r\n  interface Window {\r\n    [key: string]: any;\r\n  }\r\n}\r\n\r\nexport interface RecorderAdapter {\r\n  id: string;\r\n  label: string;\r\n  isAvailable(): Promise<boolean>;\r\n  start(): Promise<void>;\r\n  stop(): Promise<void>;\r\n  test?(): Promise<unknown>;\r\n  configure?(cfg: Record<string, unknown>): void;\r\n}\r\n\r\nexport type RecorderMode = 'single' | 'multi';\r\n\r\nexport interface RecorderSettings {\r\n  mode: RecorderMode;\r\n  selected: string[];\r\n  preferObsHandoff: boolean;\r\n  configs: Record<string, Record<string, unknown>>;\r\n  timeouts: { start: number; stop: number };\r\n  failPolicy: 'continue' | 'abort-on-first-fail';\r\n}\r\n\r\ntype RecState = 'idle' | 'starting' | 'recording' | 'stopping' | 'error';\r\ntype RecorderResult = { id: string; ok: boolean; error?: string; detail?: Record<string, unknown> };\r\ntype StartResults = { results: RecorderResult[]; started: string[]; reason?: string };\r\ntype StopResults = { results: RecorderResult[] };\r\ninterface RecStats {\r\n  starts: number;\r\n  retries: number;\r\n  fallbacks: number;\r\n  disconnects: number;\r\n  startLat: number[];\r\n  stopLat: number[];\r\n}\r\n\r\n// Simple recorder adapter registry\r\n// Usage:\r\n//   import { register, get, all } from './recorders.js';\r\n//   register({ id: 'bridge', label: 'Bridge', isAvailable: async () => true, start: async ()=>{}, stop: async ()=>{} });\r\n//   const adapter = get('bridge');\r\n//   const list = all();\r\n\r\n/**\r\n * @typedef {Object} RecorderAdapter\r\n * @property {string} id                       // e.g. \"obs\", \"companion\", \"bridge\"\r\n * @property {string} label                    // e.g. \"OBS (WebSocket)\"\r\n * @property {() => Promise<boolean>} isAvailable\r\n * @property {() => Promise<void>} start\r\n * @property {() => Promise<void>} stop\r\n * @property {() => Promise<void>} [test]      // optional \u201CTest\u201D button\r\n * @property {(cfg: any) => void} [configure]  // pass settings in\r\n */\r\n\r\nfunction __tpReadAutoRecordPref(): boolean {\r\n  try {\r\n    if (typeof window !== 'undefined') {\r\n      const store = (window as any).__tpStore;\r\n      if (store && typeof store.get === 'function') {\r\n        const v = store.get('autoRecord');\r\n        if (typeof v === 'boolean') return v;\r\n      }\r\n    }\r\n  } catch {}\r\n  try {\r\n    const doc = typeof document !== 'undefined' ? document : null;\r\n    if (doc) {\r\n      const el = (doc.getElementById('autoRecordToggle') as HTMLInputElement | null)\r\n        || (doc.getElementById('autoRecord') as HTMLInputElement | null);\r\n      if (el) return !!el.checked;\r\n    }\r\n  } catch {}\r\n  try {\r\n    return localStorage.getItem('tp_auto_record_on_start_v1') === '1';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/* ------------------------------------------------------------------\r\n * SSOT Recording API \u2014 window.__tpRecording\r\n * One call: start()/stop() routes to OBS / Bridge / Premiere\r\n * Reads config from either a top-level 'configs' blob or 'tp_rec_settings_v1'.\r\n * ------------------------------------------------------------------ */\r\n(function(){\r\n      try {\r\n        if (typeof window === 'undefined') return;\r\n        const DEFAULT_ADAPTER = 'recorder';\r\n        const LS = {\r\n          cfg: 'configs',                 // whole app config blob (optional)\r\n          recAdapter: 'tp_rec_adapter',   // 'obs' | 'bridge' | 'premiere'\r\n          autoStart: 'tp_auto_record_on_start_v1',\r\n          modern: 'tp_rec_settings_v1',   // modern settings blob from registry (has .configs)\r\n        };\r\n\r\n        function getJSON<T>(k: string, d: T): T {\r\n          try {\r\n            const raw = localStorage.getItem(k);\r\n            return raw ? (JSON.parse(raw) as T) : d;\r\n          } catch {\r\n            return d;\r\n          }\r\n        }\r\n        function getCfg(){\r\n          // Merge top-level configs with modern settings.configs\r\n          const a = getJSON<Record<string, any>>(LS.cfg, {});\r\n          const b = getJSON<Record<string, any>>(LS.modern, {});\r\n          const inner = (b && b.configs) || {};\r\n          // Top-level may also carry a recording sub-blob\r\n          const merged = { ...inner, ...a };\r\n          if (a && a.recording) merged.recording = a.recording;\r\n          return merged;\r\n        }\r\n        function getSelectedAdapterId(){\r\n          const cfg = getCfg();\r\n          try {\r\n            return (cfg.recording && cfg.recording.adapter)\r\n              || localStorage.getItem(LS.recAdapter)\r\n              || DEFAULT_ADAPTER;\r\n          } catch {\r\n            return DEFAULT_ADAPTER;\r\n          }\r\n        }\r\n        function wantsAuto(){\r\n          return __tpReadAutoRecordPref();\r\n        }\r\n        function getAdapter(id?: string | null){\r\n          if (typeof id === 'string' && id.length > 0) {\r\n            try { return get(id); } catch { return undefined; }\r\n          }\r\n          return getSelectedAdapterId();\r\n        }\r\n\r\n        async function httpSend(url: string, body?: unknown){\r\n          if (!url) throw new Error('Missing URL');\r\n          const res = await fetch(url, {\r\n            method: body ? 'POST' : 'GET',\r\n            headers: body ? { 'content-type': 'application/json' } : undefined,\r\n            body: body ? JSON.stringify(body) : undefined,\r\n            mode: 'no-cors',\r\n          });\r\n          // In no-cors mode, ok may be false even if delivered; consider as best-effort success\r\n          try { return !!res.ok || true; } catch { return true; }\r\n        }\r\n\r\n        function bridgeCfg(){\r\n          const cfg = getCfg().bridge || {};\r\n          return {\r\n            mode: cfg.mode || 'hotkey',\r\n            baseUrl: String(cfg.baseUrl || 'http://127.0.0.1:5723').replace(/\\/+$/, ''),\r\n            startHotkey: cfg.startHotkey || cfg.preset || 'Ctrl+R',\r\n            stopHotkey: cfg.stopHotkey || '',\r\n            startUrl: cfg.startUrl || '',\r\n            stopUrl: cfg.stopUrl || '',\r\n          };\r\n        }\r\n\r\n        function getRecorderSurface(){\r\n          try {\r\n            const w = window as any;\r\n            return w.__tpRecorder || w.__recorder || null;\r\n          } catch {\r\n            return null;\r\n          }\r\n        }\r\n\r\n        async function recorderStart(){\r\n          const rec = getRecorderSurface();\r\n          if (!rec || typeof rec.start !== 'function') return true;\r\n          try {\r\n            await rec.start();\r\n            return true;\r\n          } catch (err) {\r\n            try { console.warn('[recorder] start failed', err); } catch {}\r\n            return false;\r\n          }\r\n        }\r\n\r\n        async function recorderStop(){\r\n          const rec = getRecorderSurface();\r\n          if (!rec || typeof rec.stop !== 'function') return true;\r\n          try {\r\n            await rec.stop();\r\n            return true;\r\n          } catch (err) {\r\n            try { console.warn('[recorder] stop failed', err); } catch {}\r\n            return false;\r\n          }\r\n        }\r\n\r\n        async function bridgeStart(){\r\n          const b = bridgeCfg();\r\n          if (b.mode === 'http') {\r\n            return httpSend(b.startUrl);\r\n          }\r\n          const url = b.baseUrl + '/send?keys=' + encodeURIComponent(b.startHotkey);\r\n          try { return await httpSend(url); }\r\n          catch { return httpSend(b.baseUrl + '/send', { keys: b.startHotkey }); }\r\n        }\r\n        async function bridgeStop(){\r\n          const b = bridgeCfg();\r\n          if (b.mode === 'http') {\r\n            return b.stopUrl ? httpSend(b.stopUrl) : true;\r\n          }\r\n          if (!b.stopHotkey) return true;\r\n          const url = b.baseUrl + '/send?keys=' + encodeURIComponent(b.stopHotkey);\r\n          try { return await httpSend(url); }\r\n          catch { return httpSend(b.baseUrl + '/send', { keys: b.stopHotkey }); }\r\n        }\r\n\r\n        async function obsStart(){\r\n          try {\r\n            if (window.__obsBridge && typeof window.__obsBridge.start === 'function') {\r\n              await window.__obsBridge.start();\r\n              return true;\r\n            }\r\n          } catch {}\r\n          try {\r\n            if (window.__tpObs && typeof window.__tpObs.ensureRecording === 'function') {\r\n              return !!(await window.__tpObs.ensureRecording(true));\r\n            }\r\n          } catch {}\r\n          return false;\r\n        }\r\n        async function obsStop(){\r\n          try {\r\n            if (window.__obsBridge && typeof window.__obsBridge.stop === 'function') {\r\n              await window.__obsBridge.stop();\r\n              return true;\r\n            }\r\n          } catch {}\r\n          try {\r\n            if (window.__tpObs && typeof window.__tpObs.ensureRecording === 'function') {\r\n              return !!(await window.__tpObs.ensureRecording(false));\r\n            }\r\n          } catch {}\r\n          return false;\r\n        }\r\n\r\n        async function premStart(){\r\n          // Use the same hotkey bridge pattern as Premiere Hotkey adapter UI\r\n          const p = getCfg().premiere || {};\r\n          const base = String(p.baseUrl || 'http://127.0.0.1:5723').replace(/\\/+$/, '');\r\n          const hk = String(p.startHotkey || 'Ctrl+R');\r\n          const url = base + '/send?keys=' + encodeURIComponent(hk);\r\n          try { return await httpSend(url); }\r\n          catch { return httpSend(base + '/send', { keys: hk }); }\r\n        }\r\n        async function premStop(){\r\n          const p = getCfg().premiere || {};\r\n          const base = String(p.baseUrl || 'http://127.0.0.1:5723').replace(/\\/+$/, '');\r\n          const hk = String(p.stopHotkey || '');\r\n          if (!hk) return true;\r\n          const url = base + '/send?keys=' + encodeURIComponent(hk);\r\n          try { return await httpSend(url); }\r\n          catch { return httpSend(base + '/send', { keys: hk }); }\r\n        }\r\n\r\n        async function start(){\r\n          const a = getSelectedAdapterId();\r\n          try { window.__tpHud?.log?.('[rec]', 'start', a); } catch {}\r\n          if (a === 'recorder') return recorderStart();\r\n          if (a === 'obs') return obsStart();\r\n          if (a === 'descript') return premStart();\r\n          if (a === 'premiere') return premStart();\r\n          return bridgeStart();\r\n        }\r\n        async function stop(){\r\n          const a = getSelectedAdapterId();\r\n          try { window.__tpHud?.log?.('[rec]', 'stop', a); } catch {}\r\n          if (a === 'recorder') return recorderStop();\r\n          if (a === 'obs') return obsStop();\r\n          if (a === 'descript') return premStop();\r\n          if (a === 'premiere') return premStop();\r\n          return bridgeStop();\r\n        }\r\n\r\n        window.__tpRecording = { start, stop, wantsAuto, getAdapter };\r\n      } catch {}\r\n  })();\r\n\r\nconst registry = new Map<string, RecorderAdapter>(); // id -> adapter\r\n\r\n// Settings and orchestration\r\nconst LS_KEY = 'tp_rec_settings_v1';\r\n\r\n/**\r\n * @typedef {Object} RecorderSettings\r\n * @property {('single'|'multi')} mode\r\n * @property {string[]} selected\r\n * @property {Record<string, any>} configs\r\n * @property {{ start: number, stop: number }} timeouts\r\n * @property {('continue'|'abort-on-first-fail')} failPolicy\r\n */\r\n\r\nconst defaultSettings: RecorderSettings = {\r\n  mode: 'multi',\r\n  selected: ['obs', 'descript'],\r\n  preferObsHandoff: false,\r\n  configs: {\r\n    obs: { url: 'ws://127.0.0.1:4455', password: '' },\n    companion: { url: 'http://127.0.0.1:8000', buttonId: '1.1' },\r\n    bridge: { startUrl: 'http://127.0.0.1:5723/record/start', stopUrl: '' },\r\n    descript: { startHotkey: 'Ctrl+R', via: 'bridge' },\r\n    capcut: { startHotkey: 'Ctrl+R', via: 'companion' },\r\n    winmedia: { startHotkey: 'Ctrl+R', via: 'bridge' },\r\n    premiere: { startHotkey: 'Ctrl+R', stopHotkey: '', baseUrl: 'http://127.0.0.1:5723' },\r\n  },\r\n  timeouts: { start: 3000, stop: 3000 },\r\n  failPolicy: 'continue',\r\n};\r\n\r\nlet settings: RecorderSettings = JSON.parse(JSON.stringify(defaultSettings));\r\n\r\n// Load saved settings if available\r\ntry {\r\n  const raw = localStorage.getItem(LS_KEY);\r\n  if (raw) {\r\n    const parsed = JSON.parse(raw);\r\n    if (parsed && typeof parsed === 'object') settings = { ...settings, ...parsed };\r\n  } else {\r\n    // First run: persist the defaults exactly once so future merges have a stored baseline\r\n    try {\r\n      localStorage.setItem(LS_KEY, JSON.stringify(settings));\r\n    } catch {}\r\n  }\r\n} catch {}\r\n\r\nfunction persistSettings() {\r\n  try {\r\n    localStorage.setItem(LS_KEY, JSON.stringify(settings));\r\n    // Legacy mirrors so old code paths remain consistent\r\n    try { localStorage.setItem('tp_record_mode', String(settings.mode || 'multi')); } catch {}\r\n    try { localStorage.setItem('tp_adapters', JSON.stringify(Array.isArray(settings.selected) ? settings.selected : [])); } catch {}\r\n  } catch {}\r\n}\r\n\r\n/**\r\n * Update settings; shallow-merge known keys.\r\n */\r\nexport function setSettings(next: Partial<RecorderSettings> | null | undefined) {\r\n  if (!next || typeof next !== 'object') return;\r\n  const prev = settings;\r\n  settings = {\r\n    ...prev,\r\n    ...('mode' in next ? { mode: next.mode } : {}),\r\n    ...('selected' in next\r\n      ? { selected: Array.isArray(next.selected) ? next.selected.slice() : prev.selected }\r\n      : {}),\r\n    ...('preferObsHandoff' in next ? { preferObsHandoff: !!next.preferObsHandoff } : {}),\r\n    ...('configs' in next ? { configs: { ...prev.configs, ...(next.configs || {}) } } : {}),\r\n    ...('timeouts' in next ? { timeouts: { ...prev.timeouts, ...(next.timeouts || {}) } } : {}),\r\n    ...('failPolicy' in next ? { failPolicy: next.failPolicy } : {}),\r\n  };\r\n  persistSettings();\r\n  applyConfigs();\r\n}\r\n\r\nexport function getSettings(): RecorderSettings {\r\n  return JSON.parse(JSON.stringify(settings));\r\n}\r\n\r\nexport function setSelected(ids: string[] | null | undefined) {\r\n  setSettings({ selected: Array.isArray(ids) ? ids : [] });\r\n}\r\nexport function setMode(mode: RecorderMode | undefined) {\r\n  setSettings({ mode });\r\n}\r\nexport function setTimeouts(t: RecorderSettings['timeouts']) {\r\n  setSettings({ timeouts: t });\r\n}\r\nexport function setFailPolicy(p: RecorderSettings['failPolicy']) {\r\n  setSettings({ failPolicy: p });\r\n}\r\n\r\n/** Apply per-adapter configuration objects via adapter.configure(cfg) when present. */\r\nexport function applyConfigs() {\r\n  for (const [id, a] of registry.entries()) {\r\n    try {\r\n      const cfg = settings.configs[id];\r\n      if (cfg && typeof a.configure === 'function') a.configure(cfg);\r\n    } catch {}\r\n  }\r\n}\r\n\r\nfunction callWithTimeout<T>(promiseOrFn: (() => Promise<T>) | Promise<T>, ms = 0) {\r\n  const p = typeof promiseOrFn === 'function' ? promiseOrFn() : promiseOrFn;\r\n  return Promise.race([\r\n    Promise.resolve().then(() => p),\r\n    new Promise<never>((_, rej) => setTimeout(() => rej(new Error('timeout')), Math.max(0, ms || 0))),\r\n  ]);\r\n}\r\n\r\nlet _busy = false;\r\nasync function guarded<T>(fn: () => Promise<T>): Promise<T | { skipped: true }> {\r\n  if (_busy) return { skipped: true } as const;\r\n  _busy = true;\r\n  try {\r\n    return await fn();\r\n  } finally {\r\n    _busy = false;\r\n  }\r\n}\r\n\r\nfunction describeError(err: unknown): string {\r\n  if (err instanceof Error && typeof err.message === 'string') return err.message;\r\n  try { return String(err); } catch { return 'error'; }\r\n}\r\n\r\n// ------------------------------------------------------------------\r\n// Central recording state machine + bus events (single source of truth)\r\n// States: 'idle' | 'starting' | 'recording' | 'stopping' | 'error'\r\n// ------------------------------------------------------------------\r\nlet _recState: RecState = 'idle';\r\nlet _recDetail: Record<string, unknown> | null = null;\r\nlet _recAdapter: string | null = null; // last chosen primary adapter when in single mode\r\n// Epoch used to invalidate in-flight start attempts when a stop/cancel occurs\r\nlet __recEpoch = 0;\r\n// Hotkey flood guard for Bridge taps\r\nlet __lastBridgeTap = 0;\r\n\r\n// ---- test/teardown plumbing ----\r\nconst __recTimers = new Set<ReturnType<typeof setTimeout>>();\r\n/** trackable timeout */\r\nexport function setTrackedTimeout(fn: () => void, ms: number): ReturnType<typeof setTimeout> {\r\n  const h = setTimeout(() => {\r\n    try { __recTimers.delete(h); } catch {}\r\n    try { fn(); } catch {}\r\n  }, Math.max(0, ms || 0));\r\n  try { __recTimers.add(h); } catch {}\r\n  return h;\r\n}\r\ntype ObsListener = (() => Promise<void>) | (() => void) | null;\r\nlet _onObsDisconnectCb: ObsListener = null;\r\nlet _onObsRecordingStartedCb: ObsListener = null;\r\n\r\n// Small time helpers\r\n// NOTE: All recorder timers MUST use setTrackedTimeout (or register/unref) so tests can teardown cleanly.\r\nconst __now = () => (typeof performance !== 'undefined' && performance.now ? performance.now() : Date.now());\r\nconst __sleep = (ms: number) => new Promise<void>((resolve) => {\r\n  setTrackedTimeout(() => resolve(), Math.max(0, ms || 0));\r\n});\r\n\r\nlet __lastRecKey = '';\r\nfunction _emitRecState(state: RecState, detail: Record<string, unknown> | null = null) {\r\n  try {\r\n    _recState = state;\r\n    _recDetail = detail || null;\r\n    if (typeof window !== 'undefined') {\r\n      try { window.__recState = { state, adapter: _recAdapter, detail: _recDetail, ts: Date.now() }; } catch {}\r\n      const payload = { adapter: _recAdapter, state, detail: _recDetail };\r\n      // distinct-until-changed to reduce HUD/UI spam\r\n      try {\r\n        const key = String(payload.adapter||'') + '|' + String(payload.state||'') + '|' + (payload.detail && payload.detail.fallback ? 'F' : '');\r\n        if (key === __lastRecKey) return;\r\n        __lastRecKey = key;\r\n      } catch {}\r\n      window.dispatchEvent(new CustomEvent('rec:state', { detail: payload }));\r\n      try { window.__tpHud?.log?.('[rec:state]', payload); } catch {}\r\n    }\r\n  } catch {}\r\n}\r\n\r\nfunction _isActiveState(s: RecState){ return s === 'starting' || s === 'recording'; }\r\n\r\nexport function getRecState(){ return { state: _recState, adapter: _recAdapter, detail: _recDetail }; }\r\n\r\n// Global guard: skip starting any recorders in Rehearsal mode\r\nfunction isNoRecordMode() {\r\n  try {\r\n    return !!(window.__tpNoRecord || (typeof document !== 'undefined' && document.body && document.body.classList && document.body.classList.contains('mode-rehearsal')));\r\n  } catch { return false; }\r\n}\r\n\r\nfunction selectedIds(): string[] {\r\n  const ids = Array.isArray(settings.selected) ? settings.selected.slice() : [];\r\n  if (settings.mode === 'single' && ids.length > 1) ids.length = 1;\r\n  return ids.filter((id) => registry.has(id));\r\n}\r\n\r\n// --------------------------------------------------------------\r\n// OBS handoff watchdog: detect late OBS start while Bridge is active\r\n// and optionally hand off mid-run when preferObsHandoff is true.\r\n// --------------------------------------------------------------\r\nlet __handoffTimer: ReturnType<typeof setInterval> | null = null;\r\nexport function clearHandoffTimer(){ try { if (__handoffTimer) { clearInterval(__handoffTimer); __handoffTimer = null; } } catch {} }\r\nasync function tryObsHandoffOnce(reason = 'watchdog'){\r\n  try {\r\n    if (!settings?.preferObsHandoff) return false;\r\n    if (_recState !== 'recording' || _recAdapter !== 'bridge') return false;\r\n    const br = (typeof window !== 'undefined') ? (window.__obsBridge || null) : null;\r\n    if (!br || typeof br.getRecordStatus !== 'function') return false;\r\n    let isRec = false; try { const s = await br.getRecordStatus(); isRec = !!(s && (s.outputActive === true || s.recording === true)); } catch {}\r\n    if (!isRec) return false;\r\n    const bridgeAdapter = registry.get('bridge');\r\n    _emitRecState('stopping', { reason: 'obs-handoff', via: reason });\r\n    try { await bridgeAdapter?.stop?.(); } catch {}\r\n    _recAdapter = 'obs';\r\n    _emitRecState('recording', { handoff: true });\r\n    clearHandoffTimer();\r\n    return true;\r\n  } catch { return false; }\r\n}\r\nfunction armObsHandoffWatchdog(){\r\n  clearHandoffTimer();\r\n  try {\r\n    if (!settings?.preferObsHandoff) return;\r\n    if (_recState === 'recording' && _recAdapter === 'bridge') {\r\n      const t = setInterval(() => { tryObsHandoffOnce('watchdog'); }, 1000);\r\n      try {\r\n        const maybeTimer: any = t;\r\n        if (maybeTimer && typeof maybeTimer.unref === 'function') maybeTimer.unref();\r\n      } catch {}\r\n      __handoffTimer = t;\r\n    }\r\n  } catch {}\r\n}\r\n\r\n// --- test-only helper (safe no-op in prod) ---\r\ntry {\r\n  if (typeof window !== 'undefined') {\r\n    window.__recorder = window.__recorder || {};\r\n    if (!window.__recorder.__finalizeForTests) {\r\n      window.__recorder.__finalizeForTests = () => {\r\n        try { clearHandoffTimer(); } catch {}\r\n        try { __recEpoch++; } catch {}\r\n        try { if (__recStatsTimer) { clearInterval(__recStatsTimer); __recStatsTimer = null; } } catch {}\r\n      };\r\n    }\r\n  }\r\n} catch {}\r\n\r\n// Exposed teardown for tests: clears timers and OBS listeners\r\nexport async function teardownRecorders(){\r\n  try { __recEpoch++; } catch {}\r\n  try { __lastBridgeTap = 0; } catch {}\r\n  // Clear tracked timeouts\r\n  try { for (const h of Array.from(__recTimers)) { clearTimeout(h); __recTimers.delete(h); } } catch {}\r\n  // Clear periodic timers\r\n  try { clearHandoffTimer(); } catch {}\r\n  try { if (__recStatsTimer) { clearInterval(__recStatsTimer); __recStatsTimer = null; } } catch {}\r\n  // Unbind OBS listeners if bridge supports off/removeListener\r\n  try {\r\n    const br = (typeof window !== 'undefined') ? window.__obsBridge : null;\r\n    if (br) {\r\n      if (typeof br.off === 'function') {\r\n        try { if (_onObsDisconnectCb && window.__tpObsDisconnectWired) { br.off('disconnect', _onObsDisconnectCb); window.__tpObsDisconnectWired = false; } } catch {}\r\n        try { if (_onObsRecordingStartedCb && window.__tpObsHandoffWired) { br.off('recordingStarted', _onObsRecordingStartedCb); window.__tpObsHandoffWired = false; } } catch {}\r\n      } else if (typeof br.removeListener === 'function') {\r\n        try { if (_onObsDisconnectCb && window.__tpObsDisconnectWired) { br.removeListener('disconnect', _onObsDisconnectCb); window.__tpObsDisconnectWired = false; } } catch {}\r\n        try { if (_onObsRecordingStartedCb && window.__tpObsHandoffWired) { br.removeListener('recordingStarted', _onObsRecordingStartedCb); window.__tpObsHandoffWired = false; } } catch {}\r\n      }\r\n    }\r\n  } catch {}\r\n}\r\n\r\ninterface StartObsOptions {\r\n  timeoutMs?: number;\r\n  retryDelayMs?: number;\r\n}\r\n\r\n// --- OBS start with confirm + retry + bridge fallback (self-contained) -----\r\nasync function startObsWithConfirm({ timeoutMs = 1200, retryDelayMs = 500 }: StartObsOptions = {}) {\r\n  const obs = (typeof window !== 'undefined') ? (window.__obsBridge || null) : null;\r\n  const bridgeAdapter = registry.get('bridge');\r\n  // Capture generation to guard against late completions after stop/cancel\r\n  const epoch = __recEpoch;\r\n  const isStale = () => epoch !== __recEpoch;\r\n  try { window.__tpHud?.log?.('[rec] start obs'); } catch {}\r\n  // Announce obs starting explicitly\r\n  try { _recAdapter = 'obs'; _emitRecState('starting'); } catch {}\r\n\r\n  let fallbackSent = false;\r\n  const maybeTapBridge = async () => {\r\n    const t = __now();\r\n    if (t - __lastBridgeTap < 1200) return false;\r\n    __lastBridgeTap = t;\r\n    try { await bridgeAdapter?.start?.(); } catch {}\r\n    return true;\r\n  };\r\n  const confirm = async () => {\r\n    try {\r\n      const s = await obs?.getRecordStatus?.();\r\n      return !!(s && (s.outputActive === true));\r\n    } catch { return false; }\r\n  };\r\n  const tryStart = async () => {\r\n    try { if (obs && typeof obs.start === 'function') await obs.start(); else if (obs && typeof obs.startRecord === 'function') await obs.startRecord(); } catch {}\r\n  };\r\n\r\n  await tryStart();\r\n\r\n  // poll until timeout\r\n  let ok = false; let deadline = __now() + timeoutMs;\r\n  while (!ok && __now() < deadline) {\r\n    if (isStale()) { try { window.__tpHud?.log?.('[rec] abort confirm (stale)'); } catch {} return { ok:false, adapter:'obs', error:'stale' }; }\r\n    ok = await confirm();\r\n    if (!ok) await __sleep(120);\r\n  }\r\n\r\n  if (!ok) {\r\n    try { window.__tpHud?.log?.('[rec] retry'); } catch {}\r\n    await __sleep(Math.max(0, retryDelayMs));\r\n    if (isStale()) { try { window.__tpHud?.log?.('[rec] abort retry (stale)'); } catch {} return { ok:false, adapter:'obs', error:'stale' }; }\r\n    await tryStart();\r\n    try { recStats.retries++; } catch {}\r\n    ok = await confirm();\r\n  }\r\n\r\n  if (ok) {\r\n    try { _recAdapter = 'obs'; _emitRecState('recording'); } catch {}\r\n    return { ok: true, adapter: 'obs' };\r\n  }\r\n\r\n  // fallback to Bridge (once)\r\n  const isBridgeAvailable = !!bridgeAdapter;\r\n  if (!fallbackSent && isBridgeAvailable) {\r\n    fallbackSent = true;\r\n    if (isStale()) { try { window.__tpHud?.log?.('[rec] abort fallback (stale)'); } catch {} return { ok:false, adapter:'obs', error:'stale' }; }\r\n    // flood guard on fallback taps\r\n    await maybeTapBridge();\r\n    // stop() might have landed while we were tapping; bail if so\r\n    if (isStale()) { try { window.__tpHud?.log?.('[rec] abort fallback (stale-2)'); } catch {} return { ok:false, adapter:'obs', error:'stale' }; }\r\n    try { window.__tpHud?.log?.('[rec] fallback bridge'); } catch {}\r\n    try { _recAdapter = 'bridge'; _emitRecState('recording', { fallback: true }); } catch {}\r\n    try { recStats.fallbacks++; } catch {}\r\n    return { ok: true, adapter: 'bridge', fallback: true };\r\n  }\r\n\r\n  try { window.__tpHud?.log?.('[rec] drop (start-timeout)'); } catch {}\r\n  try { _recAdapter = 'obs'; _emitRecState('error', { reason: 'start-timeout' }); } catch {}\r\n  return { ok: false, adapter: 'obs', error: 'start-timeout' };\r\n}\r\n\r\n/** Start selected recorders based on settings (respects mode, timeouts, failPolicy). */\r\nexport async function startSelected(): Promise<StartResults | { skipped: true }> {\r\n  return guarded<StartResults>(async () => {\r\n    if (isNoRecordMode()) {\r\n      try { window.HUD?.log?.('rehearsal', { skip: 'startSelected (no-record)' }); } catch {}\r\n      return { results: [], started: [] };\r\n    }\r\n    // Explicitly block new starts while stopping teardown runs\r\n    if (_recState === 'stopping') {\r\n      try { window.__tpHud?.log?.('[rec] busy (stopping)'); } catch {}\r\n      return { results: [], started: [], reason: 'idempotent-start-while-stopping' };\r\n    }\r\n    // Idempotent: already starting/recording \u2192 treat as success\r\n    if (_isActiveState(_recState)) {\r\n      try { window.__tpHud?.log?.('[rec] already recording'); } catch {}\r\n      _emitRecState(_recState, { reason: 'idempotent-start' });\r\n      return { results: [], started: selectedIds() };\r\n    }\r\n    applyConfigs();\r\n    // Make sure OBS signals are wired even if __obsBridge attached late\r\n    try { ensureObsDisconnectFallback(); } catch {}\r\n    try { ensureObsRecordingStartedHandoff(); } catch {}\r\n    const ids = selectedIds();\r\n    // Track primary adapter (first selected in single mode or the first in list)\r\n    _recAdapter = settings.mode === 'single' ? (ids[0] || null) : (ids[0] || null);\r\n  _emitRecState('starting');\r\n    const t0 = __now();\r\n    try { recStats.starts++; } catch {}\r\n    const started: string[] = [];\r\n    type StartAction = { id: string; a: RecorderAdapter | undefined };\r\n    const actions: StartAction[] = ids.map((id) => ({ id, a: registry.get(id) }));\r\n    const doStart = async ({ id, a }: StartAction): Promise<RecorderResult> => {\r\n      if (!a) return { id, ok: false, error: 'missing' };\r\n      try {\r\n        const avail = await callWithTimeout(() => a.isAvailable(), settings.timeouts.start);\r\n        if (!avail) return { id, ok: false, error: 'unavailable' };\r\n      } catch (e) {\r\n        return { id, ok: false, error: describeError(e) };\r\n      }\r\n      try {\r\n        if (id === 'obs') {\r\n          const res = await startObsWithConfirm({ timeoutMs: Math.min(2000, settings.timeouts.start || 1500), retryDelayMs: 500 });\r\n          if (res && res.ok === false && res.error === 'stale') { return { id, ok: false, error: 'stale' }; }\r\n          if (res && res.ok && res.adapter === 'bridge' && res.fallback) { /* handled downstream */ }\r\n          if (res.ok) { started.push(id); return { id, ok: true, detail: res }; }\r\n          return { id, ok: false, error: res.error || 'failed' };\r\n        } else {\r\n          await callWithTimeout(() => a.start(), settings.timeouts.start);\r\n          started.push(id);\r\n          return { id, ok: true };\r\n        }\r\n      } catch (e) {\r\n        return { id, ok: false, error: describeError(e) };\r\n      }\r\n    };\r\n\r\n    const results: RecorderResult[] = [];\r\n    if (settings.failPolicy === 'abort-on-first-fail') {\r\n      // Serial, abort early\r\n      for (const act of actions) {\r\n        const r = await doStart(act);\r\n        results.push(r);\r\n        if (!r.ok) break;\r\n      }\r\n    } else {\r\n      // Parallel, continue on failure\r\n      const rs = await Promise.all(actions.map(doStart));\r\n      results.push(...rs);\r\n    }\r\n    if (started.length) {\r\n      try { window.__tpHud?.log?.('[rec] recording'); } catch {}\r\n      // If OBS fell back to Bridge, reflect that as the active adapter with fallback detail\r\n      const anyFallback = results.find(r => r && r.id === 'obs' && r.detail && r.detail.fallback);\r\n      if (anyFallback) {\r\n        _recAdapter = 'bridge';\r\n        _emitRecState('recording', { fallback: true, via: 'bridge' });\r\n      } else {\r\n        _emitRecState('recording');\r\n      }\r\n      try { recStats.startLat.push(Math.max(0, __now() - t0)); } catch {}\r\n    } else {\r\n      _emitRecState('error', { results });\r\n    }\r\n    return { results, started };\r\n  });\r\n}\r\n\r\n/** Stop selected recorders (parallel, timeout per adapter).\r\n * Important: stop must preempt an in-flight start; do NOT gate with the global busy lock.\r\n */\r\nexport async function stopSelected(): Promise<StopResults> {\r\n  // Bump epoch immediately to cancel any in-flight confirm/retry/fallback paths\r\n  __recEpoch++;\r\n  // Reset Bridge tap flood guard so a fresh start can tap promptly after a stop\r\n  __lastBridgeTap = 0;\r\n  // Stop any handoff watchdog\r\n  clearHandoffTimer();\r\n  // Allow stop to proceed even in no-record mode (safe cleanup)\r\n  if (isNoRecordMode()) {\r\n    try { window.HUD?.log?.('rehearsal', { note: 'stopSelected (allowed during no-record)' }); } catch {}\r\n  }\r\n  // Idempotent: if already idle/stopping, treat as success\r\n  if (_recState === 'idle' || _recState === 'stopping') {\r\n    _emitRecState('idle', { reason: 'idempotent-stop' });\r\n    return { results: [] };\r\n  }\r\n  try { window.__tpHud?.log?.('[rec] stop'); } catch {}\r\n  _emitRecState('stopping');\r\n  const t0 = __now();\r\n  const ids = selectedIds();\r\n  type StopAction = { id: string; a: RecorderAdapter };\r\n  const actions: StopAction[] = ids\r\n    .map((id) => ({ id, a: registry.get(id) }))\r\n    .filter((x): x is StopAction => !!x.a);\r\n  const rs: RecorderResult[] = await Promise.all(\r\n    actions.map(async ({ id, a }) => {\r\n      try {\r\n        const avail = await callWithTimeout(() => a.isAvailable(), settings.timeouts.stop);\r\n        if (!avail) return { id, ok: false, error: 'unavailable' };\r\n      } catch (e) {\r\n        return { id, ok: false, error: describeError(e) };\r\n      }\r\n      try {\r\n        await callWithTimeout(() => a.stop(), settings.timeouts.stop);\r\n        return { id, ok: true };\r\n      } catch (e) {\r\n        return { id, ok: false, error: describeError(e) };\r\n      }\r\n    })\r\n  );\r\n  _emitRecState('idle');\r\n  try { recStats.stopLat.push(Math.max(0, __now() - t0)); } catch {}\r\n  return { results: rs };\r\n}\r\n\r\n/**\r\n * Register or replace a recorder adapter by id.\r\n * @param {RecorderAdapter} adapter\r\n */\r\nexport function register(adapter: RecorderAdapter) {\r\n  registry.set(adapter.id, adapter);\r\n}\r\n\r\n/**\r\n * Get a recorder adapter by id.\r\n * @param {string} id\r\n * @returns {RecorderAdapter | undefined}\r\n */\r\nexport function get(id: string): RecorderAdapter | undefined {\r\n  return registry.get(id);\r\n}\r\n\r\n/**\r\n * List all registered adapters in insertion order.\r\n * @returns {RecorderAdapter[]}\r\n */\r\nexport function all(): RecorderAdapter[] {\r\n  return [...registry.values()];\r\n}\r\n\r\n// --- Built-in adapters (OBS, Bridge) registration ---\r\nlet _builtInsInit = false;\r\nexport async function initBuiltIns(): Promise<void> {\r\n  if (_builtInsInit) return;\r\n  _builtInsInit = true;\r\n  try {\r\n    // Attempt to load and register built-in adapters. Each is optional.\r\n    const adapters: RecorderAdapter[] = [];\r\n    const resolver: (path: string) => string = (typeof window !== 'undefined' && typeof window.__TP_ADDV === 'function')\r\n      ? window.__TP_ADDV.bind(window)\r\n      : ((p: string) => p);\r\n    try {\r\n      const m = await import(resolver('./adapters/bridge.js'));\r\n      const a = m?.createBridgeAdapter?.();\r\n      if (a) adapters.push(a);\r\n    } catch {}\r\n    try {\r\n      const m = await import(resolver('./adapters/obs.js'));\r\n      const a = m?.createOBSAdapter?.();\r\n      if (a) adapters.push(a);\r\n    } catch {}\r\n    try {\r\n      const m = await import(resolver('./adapters/hotkey.js'));\r\n      const aPrem = m?.createHotkeyAdapter?.('premiere', 'Adobe Premiere Pro');\r\n      if (aPrem) adapters.push(aPrem);\r\n    } catch {}\r\n    try {\r\n      // If obsBridge exists, register a thin adapter that delegates to it. This keeps\r\n      // backwards compatibility for code that expects an adapter with id 'obs'.\r\n      if (typeof window !== 'undefined' && window.__obsBridge) {\r\n        const bridge = window.__obsBridge;\r\n        const wrapper = {\r\n          id: 'obs',\r\n          label: 'OBS (WebSocket) - bridge',\r\n          configure(cfg: Record<string, unknown>) {\r\n            try {\r\n              bridge.configure(cfg);\r\n            } catch {}\r\n          },\r\n          async isAvailable() {\r\n            try {\r\n              return bridge.isConnected\r\n                ? bridge.isConnected()\r\n                : bridge.isConnected && bridge.isConnected();\r\n            } catch {\r\n              return !!bridge.isConnected && bridge.isConnected();\r\n            }\r\n          },\r\n          async start() {\r\n            return bridge.start();\r\n          },\r\n          async stop() {\r\n            return bridge.stop();\r\n          },\r\n          async test() {\r\n            return bridge.getRecordStatus();\r\n          },\r\n        };\r\n        adapters.push(wrapper);\r\n      }\r\n    } catch {}\r\n    for (const a of adapters) {\r\n      try {\r\n        register(a);\r\n      } catch {}\r\n    }\r\n    applyConfigs();\r\n    // Late-bind OBS events if bridge appeared during adapter init\r\n    try { ensureObsDisconnectFallback(); } catch {}\r\n    try { ensureObsRecordingStartedHandoff(); } catch {}\r\n  } catch {}\r\n}\r\n\r\n// Fire-and-forget initialization on module load (safe if ignored)\r\ntry {\r\n  initBuiltIns();\r\n} catch {}\r\n\r\n// Ensure OBS disconnect \u2192 fallback guard (bind once, late-safe)\r\nfunction ensureObsDisconnectFallback(){\r\n  try {\r\n    if (typeof window === 'undefined') return;\r\n    const br = window.__obsBridge;\r\n    if (!br || typeof br.on !== 'function') return;\r\n    if (window.__tpObsDisconnectWired) return; window.__tpObsDisconnectWired = true;\r\n    _onObsDisconnectCb = async () => {\r\n      try {\r\n        const state = _recState;\r\n        const bridgeAdapter = registry.get('bridge');\r\n        const isAuto = __tpReadAutoRecordPref();\r\n        try { recStats.disconnects++; } catch {}\r\n        if (state === 'starting') {\r\n          await startObsWithConfirm({ timeoutMs: 900, retryDelayMs: 300 });\r\n          return;\r\n        }\r\n        if (state === 'recording') {\r\n          _emitRecState('stopping', { reason: 'disconnect' });\r\n          if (isAuto && bridgeAdapter) {\r\n            try { await bridgeAdapter.start?.(); } catch {}\r\n            try { window.dispatchEvent(new CustomEvent('rec:state', { detail: { adapter: 'bridge', state: 'recording', detail: { fallback: true, reason: 'obs-disconnect' } } })); } catch {}\r\n          } else {\r\n            _emitRecState('idle', { reason: 'disconnect' });\r\n          }\r\n        }\r\n      } catch {}\r\n    };\r\n    br.on('disconnect', _onObsDisconnectCb);\r\n  } catch {}\r\n}\r\n\r\n// Wire a small listener to auto-arm/clear handoff watchdog on state changes\r\n(function wireRecStateWatchdog(){\r\n  try {\r\n    if (typeof window === 'undefined') return;\r\n    if (window.__tpRecWatchdogWired) return; window.__tpRecWatchdogWired = true;\r\n    window.addEventListener('rec:state', (e) => {\r\n      try {\r\n        const evt = e as CustomEvent<Record<string, unknown>>;\r\n        const d = (evt && evt.detail) || {};\r\n        if (d && d.state === 'recording' && d.adapter === 'bridge' && settings?.preferObsHandoff) {\r\n          armObsHandoffWatchdog();\r\n        }\r\n        if (d && (d.state === 'idle' || d.state === 'stopping')) {\r\n          clearHandoffTimer();\r\n        }\r\n      } catch {}\r\n    });\r\n  } catch {}\r\n})();\r\n\r\n// Ensure OBS recordingStarted \u2192 optional handoff from Bridge (bind once, late-safe)\r\nfunction ensureObsRecordingStartedHandoff(){\r\n  try {\r\n    if (typeof window === 'undefined') return;\r\n    const br = window.__obsBridge;\r\n    if (!br || typeof br.on !== 'function') return;\r\n    if (window.__tpObsHandoffWired) return; window.__tpObsHandoffWired = true;\r\n    _onObsRecordingStartedCb = async () => {\r\n      try {\r\n        const prefer = !!(settings && settings.preferObsHandoff);\r\n        if (_recState === 'recording' && _recAdapter === 'bridge') {\r\n          if (!prefer) {\r\n            try { window.__tpHud?.log?.('[rec] obs up (handoff disabled)'); } catch {}\r\n            return;\r\n          }\r\n          const bridgeAdapter = registry.get('bridge');\r\n          _emitRecState('stopping', { reason: 'obs-handoff' });\r\n          try { await bridgeAdapter?.stop?.(); } catch {}\r\n          _recAdapter = 'obs';\r\n          _emitRecState('recording', { handoff: true });\r\n        }\r\n      } catch {}\r\n    };\r\n    br.on('recordingStarted', _onObsRecordingStartedCb);\r\n  } catch {}\r\n}\r\n\r\n// Simple aliases for consumers that prefer start/stop terminology\r\nexport async function start() {\r\n  return startSelected();\r\n}\r\nexport async function stop() {\r\n  return stopSelected();\r\n}\r\n\r\n// --------------------------------------------------------------\r\n// Lightweight recorder telemetry (rec:stats)\r\n// --------------------------------------------------------------\r\nconst recStats: RecStats = { starts: 0, retries: 0, fallbacks: 0, disconnects: 0, startLat: [], stopLat: [] };\r\nfunction p95(arr: number[]){\r\n  if (!arr || !arr.length) return 0;\r\n  const a = arr.slice().sort((x,y)=>x-y);\r\n  const i = Math.min(a.length-1, Math.floor(a.length*0.95));\r\n  return a[i] || 0;\r\n}\r\nfunction emitRecStats(_final=false){\r\n  try {\r\n    const payload = {\r\n      starts: recStats.starts|0,\r\n      retries: recStats.retries|0,\r\n      fallbacks: recStats.fallbacks|0,\r\n      disconnects: recStats.disconnects|0,\r\n      startP95Ms: Math.round(p95(recStats.startLat)),\r\n      stopP95Ms: Math.round(p95(recStats.stopLat)),\r\n    };\r\n    if (typeof window !== 'undefined') {\r\n      window.dispatchEvent(new CustomEvent('rec:stats', { detail: payload }));\r\n    }\r\n  } catch {}\r\n  // no further work when final; kept for clarity without early return\r\n}\r\nlet __recStatsTimer: ReturnType<typeof setInterval> | null = null;\r\ntry {\r\n  if (typeof window !== 'undefined') {\r\n    if (__recStatsTimer) clearInterval(__recStatsTimer);\r\n    __recStatsTimer = setInterval(()=>emitRecStats(false), 5000);\r\n    try {\r\n      const maybeTimer: any = __recStatsTimer;\r\n      if (maybeTimer && typeof maybeTimer.unref === 'function') maybeTimer.unref();\r\n    } catch {}\r\n    window.addEventListener('beforeunload', () => emitRecStats(true));\r\n  }\r\n} catch {}\r\n\r\n// --- Compatibility recorder surface used by the app ---\r\n// Provides a small surface with idempotent lifecycle and status events.\r\n\r\n", "// @ts-nocheck\nimport {\n    applyConfigs,\n    clearHandoffTimer,\n    getSettings,\n    setMode,\n    setSelected,\n    setSettings,\n    setTrackedTimeout,\n    start,\n    startSelected,\n    stopSelected,\n} from './recorders-core';\n\n// --- Compatibility recorder surface used by the app ---\n// Provides a small surface with idempotent lifecycle and status events.\nconst recorder = {\n  state: 'disabled',\n  async init() { return true; },\n  async connect() { return true; },\n  async disconnect() { return true; },\n  setEnabled(_on) { /* no-op for stub */ },\n};\n\nexport function initCompat() {\n  // Create a minimal registry surface the old code expects.\n  if (typeof window !== 'undefined') {\n    if (!window.__recorder) {\n      window.__recorder = {\n        get(name) {\n          return name === 'obs' ? recorder : null;\n        }\n      };\n    }\n    // Also expose a global for anything still probing window.recorders\n    window.recorders = window.recorders || window.__recorder;\n  }\n  return typeof window !== 'undefined' ? window.__recorder : { get: () => null };\n}\n\nconst compatDefault = {\n  init: initCompat,\n  get(name) {\n    return name === 'obs' ? recorder : null;\n  },\n  // Also surface the modern API explicitly if anyone wants it\n  recorder\n};\n\nexport default compatDefault;\n\n// UMD-style safety net for non-module script loads\nif (typeof window !== 'undefined') {\n  window.__recorder = window.__recorder || {\n    get(name) {\n      return name === 'obs' ? recorder : null;\n    }\n  };\n  window.recorders = window.recorders || window.__recorder;\n}\n\n// --- Legacy global bridge ---------------------------------------------------\n// Many legacy callers (teleprompter_pro.js) expect window.__recorder to expose\n// start/stop and settings helpers. Provide a thin bridge to the SSOT above.\ntry {\n  if (typeof window !== 'undefined') {\n    // Ensure the base shim exists\n    initCompat();\n    const api = window.__recorder;\n    // Attach SSOT methods (idempotent)\n    if (!api.start) api.start = () => startSelected();\n    if (!api.stop) api.stop = () => stopSelected();\n    // Expose a minimal preflight helper (currently OBS-centric)\n    if (!api.preflight) api.preflight = async (target = 'obs') => {\n      const issues = [];\n      try {\n        if (target === 'obs') {\n          const bridge = window.__obsBridge || null;\n          if (!bridge) issues.push('OBS bridge missing');\n          else {\n            try {\n              const st = await bridge.getRecordStatus();\n              if (!st) issues.push('OBS not responding');\n            } catch { issues.push('OBS GetRecordStatus failed'); }\n            try {\n              if (typeof bridge.getRecordDirectory === 'function') {\n                const dir = await bridge.getRecordDirectory();\n                if (!dir || !dir.recordDirectory) issues.push('Record directory unknown');\n              }\n            } catch { /* optional */ }\n            try {\n              const stats = await bridge.getStats();\n              const bytes = stats?.recording?.freeDiskSpace || stats?.free_disk_space || null;\n              const free = typeof bytes === 'number' ? bytes : (typeof bytes === 'string' && /^\\d+$/.test(bytes) ? Number(bytes) : null);\n              if (free != null && free < 2 * 1024 * 1024 * 1024) issues.push('Low disk space (<2 GB)');\n            } catch { /* ignore */ }\n          }\n        }\n      } catch {}\n      return issues;\n    };\n    if (!api.getSettings) api.getSettings = () => getSettings();\n    if (!api.setSettings) api.setSettings = (next) => setSettings(next);\n    if (!api.setSelected) api.setSelected = (ids) => setSelected(ids);\n    if (!api.setMode) api.setMode = (mode) => setMode(mode);\n    if (!api.__finalizeForTests) api.__finalizeForTests = () => { try { clearHandoffTimer(); } catch {} };\n    // Keep a stable alias under window.recorders too\n    window.recorders = window.recorders || api;\n  }\n} catch {}\n\n/* ------------------------------------------------------------------\n * Minimal inline OBS v5 bridge (safe, idempotent)\n * Exposes: init, setEnabled, reconfigure, test, connect, disconnect, isConnected\n * This is a lightweight client implementing the minimal Identify handshake\n * so the rest of the app can call connect/test without needing adapters/obs.js.\n * ------------------------------------------------------------------ */\n\nlet _ws = null,\n  _connecting = false,\n  _identified = false;\n// Config for inline bridge connection when used directly\nlet obsCfg = { host: '127.0.0.1', port: 4455, secure: false };\nlet _cfgBridge = {\n  getUrl: () => 'ws://127.0.0.1:4455',\n  getPass: () => '',\n  isEnabled: () => false,\n  onStatus: (txt, ok) => console.log('[OBS]', txt, ok),\n  onRecordState: () => {},\n};\n\nlet _enabled = false;\n\nfunction getObsBridge(): any | null {\n  try {\n    if (typeof window === 'undefined') return null;\n    // Prefer the primary bridge\n    if ((window as any).__obsBridge) return (window as any).__obsBridge;\n    // Fallbacks for older wiring\n    if ((window as any).__tpObsBridge) return (window as any).__tpObsBridge;\n    const legacy = (window as any).__tpObs;\n    if (legacy && typeof legacy === 'object') return legacy;\n    return null;\n  } catch { return null; }\n}\n\nasync function safeConnect(testOnly?: boolean): Promise<boolean> {\n  let bridge = getObsBridge();\n  if (!bridge || typeof bridge.connect !== 'function') {\n    if (typeof (window as any).__loadObsBridge === 'function') {\n      try { await (window as any).__loadObsBridge(); } catch {}\n      bridge = getObsBridge();\n    }\n  }\n  if (!bridge || typeof bridge.connect !== 'function') {\n    try {\n      // If maybeConnect exists (inline bridge), use that path instead\n      if (bridge && typeof bridge.maybeConnect === 'function') {\n        try { await bridge.maybeConnect(); } catch {}\n        return !!(bridge.isConnected?.() || false);\n      }\n      console.warn('[OBS] connect(testOnly=%o) ignored; no bridge present', !!testOnly);\n    } catch {}\n    return false;\n  }\n  try {\n    _cfgBridge.isEnabled = () => _enabled === true;\n    const res = await bridge.connect({ testOnly });\n    return !!res;\n  } catch (e) {\n    try { console.warn('[OBS] connect failed', e); } catch {}\n    return false;\n  }\n}\n\nasync function safeSetEnabled(on: boolean): Promise<boolean> {\n  _enabled = !!on;\n  const bridge = getObsBridge();\n  if (!bridge) {\n    try { console.warn('[OBS] setEnabled(%o) ignored; no bridge present', on); } catch {}\n    return false;\n  }\n  try {\n    // Prefer armed/maybeConnect if available\n    const ctrl: any = (bridge as any).setArmed ? bridge : (window as any).__tpObs;\n    if (ctrl && typeof ctrl.setArmed === 'function') {\n      ctrl.setArmed(!!on);\n      if (on && typeof ctrl.maybeConnect === 'function') {\n        await ctrl.maybeConnect();\n      } else if (!on && typeof ctrl.disconnect === 'function') {\n        await ctrl.disconnect();\n      }\n      return true;\n    }\n    if (typeof bridge.start === 'function' && typeof bridge.stop === 'function') {\n      if (on) await bridge.start();\n      else await bridge.stop();\n      return true;\n    }\n    if (typeof bridge.setEnabled === 'function') {\n      await bridge.setEnabled(!!on);\n      return true;\n    }\n    try { console.warn('[OBS] safeSetEnabled: bridge present but does not support known methods'); } catch {}\n    return true;\n  } catch (e) {\n    try { console.warn('[OBS] setEnabled(%o) failed', on, e); } catch {}\n    return false;\n  }\n}\n\nexport function initBridge(opts = {}) {\n  _cfgBridge = { ..._cfgBridge, ...opts };\n  try {\n    if (_cfgBridge.isEnabled()) connect();\n  } catch {}\n}\n\nexport function setEnabled(on) {\n  return safeSetEnabled(on);\n}\nexport async function reconfigure(cfg: any = {}) {\n  try {\n    // Merge incoming settings into the inline config\n    obsCfg = { ...obsCfg, ...cfg };\n\n    // Normalize port\n    if (typeof cfg?.port !== 'undefined') {\n      const n =\n        typeof cfg.port === 'string' ? parseInt(cfg.port, 10) : Number(cfg.port);\n      if (!Number.isNaN(n) && n > 0) {\n        (obsCfg as any).port = n;\n      }\n    }\n\n    // Normalize password\n    const password =\n      typeof cfg?.password === 'string'\n        ? cfg.password\n        : (obsCfg as any).password || '';\n    (obsCfg as any).password = password;\n\n    // Build canonical URL from host/port unless an explicit url is provided\n    const explicitUrl =\n      cfg && typeof cfg.url === 'string' && cfg.url.trim() ? cfg.url.trim() : '';\n    const host = (obsCfg as any).host || '127.0.0.1';\n    const port = (obsCfg as any).port || 4455;\n    const scheme = (obsCfg as any).secure ? 'wss' : 'ws';\n    const url = explicitUrl || `${scheme}://${host}:${port}/`;\n\n    // Keep the inline bridge helpers in sync\n    try {\n      _cfgBridge.getUrl = () => url;\n      _cfgBridge.getPass = () => password;\n    } catch {}\n\n    // If the JS bridge (obsBridge.js) is present, push config into it\n    try {\n      const bridge = getObsBridge();\n      if (bridge && typeof (bridge as any).configure === 'function') {\n        (bridge as any).configure({ url, password });\n      }\n    } catch (err) {\n      try { console.warn('[OBS] bridge.configure failed', err); } catch {}\n    }\n\n    // If already connected, reconnect soon to apply changes\n    try {\n      if (_ws) {\n        try { _ws.close(1000, 'reconfig'); } catch {}\n        reconnectSoon(200);\n      }\n    } catch {}\n  } catch (err) {\n    try { console.warn('[OBS] reconfigure failed', err); } catch {}\n  }\n}\nexport async function test() {\n  try {\n    return await connect({ testOnly: true });\n  } catch {\n    return false;\n  }\n}\nexport async function disconnect() {\n  try {\n    _identified = false;\n    _connecting = false;\n    try {\n      _ws && _ws.close(1000, 'manual');\n    } catch {}\n    _ws = null;\n    try {\n      _cfgBridge.onStatus?.('disconnected', false);\n    } catch {}\n  } catch {}\n  return true;\n}\n\nlet _reconnTimer = 0;\nfunction reconnectSoon(ms = 400) {\n  try {\n    clearTimeout(_reconnTimer);\n    _reconnTimer = setTrackedTimeout(() => {\n      try { connect(); } catch {}\n    }, ms);\n  } catch {}\n}\n\nexport async function connect({ testOnly = false } = {}) {\n  return safeConnect(testOnly);\n}\n\n// Compat alias\nexport async function connect2(opts?: { testOnly?: boolean }) {\n  return safeConnect(opts?.testOnly);\n}\n\nexport function isConnected() {\n  return _identified;\n}\n\n// Compat aliases\nexport function setEnabled3(on: boolean) {\n  return safeSetEnabled(on);\n}\n\n// Public initializer for UI wiring. Maps simple UI hooks into the registry settings\nexport function init({ getUrl, getPass, isEnabled, onStatus, onRecordState } = {}) {\n  try {\n    if (typeof onStatus === 'function') onStatus('recorder loaded', true);\n\n    if (getUrl || getPass) {\n      try {\n        setSettings({\n          configs: {\n            obs: {\n              url: getUrl ? getUrl() : undefined,\n              password: getPass ? getPass() : undefined,\n            },\n          },\n        });\n      } catch {}\n    }\n    try {\n      applyConfigs();\n    } catch {}\n\n    try {\n      if (isEnabled && isEnabled()) {\n        // startSelected alias\n        start();\n      }\n    } catch {}\n\n    // Also initialize the inline bridge if present so it can use the same hooks\n    try {\n      if (typeof initBridge === 'function') {\n        initBridge({ getUrl, getPass, isEnabled, onStatus, onRecordState });\n      }\n    } catch {}\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n"],
  "mappings": "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",
  "names": ["getJSON", "getCfg", "getSelectedAdapterId", "wantsAuto", "getAdapter", "bridgeCfg", "getRecorderSurface", "start", "stop"]
}
