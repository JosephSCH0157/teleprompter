{
  "version": 3,
  "sources": ["../src/speech/recognizer.ts"],
  "sourcesContent": ["// Lightweight wrapper around the Web Speech API for the teleprompter\r\n// Exposes a simple Recognizer class that emits transcripts to a callback.\r\nexport type RecognizerOptions = {\r\n  lang?: string;\r\n  interimIntervalMs?: number; // how often to forward interim results (debounce)\r\n  maxAlternatives?: number;\r\n};\r\n\r\ntype ResultCallback = (_transcript: string, _isFinal: boolean) => void;\r\n\r\nexport class Recognizer {\r\n  private recog: any | null = null;\r\n  private cb: ResultCallback | null = null;\r\n  private opts: RecognizerOptions;\r\n  private _lastInterimAt = 0;\r\n\r\n  constructor(opts: RecognizerOptions = {}) {\r\n    this.opts = Object.assign({ lang: 'en-US', interimIntervalMs: 150, maxAlternatives: 2 }, opts);\r\n  }\r\n\r\n  available(): boolean {\r\n    return Boolean((globalThis as any).SpeechRecognition || (globalThis as any).webkitSpeechRecognition);\r\n  }\r\n\r\n  start(cb: ResultCallback) {\r\n    this.cb = cb;\r\n    const SR = (globalThis as any).SpeechRecognition || (globalThis as any).webkitSpeechRecognition;\r\n    if (!SR) throw new Error('SpeechRecognition not available');\r\n    try {\r\n      this.recog = new SR();\r\n      this.recog.continuous = true;\r\n      this.recog.interimResults = true;\r\n      this.recog.lang = this.opts.lang;\r\n      try {\r\n        this.recog.maxAlternatives = Math.max(2, this.recog.maxAlternatives || 0, this.opts.maxAlternatives || 2);\r\n      } catch {}\r\n\r\n      this.recog.onstart = () => {};\r\n      this.recog.onend = () => {};\r\n\r\n      this.recog.onresult = (e: any) => {\r\n        let interim = '';\r\n        let finals = '';\r\n        for (let i = e.resultIndex; i < e.results.length; i++) {\r\n          const r = e.results[i];\r\n          if (r.isFinal) finals += (r[0]?.transcript || '') + ' ';\r\n          else interim += (r[0]?.transcript || '') + ' ';\r\n        }\r\n        if (finals && this.cb) this.cb(finals.trim(), true);\r\n        const now = performance.now();\r\n        if (interim && now - this._lastInterimAt > (this.opts.interimIntervalMs || 150)) {\r\n          this._lastInterimAt = now;\r\n          if (this.cb) this.cb(interim.trim(), false);\r\n        }\r\n      };\r\n\r\n      try {\r\n        this.recog.start();\r\n      } catch (e) {\r\n        // start may throw depending on permissions/state\r\n        throw e;\r\n      }\r\n    } catch (err) {\r\n      this.recog = null;\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  stop() {\r\n    try {\r\n      if (this.recog) {\r\n        try { this.recog.stop(); } catch {}\r\n      }\r\n    } finally {\r\n      this.recog = null;\r\n      this.cb = null;\r\n    }\r\n  }\r\n}\r\n\r\n// Export a convenience factory used by a loader or runtime shim\r\nexport function createRecognizer(opts?: RecognizerOptions) {\r\n  return new Recognizer(opts);\r\n}\r\n"],
  "mappings": ";;;;;AAUO,IAAM,aAAN,MAAiB;AAAA,EAMtB,YAAY,OAA0B,CAAC,GAAG;AAL1C,wBAAQ,SAAoB;AAC5B,wBAAQ,MAA4B;AACpC,wBAAQ;AACR,wBAAQ,kBAAiB;AAGvB,SAAK,OAAO,OAAO,OAAO,EAAE,MAAM,SAAS,mBAAmB,KAAK,iBAAiB,EAAE,GAAG,IAAI;AAAA,EAC/F;AAAA,EAEA,YAAqB;AACnB,WAAO,QAAS,WAAmB,qBAAsB,WAAmB,uBAAuB;AAAA,EACrG;AAAA,EAEA,MAAM,IAAoB;AACxB,SAAK,KAAK;AACV,UAAM,KAAM,WAAmB,qBAAsB,WAAmB;AACxE,QAAI,CAAC,GAAI,OAAM,IAAI,MAAM,iCAAiC;AAC1D,QAAI;AACF,WAAK,QAAQ,IAAI,GAAG;AACpB,WAAK,MAAM,aAAa;AACxB,WAAK,MAAM,iBAAiB;AAC5B,WAAK,MAAM,OAAO,KAAK,KAAK;AAC5B,UAAI;AACF,aAAK,MAAM,kBAAkB,KAAK,IAAI,GAAG,KAAK,MAAM,mBAAmB,GAAG,KAAK,KAAK,mBAAmB,CAAC;AAAA,MAC1G,QAAQ;AAAA,MAAC;AAET,WAAK,MAAM,UAAU,MAAM;AAAA,MAAC;AAC5B,WAAK,MAAM,QAAQ,MAAM;AAAA,MAAC;AAE1B,WAAK,MAAM,WAAW,CAAC,MAAW;AAChC,YAAI,UAAU;AACd,YAAI,SAAS;AACb,iBAAS,IAAI,EAAE,aAAa,IAAI,EAAE,QAAQ,QAAQ,KAAK;AACrD,gBAAM,IAAI,EAAE,QAAQ,CAAC;AACrB,cAAI,EAAE,QAAS,YAAW,EAAE,CAAC,GAAG,cAAc,MAAM;AAAA,cAC/C,aAAY,EAAE,CAAC,GAAG,cAAc,MAAM;AAAA,QAC7C;AACA,YAAI,UAAU,KAAK,GAAI,MAAK,GAAG,OAAO,KAAK,GAAG,IAAI;AAClD,cAAM,MAAM,YAAY,IAAI;AAC5B,YAAI,WAAW,MAAM,KAAK,kBAAkB,KAAK,KAAK,qBAAqB,MAAM;AAC/E,eAAK,iBAAiB;AACtB,cAAI,KAAK,GAAI,MAAK,GAAG,QAAQ,KAAK,GAAG,KAAK;AAAA,QAC5C;AAAA,MACF;AAEA,UAAI;AACF,aAAK,MAAM,MAAM;AAAA,MACnB,SAAS,GAAG;AAEV,cAAM;AAAA,MACR;AAAA,IACF,SAAS,KAAK;AACZ,WAAK,QAAQ;AACb,YAAM;AAAA,IACR;AAAA,EACF;AAAA,EAEA,OAAO;AACL,QAAI;AACF,UAAI,KAAK,OAAO;AACd,YAAI;AAAE,eAAK,MAAM,KAAK;AAAA,QAAG,QAAQ;AAAA,QAAC;AAAA,MACpC;AAAA,IACF,UAAE;AACA,WAAK,QAAQ;AACb,WAAK,KAAK;AAAA,IACZ;AAAA,EACF;AACF;AAGO,SAAS,iBAAiB,MAA0B;AACzD,SAAO,IAAI,WAAW,IAAI;AAC5B;",
  "names": []
}
